import{a as Bt,b as oe,d as re,f as ae,h as Gt,k as qt,l as Kt,m as Qt,n as De,p as se}from"./chunk-QMSUBH36.js";import{$ as g,A as Ft,C as b,D as Z,E as Wt,F as c,Fa as $,Ga as he,H as I,I as U,M as x,O as jt,P as R,Q as ge,R as L,S as f,T as qe,U as Ke,V as H,W as B,X as r,Y as s,Z as h,_ as S,a as y,aa as l,b as N,ba as Me,c as Ee,ca as we,d as v,da as Se,e as pe,ea as d,fa as P,ga as E,ha as q,ia as K,ja as Q,k as D,la as Ht,ma as Ie,n as j,na as Ve,q as ne,r as be,sa as Re,t as m,ta as Le,u as _,v as w,va as Qe,w as k,wa as F,y as Ge,ya as ie,z as ue}from"./chunk-CKB3J6IH.js";var Ae=class i{constructor(e){this.http=e}apiUrl=$.apiUrl;contacts=b([]);getContacts(){return this.http.get(`${this.apiUrl}/contacts`).pipe(D(e=>this.contacts.set(e)))}addContact(e){return this.http.post(`${this.apiUrl}/contacts`,e).pipe(D(t=>{this.contacts.set([...this.contacts(),t])}))}updateContact(e,t){return this.http.put(`${this.apiUrl}/contacts/${e}`,t).pipe(D(n=>{let o=this.contacts(),a=o.findIndex(p=>p.id===e);if(a!==-1){let p=[...o];p[a]=n,this.contacts.set(p)}}))}deleteContact(e){return this.http.delete(`${this.apiUrl}/contacts/${e}`).pipe(D(()=>{this.contacts.set(this.contacts().filter(t=>t.id!==e))}))}searchContacts(e){let t=e.toLowerCase();return this.contacts().filter(n=>n.nombre.toLowerCase().includes(t)||n.numeroTelefono.includes(e)||n.nombrePersonalizado?.toLowerCase().includes(t))}static \u0275fac=function(t){return new(t||i)(ne(ie))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};var ce=class i{apiUrl=$.apiUrl;http=be(ie);chats=b([]);archivedChats=b([]);selectedChat=b(null);messages=b([]);onChatSelectedCallback;setOnChatSelectedCallback(e){this.onChatSelectedCallback=e}getChats(){return this.http.get(`${this.apiUrl}/chats`).pipe(D(e=>this.chats.set(e)))}getChat(e){return this.http.get(`${this.apiUrl}/chats/${e}`)}createIndividualChat(e){return this.http.post(`${this.apiUrl}/chats/individual`,e).pipe(D(t=>{let n=this.chats();n.find(o=>o.id===t.id)||this.chats.set([t,...n])}))}createGroup(e){return this.http.post(`${this.apiUrl}/chats/grupo`,e).pipe(D(t=>{this.chats.set([t,...this.chats()])}))}getMessages(e,t=1,n=50){return this.http.get(`${this.apiUrl}/messages/chat/${e}?page=${t}&pageSize=${n}`).pipe(D(o=>{t===1?this.messages.set(o):this.messages.set([...o,...this.messages()])}))}sendMessage(e){return this.http.post(`${this.apiUrl}/messages`,e).pipe(D(t=>{this.addMessage(t)}))}sendMessageWithFile(e,t,n,o){let a=new FormData;return a.append("chatId",e),a.append("file",t),n&&a.append("contenido",n),o!==void 0&&a.append("duracionSegundos",o.toString()),this.http.post(`${this.apiUrl}/messages/with-file`,a).pipe(D(p=>{this.addMessage(p)}))}sendAudioMessage(e,t,n){let o=new File([t],`audio_${Date.now()}.webm`,{type:"audio/webm"});return this.sendMessageWithFile(e,o,void 0,n)}markAsRead(e){return this.http.put(`${this.apiUrl}/messages/${e}/read`,{})}markAllAsRead(e){return this.http.put(`${this.apiUrl}/messages/chat/${e}/read-all`,{})}deleteMessage(e,t=!1){return this.http.delete(`${this.apiUrl}/messages/${e}?forEveryone=${t}`)}updateMessageStatus(e,t){let n=this.messages(),o=n.findIndex(a=>a.id===e);if(o!==-1){let a=[...n];a[o]=N(y({},a[o]),{estado:t}),this.messages.set(a)}}updateMessagesStatus(e,t){let o=this.messages().map(a=>e.includes(a.id)?N(y({},a),{estado:t}):a);this.messages.set(o)}selectChat(e){this.selectedChat.set(e),this.onChatSelectedCallback?.(e?.id??null),e?this.getMessages(e.id).subscribe():this.messages.set([])}addMessage(e){let t=this.messages();t.find(n=>n.id===e.id)||(this.messages.set([...t,e]),this.updateChatLastMessage(e))}searchMessages(e,t,n=20){return this.http.get(`${this.apiUrl}/messages/chat/${e}/search?query=${encodeURIComponent(t)}&limit=${n}`)}forwardMessage(e,t){return this.http.post(`${this.apiUrl}/messages/${e}/forward`,{targetChatId:t})}getArchivedChats(){return this.http.get(`${this.apiUrl}/chats/archivados`).pipe(D(e=>this.archivedChats.set(e)))}muteChat(e,t){return this.http.put(`${this.apiUrl}/chats/${e}/silenciar`,{silenciar:!0,duracion:t}).pipe(D(n=>{this.updateChatMuteStatus(e,n.silenciado,n.silenciadoHasta)}))}unmuteChat(e){return this.http.put(`${this.apiUrl}/chats/${e}/silenciar`,{silenciar:!1}).pipe(D(t=>{this.updateChatMuteStatus(e,t.silenciado,t.silenciadoHasta)}))}archiveChat(e){return this.http.put(`${this.apiUrl}/chats/${e}/archivar`,{archivar:!0}).pipe(D(()=>{let t=this.chats(),n=t.find(o=>o.id===e);n&&(this.chats.set(t.filter(o=>o.id!==e)),this.archivedChats.set([N(y({},n),{archivado:!0}),...this.archivedChats()])),this.selectedChat()?.id===e&&this.selectChat(null)}))}unarchiveChat(e){return this.http.put(`${this.apiUrl}/chats/${e}/archivar`,{archivar:!1}).pipe(D(()=>{let t=this.archivedChats(),n=t.find(o=>o.id===e);n&&(this.archivedChats.set(t.filter(o=>o.id!==e)),this.chats.set([N(y({},n),{archivado:!1}),...this.chats()]))}))}updateChatMuteStatus(e,t,n){let o=this.chats(),a=o.findIndex(M=>M.id===e);if(a!==-1){let M=[...o];M[a]=N(y({},M[a]),{silenciado:t,silenciadoHasta:n}),this.chats.set(M)}let p=this.archivedChats(),C=p.findIndex(M=>M.id===e);if(C!==-1){let M=[...p];M[C]=N(y({},M[C]),{silenciado:t,silenciadoHasta:n}),this.archivedChats.set(M)}}updateChatLastMessage(e){let t=this.chats(),n=t.findIndex(o=>o.id===e.chatId);if(n!==-1){let o=[...t];o[n]=N(y({},o[n]),{ultimoMensaje:e,ultimaActividad:new Date});let[a]=o.splice(n,1);this.chats.set([a,...o])}}static \u0275fac=function(t){return new(t||i)};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};var Xt=(i,e)=>e.id;function sn(i,e){if(i&1&&(r(0,"div",8),d(1),s()),i&2){let t=l();c(),P(t.errorMessage)}}function cn(i,e){if(i&1&&(r(0,"div",9),d(1),s()),i&2){let t=l();c(),P(t.successMessage)}}function ln(i,e){if(i&1){let t=S();r(0,"div",16),g("click",function(){let o=m(t).$implicit,a=l(2);return _(a.startChat(o))}),r(1,"div",17),d(2),s(),r(3,"div",18)(4,"span",19),d(5),s(),r(6,"span",20),d(7),s()()()}if(i&2){let t=e.$implicit;c(2),E(" ",(t.nombrePersonalizado||t.nombre).charAt(0)," "),c(3),P(t.nombrePersonalizado||t.nombre),c(2),P(t.estado)}}function dn(i,e){if(i&1){let t=S();r(0,"div",15)(1,"p"),d(2,"No tienes contactos a\xFAn"),s(),r(3,"button",7),g("click",function(){m(t);let o=l(2);return _(o.activeTab="add")}),d(4,"Agregar contacto"),s()()}}function pn(i,e){if(i&1&&(r(0,"div",11),H(1,ln,8,3,"div",14,Xt,!1,dn,5,0,"div",15),s()),i&2){let t=l();c(),B(t.contactService.contacts())}}function un(i,e){if(i&1&&(r(0,"div",24),d(1),s()),i&2){let t=l(2);c(),E(" ",t.getSelectedContactNames()," ")}}function gn(i,e){i&1&&(w(),r(0,"svg",30),h(1,"path",31),s())}function hn(i,e){if(i&1){let t=S();r(0,"div",16),g("click",function(){let o=m(t).$implicit,a=l(2);return _(a.toggleContactSelection(o))}),r(1,"div",29),x(2,gn,2,0,":svg:svg",30),s(),r(3,"div",17),d(4),s(),r(5,"div",18)(6,"span",19),d(7),s(),r(8,"span",20),d(9),s()()()}if(i&2){let t=e.$implicit,n=l(2);L("selected",n.isContactSelected(t)),c(2),f(n.isContactSelected(t)?2:-1),c(2),E(" ",(t.nombrePersonalizado||t.nombre).charAt(0)," "),c(3),P(t.nombrePersonalizado||t.nombre),c(2),P(t.estado)}}function mn(i,e){if(i&1){let t=S();r(0,"div",15)(1,"p"),d(2,"Necesitas al menos un contacto para crear un grupo"),s(),r(3,"button",7),g("click",function(){m(t);let o=l(2);return _(o.activeTab="add")}),d(4,"Agregar contacto"),s()()}}function _n(i,e){i&1&&h(0,"span",28)}function fn(i,e){i&1&&d(0," Crear Grupo ")}function Cn(i,e){if(i&1){let t=S();r(0,"div",12)(1,"div",21)(2,"label"),d(3,"Nombre del grupo *"),s(),r(4,"input",22),Q("ngModelChange",function(o){m(t);let a=l();return K(a.groupName,o)||(a.groupName=o),_(o)}),s()(),r(5,"div",21)(6,"label"),d(7,"Descripci\xF3n (opcional)"),s(),r(8,"textarea",23),Q("ngModelChange",function(o){m(t);let a=l();return K(a.groupDescription,o)||(a.groupDescription=o),_(o)}),s()(),r(9,"div",21)(10,"label"),d(11),s(),x(12,un,2,1,"div",24),s(),r(13,"div",25),H(14,hn,10,6,"div",26,Xt,!1,mn,5,0,"div",15),s(),r(17,"button",27),g("click",function(){m(t);let o=l();return _(o.createGroup())}),x(18,_n,1,0,"span",28)(19,fn,1,0),s()()}if(i&2){let t=l();c(4),q("ngModel",t.groupName),c(4),q("ngModel",t.groupDescription),c(3),E("Participantes (",t.selectedContacts.size," seleccionados)"),c(),f(t.selectedContacts.size>0?12:-1),c(2),B(t.contactService.contacts()),c(3),R("disabled",!t.groupName.trim()||t.selectedContacts.size===0||t.isLoading),c(),f(t.isLoading?18:19)}}function vn(i,e){i&1&&h(0,"span",28)}function xn(i,e){i&1&&d(0," Agregar contacto ")}function bn(i,e){if(i&1){let t=S();r(0,"div",13)(1,"div",21)(2,"label"),d(3,"N\xFAmero de tel\xE9fono"),s(),r(4,"input",32),Q("ngModelChange",function(o){m(t);let a=l();return K(a.newContactPhone,o)||(a.newContactPhone=o),_(o)}),s()(),r(5,"div",21)(6,"label"),d(7,"Nombre (opcional)"),s(),r(8,"input",33),Q("ngModelChange",function(o){m(t);let a=l();return K(a.newContactName,o)||(a.newContactName=o),_(o)}),s()(),r(9,"button",34),g("click",function(){m(t);let o=l();return _(o.addContact())}),x(10,vn,1,0,"span",28)(11,xn,1,0),s()()}if(i&2){let t=l();c(4),q("ngModel",t.newContactPhone),c(4),q("ngModel",t.newContactName),c(),R("disabled",!t.newContactPhone.trim()||t.isLoading),c(),f(t.isLoading?10:11)}}var Ye=class i{constructor(e,t){this.contactService=e;this.chatService=t;this.contactService.getContacts().subscribe()}close=new Ge;activeTab="contacts";newContactPhone="";newContactName="";isLoading=!1;errorMessage="";successMessage="";groupName="";groupDescription="";selectedContacts=new Set;startChat(e){this.chatService.createIndividualChat({contactoId:e.contactoUsuarioId}).subscribe({next:t=>{this.chatService.selectChat(t),this.close.emit()},error:t=>{this.errorMessage=t.error?.message||"Error al crear chat"}})}addContact(){this.newContactPhone.trim()&&(this.isLoading=!0,this.errorMessage="",this.successMessage="",this.contactService.addContact({numeroTelefono:this.newContactPhone.trim(),nombrePersonalizado:this.newContactName.trim()||void 0}).subscribe({next:()=>{this.successMessage="Contacto agregado exitosamente",this.newContactPhone="",this.newContactName="",this.isLoading=!1,this.activeTab="contacts"},error:e=>{this.isLoading=!1,this.errorMessage=e.error?.message||"Error al agregar contacto"}}))}closeModal(){this.close.emit()}toggleContactSelection(e){let t=e.contactoUsuarioId;this.selectedContacts.has(t)?this.selectedContacts.delete(t):this.selectedContacts.add(t)}isContactSelected(e){return this.selectedContacts.has(e.contactoUsuarioId)}createGroup(){!this.groupName.trim()||this.selectedContacts.size===0||(this.isLoading=!0,this.errorMessage="",this.chatService.createGroup({nombre:this.groupName.trim(),descripcion:this.groupDescription.trim()||void 0,participantesIds:Array.from(this.selectedContacts)}).subscribe({next:e=>{this.chatService.selectChat(e),this.resetGroupForm(),this.close.emit()},error:e=>{this.isLoading=!1,this.errorMessage=e.error?.message||"Error al crear el grupo"}}))}resetGroupForm(){this.groupName="",this.groupDescription="",this.selectedContacts.clear(),this.isLoading=!1}getSelectedContactNames(){return this.contactService.contacts().filter(t=>this.selectedContacts.has(t.contactoUsuarioId)).map(t=>t.nombrePersonalizado||t.nombre).join(", ")}static \u0275fac=function(t){return new(t||i)(I(Ae),I(ce))};static \u0275cmp=U({type:i,selectors:[["app-new-chat-modal"]],outputs:{close:"close"},decls:21,vars:9,consts:[[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"back-btn",3,"click"],["viewBox","0 0 24 24","width","24","height","24"],["fill","currentColor","d","M12 4l1.4 1.4L7.8 11H20v2H7.8l5.6 5.6L12 20l-8-8 8-8z"],[1,"tabs"],[3,"click"],[1,"message","error"],[1,"message","success"],[1,"modal-body"],[1,"contacts-list"],[1,"create-group-form"],[1,"add-contact-form"],[1,"contact-item"],[1,"empty-state"],[1,"contact-item",3,"click"],[1,"avatar"],[1,"contact-info"],[1,"name"],[1,"status"],[1,"form-group"],["type","text","placeholder","Nombre del grupo","maxlength","100",3,"ngModelChange","ngModel"],["placeholder","Descripci\xF3n del grupo","maxlength","500","rows","2",3,"ngModelChange","ngModel"],[1,"selected-preview"],[1,"contacts-list","selectable"],[1,"contact-item",3,"selected"],[1,"btn-primary","create-group-btn",3,"click","disabled"],[1,"spinner"],[1,"checkbox"],["viewBox","0 0 24 24","width","20","height","20"],["fill","#00a884","d","M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"],["type","tel","placeholder","+1234567890",3,"ngModelChange","ngModel"],["type","text","placeholder","Nombre del contacto",3,"ngModelChange","ngModel"],[1,"btn-primary",3,"click","disabled"]],template:function(t,n){t&1&&(r(0,"div",0),g("click",function(){return n.closeModal()}),r(1,"div",1),g("click",function(a){return a.stopPropagation()}),r(2,"header",2)(3,"button",3),g("click",function(){return n.closeModal()}),w(),r(4,"svg",4),h(5,"path",5),s()(),k(),r(6,"h2"),d(7,"Nuevo chat"),s()(),r(8,"div",6)(9,"button",7),g("click",function(){return n.activeTab="contacts"}),d(10," Contactos "),s(),r(11,"button",7),g("click",function(){return n.activeTab="group"}),d(12," Nuevo Grupo "),s(),r(13,"button",7),g("click",function(){return n.activeTab="add"}),d(14," Agregar "),s()(),x(15,sn,2,1,"div",8)(16,cn,2,1,"div",9),r(17,"div",10),x(18,pn,4,1,"div",11)(19,Cn,20,7,"div",12)(20,bn,12,4,"div",13),s()()()),t&2&&(c(9),L("active",n.activeTab==="contacts"),c(2),L("active",n.activeTab==="group"),c(2),L("active",n.activeTab==="add"),c(2),f(n.errorMessage?15:-1),c(),f(n.successMessage?16:-1),c(2),f(n.activeTab==="contacts"?18:n.activeTab==="group"?19:20))},dependencies:[F,se,oe,re,De,ae],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--overlay-bg);display:flex;z-index:1000}.modal-content[_ngcontent-%COMP%]{width:400px;max-width:100%;height:100%;background:var(--bg-primary);display:flex;flex-direction:column;animation:_ngcontent-%COMP%_slideIn .2s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(-100%)}to{transform:translate(0)}}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px;padding:60px 20px 20px;background:var(--accent);color:#fff}.modal-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]{border:none;background:none;cursor:pointer;color:#fff;padding:8px;margin:-8px}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:19px;font-weight:500;margin:0}.tabs[_ngcontent-%COMP%]{display:flex;background:var(--header-bg)}.tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;padding:15px;border:none;background:none;cursor:pointer;font-size:14px;color:var(--text-secondary);border-bottom:2px solid transparent;transition:all .2s}.tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{color:var(--accent);border-bottom-color:var(--accent)}.tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(.active){background:var(--hover-bg)}.message[_ngcontent-%COMP%]{padding:12px 20px;font-size:14px}.message.error[_ngcontent-%COMP%]{background:#fee;color:#c00}.message.success[_ngcontent-%COMP%]{background:#efe;color:#080}.modal-body[_ngcontent-%COMP%]{flex:1;overflow-y:auto;background:var(--bg-primary)}.contacts-list[_ngcontent-%COMP%]   .contact-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 20px;cursor:pointer;border-bottom:1px solid var(--border-color)}.contacts-list[_ngcontent-%COMP%]   .contact-item[_ngcontent-%COMP%]:hover{background:var(--hover-bg)}.contacts-list[_ngcontent-%COMP%]   .contact-item[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:49px;height:49px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#25d366);color:#fff;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:500}.contacts-list[_ngcontent-%COMP%]   .contact-item[_ngcontent-%COMP%]   .contact-info[_ngcontent-%COMP%]{margin-left:15px;display:flex;flex-direction:column}.contacts-list[_ngcontent-%COMP%]   .contact-item[_ngcontent-%COMP%]   .contact-info[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:16px;color:var(--text-primary)}.contacts-list[_ngcontent-%COMP%]   .contact-item[_ngcontent-%COMP%]   .contact-info[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{font-size:13px;color:var(--text-secondary);margin-top:2px}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;text-align:center}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);margin-bottom:15px}.empty-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:var(--accent);color:#fff;border:none;padding:10px 20px;border-radius:20px;cursor:pointer}.empty-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:var(--accent-hover)}.add-contact-form[_ngcontent-%COMP%]{padding:20px}.add-contact-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:20px}.add-contact-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:var(--accent);font-size:14px;margin-bottom:8px}.add-contact-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px;border:none;border-bottom:2px solid var(--accent);font-size:16px;transition:border-color .2s;background:transparent;color:var(--text-primary)}.add-contact-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-bottom-color:var(--accent)}.add-contact-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--text-muted)}.add-contact-form[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{width:100%;padding:14px;background:var(--accent);color:#fff;border:none;border-radius:8px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center}.add-contact-form[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--accent-hover)}.add-contact-form[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:disabled{background:var(--text-muted);cursor:not-allowed}.add-contact-form[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid transparent;border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.create-group-form[_ngcontent-%COMP%]{padding:20px;display:flex;flex-direction:column;height:100%}.create-group-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:16px}.create-group-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:var(--accent);font-size:14px;margin-bottom:8px}.create-group-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .create-group-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:12px;border:none;border-bottom:2px solid var(--accent);font-size:16px;transition:border-color .2s;font-family:inherit;resize:none;background:transparent;color:var(--text-primary)}.create-group-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .create-group-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-bottom-color:var(--accent)}.create-group-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder, .create-group-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]::placeholder{color:var(--text-muted)}.create-group-form[_ngcontent-%COMP%]   .selected-preview[_ngcontent-%COMP%]{background:var(--hover-bg);padding:8px 12px;border-radius:8px;font-size:13px;color:var(--text-secondary);margin-top:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.create-group-form[_ngcontent-%COMP%]   .contacts-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;margin:0 -20px;border-top:1px solid var(--border-color);max-height:250px}.create-group-form[_ngcontent-%COMP%]   .contacts-list.selectable[_ngcontent-%COMP%]   .contact-item[_ngcontent-%COMP%]{padding-left:15px}.create-group-form[_ngcontent-%COMP%]   .contacts-list.selectable[_ngcontent-%COMP%]   .contact-item.selected[_ngcontent-%COMP%]{background:var(--hover-bg)}.create-group-form[_ngcontent-%COMP%]   .contacts-list.selectable[_ngcontent-%COMP%]   .contact-item[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{width:24px;height:24px;border:2px solid var(--text-muted);border-radius:50%;margin-right:12px;display:flex;align-items:center;justify-content:center}.create-group-form[_ngcontent-%COMP%]   .contacts-list.selectable[_ngcontent-%COMP%]   .contact-item[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}.create-group-form[_ngcontent-%COMP%]   .contacts-list.selectable[_ngcontent-%COMP%]   .contact-item.selected[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{border-color:var(--accent);background:var(--accent)}.create-group-form[_ngcontent-%COMP%]   .contacts-list.selectable[_ngcontent-%COMP%]   .contact-item.selected[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#fff}.create-group-form[_ngcontent-%COMP%]   .create-group-btn[_ngcontent-%COMP%]{margin-top:auto;padding:14px;background:var(--accent);color:#fff;border:none;border-radius:8px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center}.create-group-form[_ngcontent-%COMP%]   .create-group-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--accent-hover)}.create-group-form[_ngcontent-%COMP%]   .create-group-btn[_ngcontent-%COMP%]:disabled{background:var(--text-muted);cursor:not-allowed}.create-group-form[_ngcontent-%COMP%]   .create-group-btn[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid transparent;border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}"]})};function Mn(i,e){if(i&1&&h(0,"img",9),i&2){let t=l();R("src",t.getProfileImageUrl(),Z)}}function wn(i,e){if(i&1&&(r(0,"div",10),d(1),s()),i&2){let t=l();c(),E(" ",t.getUserInitial()," ")}}function Sn(i,e){i&1&&(r(0,"div",11),h(1,"div",25),s())}function Pn(i,e){if(i&1){let t=S();r(0,"button",26),g("click",function(){m(t);let o=l();return _(o.deletePhoto())}),w(),r(1,"svg",4),h(2,"path",27),s()()}}function yn(i,e){if(i&1&&(r(0,"div",17),d(1),s()),i&2){let t=l();c(),P(t.errorMessage())}}function On(i,e){if(i&1){let t=S();r(0,"div",20)(1,"input",28),Q("ngModelChange",function(o){m(t);let a=l();return K(a.editedName,o)||(a.editedName=o),_(o)}),g("keyup.enter",function(){m(t);let o=l();return _(o.saveName())}),s(),r(2,"div",29)(3,"button",30),g("click",function(){m(t);let o=l();return _(o.saveName())}),w(),r(4,"svg",31),h(5,"path",32),s()(),k(),r(6,"button",33),g("click",function(){m(t);let o=l();return _(o.cancelEditName())}),w(),r(7,"svg",31),h(8,"path",34),s()()()()}if(i&2){let t=l();c(),q("ngModel",t.editedName)}}function kn(i,e){if(i&1){let t=S();r(0,"div",35),g("click",function(){m(t);let o=l();return _(o.startEditingName())}),r(1,"span",24),d(2),s(),w(),r(3,"svg",36),h(4,"path",37),s()()}if(i&2){let t,n=l();c(2),P((t=n.authService.currentUser())==null?null:t.nombre)}}function Tn(i,e){if(i&1){let t=S();r(0,"div",20)(1,"input",38),Q("ngModelChange",function(o){m(t);let a=l();return K(a.editedStatus,o)||(a.editedStatus=o),_(o)}),g("keyup.enter",function(){m(t);let o=l();return _(o.saveStatus())}),s(),r(2,"div",29)(3,"button",30),g("click",function(){m(t);let o=l();return _(o.saveStatus())}),w(),r(4,"svg",31),h(5,"path",32),s()(),k(),r(6,"button",33),g("click",function(){m(t);let o=l();return _(o.cancelEditStatus())}),w(),r(7,"svg",31),h(8,"path",34),s()()()()}if(i&2){let t=l();c(),q("ngModel",t.editedStatus)}}function En(i,e){if(i&1){let t=S();r(0,"div",35),g("click",function(){m(t);let o=l();return _(o.startEditingStatus())}),r(1,"span",24),d(2),s(),w(),r(3,"svg",36),h(4,"path",37),s()()}if(i&2){let t,n=l();c(2),P(((t=n.authService.currentUser())==null?null:t.estado)||"Hey there! I'm using WhatsApp Clone")}}var Ze=class i{constructor(e){this.authService=e}close=new Ge;isEditingName=b(!1);isEditingStatus=b(!1);isUploading=b(!1);editedName="";editedStatus="";errorMessage=b("");apiBaseUrl=$.apiUrl.replace("/api","");ngOnInit(){let e=this.authService.currentUser();e&&(this.editedName=e.nombre,this.editedStatus=e.estado||"Hey there! I'm using WhatsApp Clone")}getProfileImageUrl(){let e=this.authService.currentUser();return e?.fotoPerfil?e.fotoPerfil.startsWith("http")?e.fotoPerfil:`${this.apiBaseUrl}${e.fotoPerfil}`:null}getUserInitial(){return this.authService.currentUser()?.nombre?.charAt(0).toUpperCase()||"U"}onFileSelected(e){let t=e.target;t.files&&t.files[0]&&this.uploadPhoto(t.files[0])}uploadPhoto(e){if(this.isUploading())return;let t=new FormData;t.append("file",e),this.isUploading.set(!0),this.errorMessage.set(""),this.authService.uploadProfilePhoto(t).subscribe({next:()=>{this.isUploading.set(!1)},error:n=>{this.isUploading.set(!1),this.errorMessage.set(n.error?.message||"Error al subir la foto")}})}deletePhoto(){this.isUploading()||(this.isUploading.set(!0),this.authService.deleteProfilePhoto().subscribe({next:()=>{this.isUploading.set(!1)},error:()=>{this.isUploading.set(!1),this.errorMessage.set("Error al eliminar la foto")}}))}startEditingName(){let e=this.authService.currentUser();this.editedName=e?.nombre||"",this.isEditingName.set(!0)}saveName(){if(!this.editedName.trim()){this.errorMessage.set("El nombre no puede estar vac\xEDo");return}this.authService.updateProfile({nombre:this.editedName.trim()}).subscribe({next:()=>{this.isEditingName.set(!1),this.errorMessage.set("")},error:()=>{this.errorMessage.set("Error al actualizar el nombre")}})}cancelEditName(){let e=this.authService.currentUser();this.editedName=e?.nombre||"",this.isEditingName.set(!1),this.errorMessage.set("")}startEditingStatus(){let e=this.authService.currentUser();this.editedStatus=e?.estado||"",this.isEditingStatus.set(!0)}saveStatus(){this.authService.updateProfile({estado:this.editedStatus.trim()}).subscribe({next:()=>{this.isEditingStatus.set(!1),this.errorMessage.set("")},error:()=>{this.errorMessage.set("Error al actualizar el estado")}})}cancelEditStatus(){let e=this.authService.currentUser();this.editedStatus=e?.estado||"",this.isEditingStatus.set(!1),this.errorMessage.set("")}closePanel(){this.close.emit()}static \u0275fac=function(t){return new(t||i)(I(he))};static \u0275cmp=U({type:i,selectors:[["app-profile"]],outputs:{close:"close"},decls:39,vars:7,consts:[[1,"profile-overlay",3,"click"],[1,"profile-panel"],[1,"profile-header"],[1,"back-btn",3,"click"],["viewBox","0 0 24 24","width","24","height","24"],["fill","currentColor","d","M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"],[1,"profile-content"],[1,"photo-section"],[1,"photo-container"],["alt","Foto de perfil",1,"profile-photo",3,"src"],[1,"photo-placeholder"],[1,"upload-overlay"],[1,"photo-actions"],["title","Cambiar foto",1,"photo-action-btn"],["fill","currentColor","d","M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"],["type","file","accept","image/*","hidden","",3,"change"],["title","Eliminar foto",1,"photo-action-btn","delete"],[1,"error-message"],[1,"info-section"],[1,"section-label"],[1,"edit-field"],[1,"display-field"],[1,"section-hint"],[1,"display-field","readonly"],[1,"field-value"],[1,"spinner"],["title","Eliminar foto",1,"photo-action-btn","delete",3,"click"],["fill","currentColor","d","M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"],["type","text","maxlength","100","placeholder","Escribe tu nombre",3,"ngModelChange","keyup.enter","ngModel"],[1,"edit-actions"],[1,"save-btn",3,"click"],["viewBox","0 0 24 24","width","20","height","20"],["fill","currentColor","d","M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"],[1,"cancel-btn",3,"click"],["fill","currentColor","d","M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"],[1,"display-field",3,"click"],["viewBox","0 0 24 24","width","20","height","20",1,"edit-icon"],["fill","currentColor","d","M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"],["type","text","maxlength","150","placeholder","Escribe tu estado",3,"ngModelChange","keyup.enter","ngModel"]],template:function(t,n){if(t&1&&(r(0,"div",0),g("click",function(){return n.closePanel()}),s(),r(1,"div",1)(2,"header",2)(3,"button",3),g("click",function(){return n.closePanel()}),w(),r(4,"svg",4),h(5,"path",5),s()(),k(),r(6,"h2"),d(7,"Perfil"),s()(),r(8,"div",6)(9,"div",7)(10,"div",8),x(11,Mn,1,1,"img",9)(12,wn,2,1,"div",10)(13,Sn,2,0,"div",11),r(14,"div",12)(15,"label",13),w(),r(16,"svg",4),h(17,"path",14),s(),k(),r(18,"input",15),g("change",function(a){return n.onFileSelected(a)}),s()(),x(19,Pn,3,0,"button",16),s()()(),x(20,yn,2,1,"div",17),r(21,"div",18)(22,"label",19),d(23,"Tu nombre"),s(),x(24,On,9,1,"div",20)(25,kn,5,1,"div",21),r(26,"p",22),d(27,"Este nombre ser\xE1 visible para tus contactos de WhatsApp Clone"),s()(),r(28,"div",18)(29,"label",19),d(30,"Info"),s(),x(31,Tn,9,1,"div",20)(32,En,5,1,"div",21),s(),r(33,"div",18)(34,"label",19),d(35,"Tel\xE9fono"),s(),r(36,"div",23)(37,"span",24),d(38),s()()()()()),t&2){let o;c(11),f(n.getProfileImageUrl()?11:12),c(2),f(n.isUploading()?13:-1),c(6),f(n.getProfileImageUrl()?19:-1),c(),f(n.errorMessage()?20:-1),c(4),f(n.isEditingName()?24:25),c(7),f(n.isEditingStatus()?31:32),c(7),P((o=n.authService.currentUser())==null?null:o.numeroTelefono)}},dependencies:[F,se,oe,re,De,ae],styles:[".profile-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0006;z-index:100}.profile-panel[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;max-width:400px;height:100%;background:#ededed;z-index:101;display:flex;flex-direction:column;animation:_ngcontent-%COMP%_slideIn .2s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(-100%)}to{transform:translate(0)}}.profile-header[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:24px;padding:60px 24px 20px;background:#00a884;color:#fff}.profile-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]{width:40px;height:40px;border:none;background:none;cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:50%;color:#fff}.profile-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.profile-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:19px;font-weight:500;margin:0}.profile-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding-bottom:20px}.photo-section[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:28px 0;background:#ededed}.photo-section[_ngcontent-%COMP%]   .photo-container[_ngcontent-%COMP%]{position:relative;width:200px;height:200px}.photo-section[_ngcontent-%COMP%]   .photo-container[_ngcontent-%COMP%]   .profile-photo[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;object-fit:cover}.photo-section[_ngcontent-%COMP%]   .photo-container[_ngcontent-%COMP%]   .photo-placeholder[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#00a884,#25d366);color:#fff;display:flex;align-items:center;justify-content:center;font-size:72px;font-weight:500}.photo-section[_ngcontent-%COMP%]   .photo-container[_ngcontent-%COMP%]   .upload-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#00000080;border-radius:50%;display:flex;align-items:center;justify-content:center}.photo-section[_ngcontent-%COMP%]   .photo-container[_ngcontent-%COMP%]   .upload-overlay[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.photo-section[_ngcontent-%COMP%]   .photo-container[_ngcontent-%COMP%]   .photo-actions[_ngcontent-%COMP%]{position:absolute;bottom:10px;left:50%;transform:translate(-50%);display:flex;gap:10px}.photo-section[_ngcontent-%COMP%]   .photo-container[_ngcontent-%COMP%]   .photo-actions[_ngcontent-%COMP%]   .photo-action-btn[_ngcontent-%COMP%]{width:44px;height:44px;border:none;background:#00a884;color:#fff;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px #0003;transition:background .2s}.photo-section[_ngcontent-%COMP%]   .photo-container[_ngcontent-%COMP%]   .photo-actions[_ngcontent-%COMP%]   .photo-action-btn[_ngcontent-%COMP%]:hover{background:#008f72}.photo-section[_ngcontent-%COMP%]   .photo-container[_ngcontent-%COMP%]   .photo-actions[_ngcontent-%COMP%]   .photo-action-btn.delete[_ngcontent-%COMP%]{background:#dc3545}.photo-section[_ngcontent-%COMP%]   .photo-container[_ngcontent-%COMP%]   .photo-actions[_ngcontent-%COMP%]   .photo-action-btn.delete[_ngcontent-%COMP%]:hover{background:#c82333}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-message[_ngcontent-%COMP%]{background:#ffebee;color:#c62828;padding:12px 20px;margin:0 12px;border-radius:8px;font-size:14px;text-align:center}@media (max-width: 768px){.profile-panel[_ngcontent-%COMP%]{max-width:100%}.profile-header[_ngcontent-%COMP%]{padding:50px 16px 16px}.photo-section[_ngcontent-%COMP%]   .photo-container[_ngcontent-%COMP%]{width:160px;height:160px}.photo-section[_ngcontent-%COMP%]   .photo-container[_ngcontent-%COMP%]   .photo-placeholder[_ngcontent-%COMP%]{font-size:60px}}.info-section[_ngcontent-%COMP%]{background:#fff;padding:14px 30px;margin-top:12px;box-shadow:0 1px 3px #00000014}.info-section[_ngcontent-%COMP%]   .section-label[_ngcontent-%COMP%]{display:block;font-size:14px;color:#00a884;margin-bottom:12px}.info-section[_ngcontent-%COMP%]   .display-field[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;cursor:pointer;padding:4px 0}.info-section[_ngcontent-%COMP%]   .display-field[_ngcontent-%COMP%]:hover:not(.readonly)   .edit-icon[_ngcontent-%COMP%]{opacity:1}.info-section[_ngcontent-%COMP%]   .display-field.readonly[_ngcontent-%COMP%]{cursor:default}.info-section[_ngcontent-%COMP%]   .display-field[_ngcontent-%COMP%]   .field-value[_ngcontent-%COMP%]{font-size:17px;color:#111b21;word-break:break-word}.info-section[_ngcontent-%COMP%]   .display-field[_ngcontent-%COMP%]   .edit-icon[_ngcontent-%COMP%]{color:#667781;opacity:.6;flex-shrink:0;margin-left:12px;transition:opacity .2s}.info-section[_ngcontent-%COMP%]   .edit-field[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;border-bottom:2px solid #00a884;padding-bottom:8px}.info-section[_ngcontent-%COMP%]   .edit-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border:none;font-size:17px;color:#111b21;background:none;padding:4px 0}.info-section[_ngcontent-%COMP%]   .edit-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none}.info-section[_ngcontent-%COMP%]   .edit-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#667781}.info-section[_ngcontent-%COMP%]   .edit-field[_ngcontent-%COMP%]   .edit-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.info-section[_ngcontent-%COMP%]   .edit-field[_ngcontent-%COMP%]   .edit-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:32px;height:32px;border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .2s}.info-section[_ngcontent-%COMP%]   .edit-field[_ngcontent-%COMP%]   .edit-actions[_ngcontent-%COMP%]   .save-btn[_ngcontent-%COMP%]{background:#00a884;color:#fff}.info-section[_ngcontent-%COMP%]   .edit-field[_ngcontent-%COMP%]   .edit-actions[_ngcontent-%COMP%]   .save-btn[_ngcontent-%COMP%]:hover{background:#008f72}.info-section[_ngcontent-%COMP%]   .edit-field[_ngcontent-%COMP%]   .edit-actions[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]{background:#f0f2f5;color:#667781}.info-section[_ngcontent-%COMP%]   .edit-field[_ngcontent-%COMP%]   .edit-actions[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]:hover{background:#e9edef}.info-section[_ngcontent-%COMP%]   .section-hint[_ngcontent-%COMP%]{font-size:14px;color:#667781;margin-top:14px;line-height:1.4}"]})};var me=class i{constructor(e){this.http=e}apiUrl=$.apiUrl;myStatuses=b({estados:[],totalVistas:0});contactsStatuses=b([]);selectedContactStatuses=b(null);currentStatusIndex=b(0);getMyStatuses(){return this.http.get(`${this.apiUrl}/estados`).pipe(D(e=>this.myStatuses.set(e)))}getContactsStatuses(){return this.http.get(`${this.apiUrl}/estados/contactos`).pipe(D(e=>this.contactsStatuses.set(e)))}createTextStatus(e){return this.http.post(`${this.apiUrl}/estados`,e).pipe(D(t=>{let n=this.myStatuses();this.myStatuses.set({estados:[t,...n.estados],totalVistas:n.totalVistas})}))}createImageStatus(e,t){let n=new FormData;return n.append("imagen",e),t&&n.append("caption",t),this.http.post(`${this.apiUrl}/estados/imagen`,n).pipe(D(o=>{let a=this.myStatuses();this.myStatuses.set({estados:[o,...a.estados],totalVistas:a.totalVistas})}))}markAsViewed(e){return this.http.post(`${this.apiUrl}/estados/${e}/vista`,{}).pipe(D(()=>{let n=this.contactsStatuses().map(o=>N(y({},o),{estados:o.estados.map(a=>a.id===e?N(y({},a),{vioPorMi:!0}):a),todosVistos:o.estados.every(a=>a.id===e||a.vioPorMi)}));this.contactsStatuses.set(n)}))}getStatusViewers(e){return this.http.get(`${this.apiUrl}/estados/${e}/vistas`)}deleteStatus(e){return this.http.delete(`${this.apiUrl}/estados/${e}`).pipe(D(()=>{let t=this.myStatuses();this.myStatuses.set({estados:t.estados.filter(n=>n.id!==e),totalVistas:t.totalVistas})}))}selectContactStatuses(e){this.selectedContactStatuses.set(e),this.currentStatusIndex.set(0)}nextStatus(){let e=this.selectedContactStatuses();if(!e)return!1;let t=this.currentStatusIndex();return t<e.estados.length-1?(this.currentStatusIndex.set(t+1),!0):!1}previousStatus(){let e=this.currentStatusIndex();return e>0?(this.currentStatusIndex.set(e-1),!0):!1}handleNewStatus(e){let t=this.contactsStatuses(),n=t.findIndex(o=>o.usuarioId===e.usuarioId);if(n!==-1){let o=[...t];o[n]=N(y({},o[n]),{estados:[e,...o[n].estados],todosVistos:!1,ultimaActualizacion:new Date});let[a]=o.splice(n,1);this.contactsStatuses.set([a,...o])}else{let o={usuarioId:e.usuarioId,usuarioNombre:e.usuarioNombre,usuarioFoto:e.usuarioFoto,estados:[e],todosVistos:!1,ultimaActualizacion:new Date};this.contactsStatuses.set([o,...t])}}handleStatusDeleted(e,t){let o=this.contactsStatuses().map(a=>{if(a.usuarioId===e){let p=a.estados.filter(C=>C.id!==t);return p.length>0?N(y({},a),{estados:p}):null}return a}).filter(a=>a!==null);this.contactsStatuses.set(o)}handleStatusViewed(e,t){let n=this.myStatuses();this.myStatuses.set({estados:n.estados.map(o=>o.id===e?N(y({},o),{totalVistas:o.totalVistas+1}):o),totalVistas:n.totalVistas+1})}static \u0275fac=function(t){return new(t||i)(ne(ie))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};var In=(i,e)=>e.usuarioId;function Vn(i,e){if(i&1&&h(0,"img",4),i&2){let t=l();R("src",t.getProfileImage(),Z)}}function Rn(i,e){if(i&1&&(r(0,"div",5),d(1),s()),i&2){let t,n=l();c(),E(" ",((t=n.authService.currentUser())==null||t.nombre==null?null:t.nombre.charAt(0))||"U"," ")}}function Ln(i,e){if(i&1){let t=S();r(0,"div",14),g("click",function(o){m(t);let a=l();return o.stopPropagation(),_(a.onCreateStatus())}),w(),r(1,"svg",15),h(2,"path",16),s()()}}function Dn(i,e){if(i&1&&(r(0,"span",17),d(1),s()),i&2){let t=l(2);c(),E("",t.statusService.myStatuses().totalVistas," vistas")}}function An(i,e){if(i&1&&(r(0,"span",9),d(1),x(2,Dn,2,1,"span",17),s()),i&2){let t=l();c(),E(" ",t.formatTime(t.statusService.myStatuses().estados[0].fechaCreacion)," "),c(),f(t.statusService.myStatuses().totalVistas>0?2:-1)}}function zn(i,e){i&1&&(r(0,"span",10),d(1,"Toca para agregar estado"),s())}function Nn(i,e){if(i&1){let t=S();r(0,"button",18),g("click",function(){m(t);let o=l();return _(o.onCreateStatus())}),w(),r(1,"svg",19),h(2,"path",16),s()()}}function $n(i,e){if(i&1&&(w(),h(0,"circle",28)),i&2){let t=e.$implicit,n=e.$index,o=l().$implicit,a=l(2);L("viewed",t.vioPorMi),jt("stroke-dasharray",a.getSegmentDasharray(o.estados.length))("stroke-dashoffset",a.getSegmentOffset(o.estados.length,n))}}function Un(i,e){if(i&1&&h(0,"img",26),i&2){let t=l().$implicit,n=l(2);R("src",n.getContactImage(t),Z)}}function Fn(i,e){if(i&1&&(r(0,"div",5),d(1),s()),i&2){let t=l().$implicit;c(),E(" ",t.usuarioNombre.charAt(0)," ")}}function Wn(i,e){if(i&1){let t=S();r(0,"div",22),g("click",function(){let o=m(t).$implicit,a=l(2);return _(a.onViewContactStatuses(o))}),r(1,"div",23),w(),r(2,"svg",24),H(3,$n,1,4,":svg:circle",25,qe),s(),x(5,Un,1,1,"img",26)(6,Fn,2,1,"div",5),s(),k(),r(7,"div",7)(8,"span",27),d(9),s(),r(10,"span",9),d(11),s()()()}if(i&2){let t=e.$implicit,n=l(2);L("all-viewed",t.todosVistos),c(),L("viewed",t.todosVistos),c(2),B(t.estados),c(2),f(n.getContactImage(t)?5:6),c(4),P(t.usuarioNombre),c(2),P(n.formatTime(t.ultimaActualizacion))}}function jn(i,e){if(i&1&&(r(0,"div",12)(1,"h4",20),d(2,"Actualizaciones recientes"),s(),H(3,Wn,12,7,"div",21,In),s()),i&2){let t=l();c(3),B(t.statusService.contactsStatuses())}}function Hn(i,e){i&1&&(r(0,"div",13)(1,"p"),d(2,"No hay actualizaciones de estado"),s(),r(3,"p",29),d(4,"Los estados de tus contactos aparecer\xE1n aqu\xED"),s()())}var tt=class i{constructor(e,t){this.statusService=e;this.authService=t}openCreateStatus=ue();openViewer=ue();openMyStatuses=ue();showMyStatuses=b(!1);apiUrl=$.apiUrl.replace("/api","");ngOnInit(){this.loadStatuses()}loadStatuses(){this.statusService.getMyStatuses().subscribe(),this.statusService.getContactsStatuses().subscribe()}getProfileImage(){let e=this.authService.currentUser()?.fotoPerfil;return e?e.startsWith("http")?e:`${this.apiUrl}${e}`:null}getContactImage(e){return e.usuarioFoto?e.usuarioFoto.startsWith("http")?e.usuarioFoto:`${this.apiUrl}${e.usuarioFoto}`:null}onCreateStatus(){this.openCreateStatus.emit()}onViewMyStatuses(){this.openMyStatuses.emit()}onViewContactStatuses(e){this.statusService.selectContactStatuses(e),this.openViewer.emit(e)}formatTime(e){let t=new Date(e),o=new Date().getTime()-t.getTime(),a=Math.floor(o/(1e3*60*60));return a<1?`hace ${Math.floor(o/6e4)} min`:a<24?`hace ${a}h`:t.toLocaleDateString()}getSegmentDasharray(e){let t=2*Math.PI*22,n=e>1?4:0,o=(t-n*e)/e;return`${o} ${t-o}`}getSegmentOffset(e,t){let n=2*Math.PI*22,o=e>1?4:0,a=(n-o*e)/e;return-(t*(a+o))+n/4}static \u0275fac=function(t){return new(t||i)(I(me),I(he))};static \u0275cmp=U({type:i,selectors:[["app-status-list"]],outputs:{openCreateStatus:"openCreateStatus",openViewer:"openViewer",openMyStatuses:"openMyStatuses"},decls:15,vars:5,consts:[[1,"status-list-container"],[1,"my-status-section"],[1,"my-status",3,"click"],[1,"avatar-wrapper"],["alt","Mi foto",1,"avatar-img",3,"src"],[1,"avatar"],[1,"add-status-icon"],[1,"status-info"],[1,"status-title"],[1,"status-time"],[1,"status-hint"],["title","Agregar estado",1,"add-more-btn"],[1,"status-section"],[1,"no-statuses"],[1,"add-status-icon",3,"click"],["viewBox","0 0 24 24","width","20","height","20"],["fill","currentColor","d","M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"],[1,"views-count"],["title","Agregar estado",1,"add-more-btn",3,"click"],["viewBox","0 0 24 24","width","24","height","24"],[1,"section-title"],[1,"status-item",3,"all-viewed"],[1,"status-item",3,"click"],[1,"avatar-ring"],["viewBox","0 0 50 50",1,"ring-progress"],["cx","25","cy","25","r","22","fill","none","stroke-width","2",1,"ring-segment",3,"viewed"],["alt","",1,"avatar-img",3,"src"],[1,"contact-name"],["cx","25","cy","25","r","22","fill","none","stroke-width","2",1,"ring-segment"],[1,"hint"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),g("click",function(){return n.statusService.myStatuses().estados.length>0?n.onViewMyStatuses():n.onCreateStatus()}),r(3,"div",3),x(4,Vn,1,1,"img",4)(5,Rn,2,1,"div",5)(6,Ln,3,0,"div",6),s(),r(7,"div",7)(8,"span",8),d(9,"Mi estado"),s(),x(10,An,3,2,"span",9)(11,zn,2,0,"span",10),s()(),x(12,Nn,3,0,"button",11),s(),x(13,jn,5,0,"div",12)(14,Hn,5,0,"div",13),s()),t&2&&(c(4),f(n.getProfileImage()?4:5),c(2),f(n.statusService.myStatuses().estados.length===0?6:-1),c(4),f(n.statusService.myStatuses().estados.length>0?10:11),c(2),f(n.statusService.myStatuses().estados.length>0?12:-1),c(),f(n.statusService.contactsStatuses().length>0?13:14))},dependencies:[F],styles:[".status-list-container[_ngcontent-%COMP%]{height:100%;overflow-y:auto;background:#fff}.my-status-section[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 16px;border-bottom:1px solid #e9edef;background:#fff}.my-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;flex:1;cursor:pointer;padding:4px;border-radius:8px;transition:background .2s}.my-status[_ngcontent-%COMP%]:hover{background:#f5f6f6}.avatar-wrapper[_ngcontent-%COMP%]{position:relative;width:50px;height:50px}.avatar-img[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;object-fit:cover}.avatar[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;background:#00a884;color:#fff;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:500}.add-status-icon[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;width:22px;height:22px;background:#00a884;border-radius:50%;border:2px solid #fff;display:flex;align-items:center;justify-content:center;color:#fff;cursor:pointer}.add-status-icon[_ngcontent-%COMP%]:hover{background:#008f72}.status-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.status-title[_ngcontent-%COMP%]{font-size:16px;color:#111b21;font-weight:500}.status-time[_ngcontent-%COMP%]{font-size:13px;color:#667781}.views-count[_ngcontent-%COMP%]{margin-left:8px;color:#00a884}.status-hint[_ngcontent-%COMP%]{font-size:13px;color:#8696a0}.add-more-btn[_ngcontent-%COMP%]{width:40px;height:40px;border:none;background:#f0f2f5;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#54656f;transition:all .2s}.add-more-btn[_ngcontent-%COMP%]:hover{background:#e9edef;color:#00a884}.status-section[_ngcontent-%COMP%]{padding:8px 0}.section-title[_ngcontent-%COMP%]{padding:8px 16px;font-size:14px;font-weight:500;color:#00a884;text-transform:uppercase;letter-spacing:.5px}.status-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 16px;cursor:pointer;transition:background .2s}.status-item[_ngcontent-%COMP%]:hover{background:#f5f6f6}.status-item.all-viewed[_ngcontent-%COMP%]   .ring-segment[_ngcontent-%COMP%]{stroke:#8696a0}.avatar-ring[_ngcontent-%COMP%]{position:relative;width:50px;height:50px}.avatar-ring[_ngcontent-%COMP%]   .ring-progress[_ngcontent-%COMP%]{position:absolute;top:-2px;left:-2px;width:54px;height:54px;transform:rotate(-90deg)}.avatar-ring[_ngcontent-%COMP%]   .ring-segment[_ngcontent-%COMP%]{stroke:#00a884;transition:stroke .3s}.avatar-ring[_ngcontent-%COMP%]   .ring-segment.viewed[_ngcontent-%COMP%]{stroke:#8696a0}.avatar-ring[_ngcontent-%COMP%]   .avatar-img[_ngcontent-%COMP%]{position:absolute;top:2px;left:2px;width:46px;height:46px}.avatar-ring[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{position:absolute;top:2px;left:2px;width:46px;height:46px;font-size:18px}.contact-name[_ngcontent-%COMP%]{font-size:16px;color:#111b21}.no-statuses[_ngcontent-%COMP%]{padding:40px 20px;text-align:center;color:#667781}.no-statuses[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0}.no-statuses[_ngcontent-%COMP%]   p.hint[_ngcontent-%COMP%]{font-size:13px;color:#8696a0}"]})};var Bn=["fileInput"],Gn=["textInput"];function qn(i,e){i&1&&d(0," Nuevo estado ")}function Kn(i,e){i&1&&d(0," Estado de texto ")}function Qn(i,e){i&1&&d(0," Estado con foto ")}function Jn(i,e){if(i&1){let t=S();r(0,"div",9)(1,"button",10),g("click",function(){m(t);let o=l();return _(o.selectMode("text"))}),r(2,"div",11),w(),r(3,"svg",12),h(4,"path",13),s()(),k(),r(5,"span",14),d(6,"Texto"),s(),r(7,"span",15),d(8,"Escribe un estado con fondo de color"),s()(),r(9,"button",10),g("click",function(){m(t);let o=l();return _(o.selectMode("image"))}),r(10,"div",16),w(),r(11,"svg",12),h(12,"path",17),s()(),k(),r(13,"span",14),d(14,"Foto"),s(),r(15,"span",15),d(16,"Comparte una imagen como estado"),s()()()}}function Xn(i,e){if(i&1){let t=S();r(0,"button",24),g("click",function(){let o=m(t).$implicit,a=l(2);return _(a.selectColor(o))}),s()}if(i&2){let t=e.$implicit,n=l(2);ge("background",t),L("selected",n.selectedColor()===t)}}function Yn(i,e){i&1&&(h(0,"span",25),d(1," Publicando... "))}function Zn(i,e){i&1&&(w(),r(0,"svg",6),h(1,"path",26),s(),d(2," Publicar "))}function ei(i,e){if(i&1){let t=S();r(0,"div",18)(1,"textarea",19,0),Q("ngModelChange",function(o){m(t);let a=l();return K(a.textContent,o)||(a.textContent=o),_(o)}),s(),r(3,"div",20),d(4),s()(),r(5,"div",21),H(6,Xn,1,4,"button",22,Ke),s(),r(8,"button",23),g("click",function(){m(t);let o=l();return _(o.submitTextStatus())}),x(9,Yn,2,0)(10,Zn,3,0),s()}if(i&2){let t=l();ge("background",t.selectedColor()),c(),q("ngModel",t.textContent),R("disabled",t.isSubmitting()),c(3),E("",t.textContent().length,"/700"),c(2),B(t.colors),c(2),R("disabled",!t.textContent().trim()||t.isSubmitting()),c(),f(t.isSubmitting()?9:10)}}function ti(i,e){i&1&&(h(0,"span",25),d(1," Publicando... "))}function ni(i,e){i&1&&(w(),r(0,"svg",6),h(1,"path",26),s(),d(2," Publicar "))}function ii(i,e){if(i&1){let t=S();r(0,"div",29),h(1,"img",30),s(),r(2,"div",31)(3,"input",32),Q("ngModelChange",function(o){m(t);let a=l(2);return K(a.imageCaption,o)||(a.imageCaption=o),_(o)}),s()(),r(4,"button",23),g("click",function(){m(t);let o=l(2);return _(o.submitImageStatus())}),x(5,ti,2,0)(6,ni,3,0),s()}if(i&2){let t=l(2);c(),R("src",t.imagePreview(),Z),c(2),q("ngModel",t.imageCaption),R("disabled",t.isSubmitting()),c(),R("disabled",t.isSubmitting()),c(),f(t.isSubmitting()?5:6)}}function oi(i,e){i&1&&(r(0,"div",28),h(1,"span",25),r(2,"p"),d(3,"Selecciona una imagen"),s()())}function ri(i,e){if(i&1){let t=S();r(0,"input",27,1),g("change",function(o){m(t);let a=l();return _(a.onFileSelected(o))}),s(),x(2,ii,7,5)(3,oi,4,0,"div",28)}if(i&2){let t=l();c(2),f(t.imagePreview()?2:3)}}var nt=class i{constructor(e){this.statusService=e}close=ue();fileInput;textInput;mode=b("select");textContent=b("");selectedColor=b("#128C7E");selectedImage=b(null);imagePreview=b("");imageCaption=b("");isSubmitting=b(!1);colors=["#128C7E","#075E54","#25D366","#34B7F1","#9C27B0","#E91E63","#FF5722","#795548","#607D8B","#000000"];selectMode(e){this.mode.set(e),e==="image"?setTimeout(()=>this.fileInput.nativeElement.click(),100):e==="text"&&setTimeout(()=>this.textInput?.nativeElement?.focus(),100)}selectColor(e){this.selectedColor.set(e)}onFileSelected(e){let t=e.target;if(t.files&&t.files[0]){let n=t.files[0];if(!n.type.startsWith("image/")){alert("Solo se permiten im\xE1genes"),this.mode.set("select");return}if(n.size>10*1024*1024){alert("La imagen no puede superar 10MB"),this.mode.set("select");return}this.selectedImage.set(n);let o=new FileReader;o.onload=a=>{this.imagePreview.set(a.target?.result)},o.readAsDataURL(n)}else this.mode.set("select")}submitTextStatus(){let e=this.textContent().trim();e&&(this.isSubmitting.set(!0),this.statusService.createTextStatus({contenido:e,colorFondo:this.selectedColor()}).subscribe({next:()=>{this.close.emit()},error:t=>{console.error("Error creating status:",t),alert("Error al publicar estado"),this.isSubmitting.set(!1)}}))}submitImageStatus(){let e=this.selectedImage();e&&(this.isSubmitting.set(!0),this.statusService.createImageStatus(e,this.imageCaption()||void 0).subscribe({next:()=>{this.close.emit()},error:t=>{console.error("Error creating status:",t),alert("Error al publicar estado"),this.isSubmitting.set(!1)}}))}goBack(){this.mode()==="select"?this.close.emit():(this.mode.set("select"),this.textContent.set(""),this.selectedImage.set(null),this.imagePreview.set(""),this.imageCaption.set(""))}onOverlayClick(e){e.target.classList.contains("modal-overlay")&&this.close.emit()}static \u0275fac=function(t){return new(t||i)(I(me))};static \u0275cmp=U({type:i,selectors:[["app-create-status"]],viewQuery:function(t,n){if(t&1&&(Me(Bn,5),Me(Gn,5)),t&2){let o;we(o=Se())&&(n.fileInput=o.first),we(o=Se())&&(n.textInput=o.first)}},outputs:{close:"close"},decls:14,vars:2,consts:[["textInput",""],["fileInput",""],[1,"modal-overlay",3,"click"],[1,"modal-content"],[1,"modal-header"],[1,"back-btn",3,"click"],["viewBox","0 0 24 24","width","24","height","24"],["fill","currentColor","d","M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8-8-8z","transform","rotate(180 12 12)"],[1,"modal-body"],[1,"mode-selection"],[1,"mode-option",3,"click"],[1,"mode-icon","text-icon"],["viewBox","0 0 24 24","width","32","height","32"],["fill","currentColor","d","M2.5 4v3h5v12h3V7h5V4h-13zm19 5h-9v3h3v7h3v-7h3V9z"],[1,"mode-label"],[1,"mode-desc"],[1,"mode-icon","image-icon"],["fill","currentColor","d","M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"],[1,"text-editor"],["placeholder","Escribe un estado...","maxlength","700",3,"ngModelChange","ngModel","disabled"],[1,"char-count"],[1,"color-picker"],[1,"color-option",3,"background","selected"],[1,"submit-btn",3,"click","disabled"],[1,"color-option",3,"click"],[1,"spinner"],["fill","currentColor","d","M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"],["type","file","accept","image/*",2,"display","none",3,"change"],[1,"loading-image"],[1,"image-preview"],["alt","Preview",3,"src"],[1,"caption-input"],["type","text","placeholder","Agregar un pie de foto...","maxlength","200",3,"ngModelChange","ngModel","disabled"]],template:function(t,n){if(t&1&&(r(0,"div",2),g("click",function(a){return n.onOverlayClick(a)}),r(1,"div",3)(2,"header",4)(3,"button",5),g("click",function(){return n.goBack()}),w(),r(4,"svg",6),h(5,"path",7),s()(),k(),r(6,"h3"),x(7,qn,1,0)(8,Kn,1,0)(9,Qn,1,0),s()(),r(10,"div",8),x(11,Jn,17,0,"div",9)(12,ei,11,7)(13,ri,4,1),s()()()),t&2){let o,a;c(7),f((o=n.mode())==="select"?7:o==="text"?8:o==="image"?9:-1),c(4),f((a=n.mode())==="select"?11:a==="text"?12:a==="image"?13:-1)}},dependencies:[F,se,oe,re,De,ae],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:8px;width:90%;max-width:450px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px;background:#00a884;color:#fff}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:500}.back-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;display:flex;align-items:center;justify-content:center}.back-btn[_ngcontent-%COMP%]:hover{opacity:.8}.modal-body[_ngcontent-%COMP%]{flex:1;overflow-y:auto;display:flex;flex-direction:column}.mode-selection[_ngcontent-%COMP%]{padding:24px 16px;display:flex;flex-direction:column;gap:16px}.mode-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:16px;background:#f5f6f6;border:none;border-radius:12px;cursor:pointer;text-align:left;transition:all .2s}.mode-option[_ngcontent-%COMP%]:hover{background:#e9edef;transform:translate(4px)}.mode-icon[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff}.mode-icon.text-icon[_ngcontent-%COMP%]{background:#00a884}.mode-icon.image-icon[_ngcontent-%COMP%]{background:#34b7f1}.mode-label[_ngcontent-%COMP%]{font-size:16px;font-weight:500;color:#111b21;display:block}.mode-desc[_ngcontent-%COMP%]{font-size:13px;color:#667781;display:block;margin-top:4px}.text-editor[_ngcontent-%COMP%]{min-height:250px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;position:relative}.text-editor[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;min-height:150px;background:transparent;border:none;resize:none;font-size:22px;color:#fff;text-align:center;font-weight:500;line-height:1.4}.text-editor[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]::placeholder{color:#ffffffb3}.text-editor[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none}.text-editor[_ngcontent-%COMP%]   .char-count[_ngcontent-%COMP%]{position:absolute;bottom:8px;right:12px;font-size:12px;color:#ffffffb3}.color-picker[_ngcontent-%COMP%]{display:flex;gap:8px;padding:16px;justify-content:center;flex-wrap:wrap}.color-option[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;border:2px solid transparent;cursor:pointer;transition:all .2s}.color-option[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.color-option.selected[_ngcontent-%COMP%]{border-color:#111b21;transform:scale(1.15)}.image-preview[_ngcontent-%COMP%]{width:100%;max-height:300px;overflow:hidden;background:#000}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain}.caption-input[_ngcontent-%COMP%]{padding:16px;border-top:1px solid #e9edef}.caption-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #e9edef;border-radius:8px;font-size:14px}.caption-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#00a884}.loading-image[_ngcontent-%COMP%]{min-height:200px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;color:#667781}.submit-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;margin:16px;padding:12px 24px;background:#00a884;color:#fff;border:none;border-radius:24px;font-size:16px;font-weight:500;cursor:pointer;transition:background .2s}.submit-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#008f72}.submit-btn[_ngcontent-%COMP%]:disabled{background:#ccc;cursor:not-allowed}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})};var ai=(i,e)=>e.id;function si(i,e){if(i&1&&(r(0,"div",2),h(1,"div",21),s()),i&2){let t=e.$index,n=l();c(),ge("width",t<n.currentIndex?100:t===n.currentIndex?n.progress():0,"%")}}function ci(i,e){if(i&1&&h(0,"img",8),i&2){let t=l();R("src",t.getContactImage(),Z)}}function li(i,e){if(i&1&&(r(0,"div",9),d(1),s()),i&2){let t=l();c(),E(" ",t.contact().usuarioNombre.charAt(0)," ")}}function di(i,e){if(i&1&&(r(0,"span",12),d(1),s()),i&2){let t=l();c(),P(t.formatTime(t.currentStatus.fechaCreacion))}}function pi(i,e){if(i&1&&(r(0,"div",25)(1,"p"),d(2),s()()),i&2){let t=l(2);ge("background",t.currentStatus.colorFondo),c(2),P(t.currentStatus.contenido)}}function ui(i,e){if(i&1&&(r(0,"div",27),d(1),s()),i&2){let t=l(3);c(),E(" ",t.currentStatus.contenido," ")}}function gi(i,e){if(i&1&&(r(0,"div",24),h(1,"img",26),x(2,ui,2,1,"div",27),s()),i&2){let t=l(2);c(),R("src",t.getImageUrl(t.currentStatus.urlArchivo),Z),c(),f(t.currentStatus.contenido?2:-1)}}function hi(i,e){if(i&1&&(r(0,"div",22),x(1,pi,3,3,"div",23)(2,gi,3,2,"div",24),s()),i&2){let t=l();L("text-status",t.currentStatus.tipo==="Texto"),c(),f(t.currentStatus.tipo==="Texto"?1:2)}}var it=class i{constructor(e){this.statusService=e}contact=Ft.required();close=ue();progressInterval;progressDuration=5e3;progress=b(0);isPaused=b(!1);apiUrl=$.apiUrl.replace("/api","");ngOnInit(){this.startProgress(),this.markCurrentAsViewed()}ngOnDestroy(){this.stopProgress()}get currentStatus(){let e=this.contact(),t=this.statusService.currentStatusIndex();return e.estados[t]||null}get totalStatuses(){return this.contact().estados.length}get currentIndex(){return this.statusService.currentStatusIndex()}startProgress(){let e=Date.now();this.progressInterval=window.setInterval(()=>{if(this.isPaused())return;let n=(Date.now()-e)/this.progressDuration*100;n>=100?this.goNext():this.progress.set(n)},50)}stopProgress(){this.progressInterval&&clearInterval(this.progressInterval)}resetProgress(){this.stopProgress(),this.progress.set(0),this.startProgress(),this.markCurrentAsViewed()}markCurrentAsViewed(){let e=this.currentStatus;e&&!e.vioPorMi&&this.statusService.markAsViewed(e.id).subscribe()}goNext(){this.statusService.nextStatus()?this.resetProgress():this.close.emit()}goPrevious(){this.statusService.previousStatus()&&this.resetProgress()}onLeftClick(e){e.stopPropagation(),this.goPrevious()}onRightClick(e){e.stopPropagation(),this.goNext()}onClose(){this.close.emit()}onMouseDown(){this.isPaused.set(!0)}onMouseUp(){this.isPaused.set(!1)}onTouchStart(){this.isPaused.set(!0)}onTouchEnd(){this.isPaused.set(!1)}onKeyDown(e){switch(e.key){case"ArrowLeft":this.goPrevious();break;case"ArrowRight":case" ":this.goNext();break;case"Escape":this.close.emit();break}}getImageUrl(e){return e.startsWith("http")?e:`${this.apiUrl}${e}`}getContactImage(){let e=this.contact();return e.usuarioFoto?e.usuarioFoto.startsWith("http")?e.usuarioFoto:`${this.apiUrl}${e.usuarioFoto}`:null}formatTime(e){return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(t){return new(t||i)(I(me))};static \u0275cmp=U({type:i,selectors:[["app-status-viewer"]],hostBindings:function(t,n){t&1&&g("mousedown",function(){return n.onMouseDown()})("mouseup",function(){return n.onMouseUp()})("touchstart",function(){return n.onTouchStart()})("touchend",function(){return n.onTouchEnd()})("keydown",function(a){return n.onKeyDown(a)},!1,Wt)},inputs:{contact:[1,"contact"]},outputs:{close:"close"},decls:25,vars:8,consts:[[1,"status-viewer"],[1,"progress-bars"],[1,"progress-bar"],[1,"viewer-header"],[1,"close-btn",3,"click"],["viewBox","0 0 24 24","width","24","height","24"],["fill","currentColor","d","M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"],[1,"user-info"],["alt","",1,"avatar-img",3,"src"],[1,"avatar"],[1,"user-details"],[1,"user-name"],[1,"status-time"],[1,"status-content",3,"text-status"],[1,"nav-area","left",3,"click"],[1,"nav-area","right",3,"click"],[1,"nav-indicators"],[1,"indicator"],["viewBox","0 0 24 24","width","32","height","32"],["fill","currentColor","d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"],["fill","currentColor","d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"],[1,"progress-fill"],[1,"status-content"],[1,"text-content",3,"background"],[1,"image-content"],[1,"text-content"],["alt","",3,"src"],[1,"caption"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1),H(2,si,2,2,"div",2,ai),s(),r(4,"header",3)(5,"button",4),g("click",function(){return n.onClose()}),w(),r(6,"svg",5),h(7,"path",6),s()(),k(),r(8,"div",7),x(9,ci,1,1,"img",8)(10,li,2,1,"div",9),r(11,"div",10)(12,"span",11),d(13),s(),x(14,di,2,1,"span",12),s()()(),x(15,hi,3,3,"div",13),r(16,"div",14),g("click",function(a){return n.onLeftClick(a)}),s(),r(17,"div",15),g("click",function(a){return n.onRightClick(a)}),s(),r(18,"div",16)(19,"div",17),w(),r(20,"svg",18),h(21,"path",19),s()(),k(),r(22,"div",17),w(),r(23,"svg",18),h(24,"path",20),s()()()()),t&2&&(c(2),B(n.contact().estados),c(7),f(n.getContactImage()?9:10),c(4),P(n.contact().usuarioNombre),c(),f(n.currentStatus?14:-1),c(),f(n.currentStatus?15:-1),c(4),L("visible",n.currentIndex>0),c(3),L("visible",n.currentIndex<n.totalStatuses-1))},dependencies:[F],styles:[".status-viewer[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000;z-index:2000;display:flex;flex-direction:column}.progress-bars[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;display:flex;gap:4px;padding:8px 12px;z-index:10}.progress-bar[_ngcontent-%COMP%]{flex:1;height:3px;background:#ffffff4d;border-radius:2px;overflow:hidden}.progress-fill[_ngcontent-%COMP%]{height:100%;background:#fff;border-radius:2px;transition:width .05s linear}.viewer-header[_ngcontent-%COMP%]{position:absolute;top:20px;left:0;right:0;display:flex;align-items:center;padding:8px 16px;z-index:10;background:linear-gradient(to bottom,rgba(0,0,0,.5),transparent)}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:8px;margin-right:8px}.close-btn[_ngcontent-%COMP%]:hover{opacity:.8}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.avatar-img[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover}.avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:#00a884;color:#fff;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:500}.user-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.user-name[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:500}.status-time[_ngcontent-%COMP%]{color:#ffffffb3;font-size:13px}.status-content[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;padding:60px 20px 20px}.status-content.text-status[_ngcontent-%COMP%]{padding:80px 20px}.text-content[_ngcontent-%COMP%]{width:100%;max-width:400px;min-height:200px;display:flex;align-items:center;justify-content:center;padding:40px 30px;border-radius:12px}.text-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;font-size:24px;font-weight:500;text-align:center;line-height:1.4;margin:0;word-break:break-word}.image-content[_ngcontent-%COMP%]{position:relative;max-width:100%;max-height:100%;display:flex;flex-direction:column;align-items:center}.image-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:calc(100vh - 160px);object-fit:contain;border-radius:8px}.image-content[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:50%;transform:translate(-50%);background:#0009;color:#fff;padding:8px 16px;border-radius:8px;font-size:14px;max-width:80%;text-align:center;word-break:break-word}.nav-area[_ngcontent-%COMP%]{position:absolute;top:100px;bottom:0;width:30%;cursor:pointer;z-index:5}.nav-area.left[_ngcontent-%COMP%]{left:0}.nav-area.right[_ngcontent-%COMP%]{right:0}.nav-indicators[_ngcontent-%COMP%]{position:absolute;top:50%;left:0;right:0;transform:translateY(-50%);display:flex;justify-content:space-between;padding:0 8px;pointer-events:none;z-index:4}.nav-indicators[_ngcontent-%COMP%]   .indicator[_ngcontent-%COMP%]{color:#ffffff80;opacity:0;transition:opacity .3s}.nav-indicators[_ngcontent-%COMP%]   .indicator.visible[_ngcontent-%COMP%]{opacity:1}@media (max-width: 768px){.text-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:20px}.nav-area[_ngcontent-%COMP%]{width:40%}}"]})};var ze=class i{STORAGE_KEY="notification_settings";audioContext=null;settings=b(this.loadSettings());soundOptions=[{id:"whatsapp",name:"WhatsApp Cl\xE1sico",type:"whatsapp"},{id:"soft",name:"Tono Suave",type:"soft"},{id:"discrete",name:"Tono Discreto",type:"discrete"},{id:"none",name:"Sin sonido",type:"none"}];loadSettings(){let e=localStorage.getItem(this.STORAGE_KEY);if(e)try{return JSON.parse(e)}catch{return this.getDefaultSettings()}return this.getDefaultSettings()}getDefaultSettings(){return{soundEnabled:!0,soundType:"whatsapp",volume:70,playWhenFocused:!1}}updateSettings(e){let t=this.settings(),n=y(y({},t),e);this.settings.set(n),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n))}playNotificationSound(){return v(this,null,function*(){let e=this.settings();if(!(!e.soundEnabled||e.soundType==="none")&&!(!e.playWhenFocused&&document.hasFocus()))try{yield this.playGeneratedSound(e.soundType,e.volume)}catch(t){console.log("Could not play notification sound:",t)}})}playTestSound(){return v(this,null,function*(){let e=this.settings();if(e.soundType!=="none")try{yield this.playGeneratedSound(e.soundType,e.volume)}catch(t){console.log("Could not play test sound:",t)}})}playGeneratedSound(e,t){return v(this,null,function*(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&(yield this.audioContext.resume());let n=this.audioContext,o=n.createGain();switch(o.connect(n.destination),o.gain.value=t/100,e){case"whatsapp":yield this.playWhatsAppTone(n,o);break;case"soft":yield this.playSoftTone(n,o);break;case"discrete":yield this.playDiscreteTone(n,o);break}})}playWhatsAppTone(e,t){return v(this,null,function*(){let n=[523.25,659.25],o=.15;for(let a=0;a<n.length;a++){let p=e.createOscillator(),C=e.createGain();p.connect(C),C.connect(t),p.type="sine",p.frequency.value=n[a];let M=e.currentTime+a*o;C.gain.setValueAtTime(.3,M),C.gain.exponentialRampToValueAtTime(.01,M+o),p.start(M),p.stop(M+o)}})}playSoftTone(e,t){return v(this,null,function*(){let n=e.createOscillator(),o=e.createGain();n.connect(o),o.connect(t),n.type="sine",n.frequency.value=880,o.gain.setValueAtTime(.3,e.currentTime),o.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),n.start(e.currentTime),n.stop(e.currentTime+.5)})}playDiscreteTone(e,t){return v(this,null,function*(){let n=e.createOscillator(),o=e.createGain();n.connect(o),o.connect(t),n.type="sine",n.frequency.value=1200,o.gain.setValueAtTime(.2,e.currentTime),o.gain.exponentialRampToValueAtTime(.01,e.currentTime+.08),n.start(e.currentTime),n.stop(e.currentTime+.1)})}shouldPlaySound(e,t,n,o){let a=this.settings();return!(!a.soundEnabled||a.soundType==="none"||e===t||n===o&&!a.playWhenFocused)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};var mi=(i,e)=>e.id;function _i(i,e){if(i&1&&(r(0,"option",15),d(1),s()),i&2){let t=e.$implicit;R("value",t.type),c(),P(t.name)}}function fi(i,e){if(i&1){let t=S();r(0,"div",7)(1,"div",8)(2,"span",9),d(3,"Tipo de sonido"),s()(),r(4,"select",14),Q("ngModelChange",function(o){m(t);let a=l();return K(a.soundType,o)||(a.soundType=o),_(o)}),H(5,_i,2,2,"option",15,mi),s()(),r(7,"div",16)(8,"div",8)(9,"span",9),d(10,"Volumen"),s(),r(11,"span",17),d(12),s()(),r(13,"input",18),Q("ngModelChange",function(o){m(t);let a=l();return K(a.volume,o)||(a.volume=o),_(o)}),s()(),r(14,"div",7)(15,"div",8)(16,"span",9),d(17,"Sonar con app activa"),s(),r(18,"span",10),d(19,"Reproducir sonido incluso cuando est\xE1s viendo el chat"),s()(),r(20,"label",11)(21,"input",12),Q("ngModelChange",function(o){m(t);let a=l();return K(a.playWhenFocused,o)||(a.playWhenFocused=o),_(o)}),s(),h(22,"span",13),s()(),r(23,"div",7)(24,"button",19),g("click",function(){m(t);let o=l();return _(o.testSound())}),w(),r(25,"svg",20),h(26,"path",21),s(),d(27," Probar sonido "),s()()}if(i&2){let t=l();c(4),q("ngModel",t.soundType),c(),B(t.soundOptions),c(7),E("",t.volume,"%"),c(),q("ngModel",t.volume),c(8),q("ngModel",t.playWhenFocused),c(3),R("disabled",t.soundType==="none")}}var ot=class i{notificationSettings=be(ze);close=ue();settings=this.notificationSettings.settings;soundOptions=this.notificationSettings.soundOptions;get soundEnabled(){return this.settings().soundEnabled}set soundEnabled(e){this.notificationSettings.updateSettings({soundEnabled:e})}get soundType(){return this.settings().soundType}set soundType(e){this.notificationSettings.updateSettings({soundType:e})}get volume(){return this.settings().volume}set volume(e){this.notificationSettings.updateSettings({volume:e})}get playWhenFocused(){return this.settings().playWhenFocused}set playWhenFocused(e){this.notificationSettings.updateSettings({playWhenFocused:e})}testSound(){this.notificationSettings.playTestSound()}onClose(){this.close.emit()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=U({type:i,selectors:[["app-notification-settings"]],outputs:{close:"close"},decls:19,vars:2,consts:[[1,"settings-overlay",3,"click"],[1,"settings-panel",3,"click"],[1,"settings-header"],[1,"back-btn",3,"click"],["viewBox","0 0 24 24","width","24","height","24"],["fill","currentColor","d","M12 4l1.4 1.4L7.8 11H20v2H7.8l5.6 5.6L12 20l-8-8 8-8z"],[1,"settings-content"],[1,"setting-item"],[1,"setting-info"],[1,"setting-label"],[1,"setting-description"],[1,"toggle"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"slider"],[1,"sound-select",3,"ngModelChange","ngModel"],[3,"value"],[1,"setting-item","column"],[1,"volume-value"],["type","range","min","0","max","100",1,"volume-slider",3,"ngModelChange","ngModel"],[1,"test-btn",3,"click","disabled"],["viewBox","0 0 24 24","width","20","height","20"],["fill","currentColor","d","M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"]],template:function(t,n){t&1&&(r(0,"div",0),g("click",function(){return n.onClose()}),r(1,"div",1),g("click",function(a){return a.stopPropagation()}),r(2,"header",2)(3,"button",3),g("click",function(){return n.onClose()}),w(),r(4,"svg",4),h(5,"path",5),s()(),k(),r(6,"h2"),d(7,"Notificaciones"),s()(),r(8,"div",6)(9,"div",7)(10,"div",8)(11,"span",9),d(12,"Sonido de notificaci\xF3n"),s(),r(13,"span",10),d(14,"Reproducir sonido al recibir mensajes"),s()(),r(15,"label",11)(16,"input",12),Q("ngModelChange",function(a){return K(n.soundEnabled,a)||(n.soundEnabled=a),a}),s(),h(17,"span",13),s()(),x(18,fi,28,5),s()()()),t&2&&(c(16),q("ngModel",n.soundEnabled),c(2),f(n.soundEnabled?18:-1))},dependencies:[F,se,Kt,Qt,oe,Gt,Bt,qt,re,ae],styles:['.settings-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0006;display:flex;align-items:center;justify-content:center;z-index:1000}.settings-panel[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:12px;width:90%;max-width:420px;max-height:80vh;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 4px 20px #00000026}.settings-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:16px 20px;background:var(--accent);color:#fff}.settings-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]{border:none;background:none;cursor:pointer;color:#fff;padding:4px;display:flex;align-items:center;justify-content:center;border-radius:50%}.settings-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.settings-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:500}.settings-content[_ngcontent-%COMP%]{padding:16px 20px;overflow-y:auto}.setting-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px 0;border-bottom:1px solid var(--border-color)}.setting-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.setting-item.column[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:12px}.setting-item.column[_ngcontent-%COMP%]   .setting-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.setting-item[_ngcontent-%COMP%]   .setting-info[_ngcontent-%COMP%]{flex:1;margin-right:16px}.setting-item[_ngcontent-%COMP%]   .setting-info[_ngcontent-%COMP%]   .setting-label[_ngcontent-%COMP%]{display:block;font-size:15px;color:var(--text-primary);margin-bottom:2px}.setting-item[_ngcontent-%COMP%]   .setting-info[_ngcontent-%COMP%]   .setting-description[_ngcontent-%COMP%]{display:block;font-size:13px;color:var(--text-secondary)}.setting-item[_ngcontent-%COMP%]   .setting-info[_ngcontent-%COMP%]   .volume-value[_ngcontent-%COMP%]{font-size:14px;color:var(--accent);font-weight:500}.toggle[_ngcontent-%COMP%]{position:relative;width:48px;height:24px;flex-shrink:0}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background:var(--accent)}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(24px)}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;inset:0;background:var(--border-color);border-radius:24px;transition:.3s}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{position:absolute;content:"";height:20px;width:20px;left:2px;bottom:2px;background:#fff;border-radius:50%;transition:.3s;box-shadow:0 1px 3px #0003}.sound-select[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid var(--border-color);border-radius:8px;background:var(--bg-primary);color:var(--text-primary);font-size:14px;cursor:pointer;min-width:150px}.sound-select[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--accent)}.volume-slider[_ngcontent-%COMP%]{width:100%;height:4px;border-radius:2px;background:var(--border-color);appearance:none;cursor:pointer}.volume-slider[_ngcontent-%COMP%]::-webkit-slider-thumb{appearance:none;width:18px;height:18px;border-radius:50%;background:var(--accent);cursor:pointer;box-shadow:0 1px 3px #0003}.volume-slider[_ngcontent-%COMP%]::-moz-range-thumb{width:18px;height:18px;border:none;border-radius:50%;background:var(--accent);cursor:pointer;box-shadow:0 1px 3px #0003}.test-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:12px 16px;border:none;background:var(--accent);color:#fff;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.test-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--accent-dark);transform:scale(1.02)}.test-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.test-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0}@media (max-width: 480px){.settings-panel[_ngcontent-%COMP%]{width:100%;max-width:none;height:100%;max-height:none;border-radius:0}}']})};var rt=class i{STORAGE_KEY="whatsapp-theme";currentTheme=b(this.getInitialTheme());isDarkMode=b(this.currentTheme()==="dark");constructor(){this.applyTheme(this.currentTheme()),Le(()=>{this.isDarkMode.set(this.currentTheme()==="dark")}),this.listenToSystemPreference()}getInitialTheme(){let e=localStorage.getItem(this.STORAGE_KEY);return e==="light"||e==="dark"?e:window.matchMedia?.("(prefers-color-scheme: dark)").matches?"dark":"light"}applyTheme(e){e==="dark"?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.removeAttribute("data-theme")}listenToSystemPreference(){let e=window.matchMedia?.("(prefers-color-scheme: dark)");e&&e.addEventListener("change",t=>{localStorage.getItem(this.STORAGE_KEY)||this.setTheme(t.matches?"dark":"light",!1)})}setTheme(e,t=!0){this.currentTheme.set(e),this.applyTheme(e),t&&localStorage.setItem(this.STORAGE_KEY,e)}toggleTheme(){let e=this.currentTheme()==="light"?"dark":"light";this.setTheme(e)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};var Yt=(i,e)=>e.id;function xi(i,e){if(i&1&&h(0,"img",3),i&2){let t=l();R("src",t.getUserProfileImage(),Z)}}function bi(i,e){if(i&1&&(r(0,"div",4),d(1),s()),i&2){let t,n=l();c(),E(" ",((t=n.authService.currentUser())==null||t.nombre==null?null:t.nombre.charAt(0))||"U"," ")}}function Mi(i,e){i&1&&(w(),r(0,"svg",7),h(1,"path",19),s())}function wi(i,e){i&1&&(w(),r(0,"svg",7),h(1,"path",20),s())}function Si(i,e){if(i&1){let t=S();r(0,"button",21),g("click",function(){m(t);let o=l();return _(o.openCreateStatus())}),w(),r(1,"svg",7),h(2,"path",22),s()()}}function Pi(i,e){if(i&1){let t=S();r(0,"button",23),g("click",function(){m(t);let o=l();return _(o.openNewChat())}),w(),r(1,"svg",7),h(2,"path",22),s()()}}function yi(i,e){i&1&&(w(),r(0,"svg",36),h(1,"path",41),s())}function Oi(i,e){if(i&1&&(r(0,"span",37),d(1),Ie(2,"date"),s()),i&2){let t=l().$implicit;c(),E(" ",Ve(2,1,t.ultimoMensaje.fechaEnvio,"shortTime")," ")}}function ki(i,e){if(i&1&&(r(0,"span",40),d(1),s()),i&2){let t=l().$implicit;c(),P(t.mensajesNoLeidos)}}function Ti(i,e){if(i&1){let t=S();r(0,"div",32),g("click",function(){let o=m(t).$implicit,a=l(2);return _(a.selectChat(o))})("contextmenu",function(o){let a=m(t).$implicit,p=l(2);return _(p.onChatContextMenu(o,a))}),r(1,"div",4),d(2),s(),r(3,"div",33)(4,"div",34)(5,"span",35),d(6),x(7,yi,2,0,":svg:svg",36),s(),x(8,Oi,3,4,"span",37),s(),r(9,"div",38)(10,"span",39),d(11),s(),x(12,ki,2,1,"span",40),s()()()}if(i&2){let t,n=e.$implicit,o=l(2);L("active",((t=o.chatService.selectedChat())==null?null:t.id)===n.id),c(2),E(" ",o.getChatName(n).charAt(0)," "),c(4),E(" ",o.getChatName(n)," "),c(),f(n.silenciado?7:-1),c(),f(n.ultimoMensaje?8:-1),c(3),P(o.getLastMessagePreview(n)),c(),f(n.mensajesNoLeidos>0?12:-1)}}function Ei(i,e){if(i&1){let t=S();r(0,"div",30)(1,"p"),d(2,"No tienes conversaciones a\xFAn"),s(),r(3,"button",42),g("click",function(){m(t);let o=l(2);return _(o.openNewChat())}),d(4," Iniciar nuevo chat "),s()()}}function Ii(i,e){i&1&&(w(),r(0,"svg",52),h(1,"path",41),s())}function Vi(i,e){if(i&1&&(r(0,"span",37),d(1),Ie(2,"date"),s()),i&2){let t=l().$implicit;c(),E(" ",Ve(2,1,t.ultimoMensaje.fechaEnvio,"shortTime")," ")}}function Ri(i,e){if(i&1){let t=S();r(0,"div",51),g("click",function(){let o=m(t).$implicit,a=l(4);return _(a.selectChat(o))}),r(1,"div",4),d(2),s(),r(3,"div",33)(4,"div",34)(5,"span",35),d(6),x(7,Ii,2,0,":svg:svg",52),s(),x(8,Vi,3,4,"span",37),s(),r(9,"div",38)(10,"span",39),d(11),s(),r(12,"button",53),g("click",function(o){let a=m(t).$implicit;return l(4).unarchiveChat(a),_(o.stopPropagation())}),w(),r(13,"svg",54),h(14,"path",55),s()()()()()}if(i&2){let t,n=e.$implicit,o=l(4);L("active",((t=o.chatService.selectedChat())==null?null:t.id)===n.id),c(2),E(" ",o.getChatName(n).charAt(0)," "),c(4),E(" ",o.getChatName(n)," "),c(),f(n.silenciado?7:-1),c(),f(n.ultimoMensaje?8:-1),c(3),P(o.getLastMessagePreview(n))}}function Li(i,e){if(i&1&&(r(0,"div",49),H(1,Ri,15,7,"div",50,Yt),s()),i&2){let t=l(3);c(),B(t.chatService.archivedChats())}}function Di(i,e){if(i&1){let t=S();r(0,"div",31)(1,"div",43),g("click",function(){m(t);let o=l(2);return _(o.toggleArchivedChats())}),w(),r(2,"svg",44),h(3,"path",45),s(),k(),r(4,"span"),d(5,"Chats archivados"),s(),r(6,"span",46),d(7),s(),w(),r(8,"svg",47),h(9,"path",48),s()(),x(10,Li,3,0,"div",49),s()}if(i&2){let t=l(2);c(7),P(t.chatService.archivedChats().length),c(),L("rotated",t.showArchivedChats()),c(2),f(t.showArchivedChats()?10:-1)}}function Ai(i,e){if(i&1){let t=S();r(0,"div",24)(1,"div",25),w(),r(2,"svg",7),h(3,"path",26),s(),k(),r(4,"input",27),Q("ngModelChange",function(o){m(t);let a=l();return K(a.searchQuery,o)||(a.searchQuery=o),_(o)}),s()()(),r(5,"div",28),g("click",function(o){m(t);let a=l();return _(a.onDocumentClick(o))}),H(6,Ti,13,8,"div",29,Yt,!1,Ei,5,0,"div",30),x(9,Di,11,4,"div",31),s()}if(i&2){let t=l();c(4),q("ngModel",t.searchQuery),c(2),B(t.chatService.chats()),c(3),f(t.chatService.archivedChats().length>0||t.showArchivedChats()?9:-1)}}function zi(i,e){if(i&1){let t=S();r(0,"app-status-list",56),g("openCreateStatus",function(){m(t);let o=l();return _(o.openCreateStatus())})("openViewer",function(o){m(t);let a=l();return _(a.openStatusViewer(o))})("openMyStatuses",function(){m(t);let o=l();return _(o.openMyStatuses())}),s()}}function Ni(i,e){if(i&1){let t=S();r(0,"app-new-chat-modal",57),g("close",function(){m(t);let o=l();return _(o.closeNewChatModal())}),s()}}function $i(i,e){if(i&1){let t=S();r(0,"app-profile",57),g("close",function(){m(t);let o=l();return _(o.closeProfile())}),s()}}function Ui(i,e){if(i&1){let t=S();r(0,"app-create-status",57),g("close",function(){m(t);let o=l();return _(o.closeCreateStatus())}),s()}}function Fi(i,e){if(i&1){let t=S();r(0,"app-status-viewer",58),g("close",function(){m(t);let o=l();return _(o.closeStatusViewer())}),s()}if(i&2){let t=l();R("contact",t.selectedContactForViewer())}}function Wi(i,e){if(i&1){let t=S();r(0,"button",62),g("click",function(){m(t);let o=l(2);return _(o.unmuteChat(o.contextMenuChat()))}),w(),r(1,"svg",44),h(2,"path",63),s(),k(),r(3,"span"),d(4,"Quitar silencio"),s()()}}function ji(i,e){if(i&1){let t=S();r(0,"button",62),g("click",function(){m(t);let o=l(2);return _(o.openMuteModal(o.contextMenuChat()))}),w(),r(1,"svg",44),h(2,"path",41),s(),k(),r(3,"span"),d(4,"Silenciar"),s()()}}function Hi(i,e){if(i&1){let t=S();r(0,"div",59),g("click",function(){m(t);let o=l();return _(o.closeContextMenu())}),s(),r(1,"div",60),x(2,Wi,5,0,"button",61)(3,ji,5,0,"button",61),r(4,"button",62),g("click",function(){m(t);let o=l();return _(o.archiveChat(o.contextMenuChat()))}),w(),r(5,"svg",44),h(6,"path",45),s(),k(),r(7,"span"),d(8,"Archivar"),s()()()}if(i&2){let t=l();c(),ge("left",t.contextMenuPosition().x,"px")("top",t.contextMenuPosition().y,"px"),c(),f(t.contextMenuChat().silenciado?2:3)}}function Bi(i,e){if(i&1){let t=S();r(0,"div",64),g("click",function(){m(t);let o=l();return _(o.closeMuteModal())}),r(1,"div",65),g("click",function(o){return m(t),_(o.stopPropagation())}),r(2,"div",66)(3,"h3"),d(4,"Silenciar notificaciones"),s(),r(5,"button",67),g("click",function(){m(t);let o=l();return _(o.closeMuteModal())}),w(),r(6,"svg",7),h(7,"path",68),s()()(),k(),r(8,"div",69)(9,"p"),d(10,"\xBFPor cu\xE1nto tiempo deseas silenciar este chat?"),s(),r(11,"div",70)(12,"button",71),g("click",function(){m(t);let o=l();return _(o.muteChat("8h"))}),w(),r(13,"svg",7),h(14,"path",72),s(),k(),r(15,"span"),d(16,"8 horas"),s()(),r(17,"button",71),g("click",function(){m(t);let o=l();return _(o.muteChat("1w"))}),w(),r(18,"svg",7),h(19,"path",73),s(),k(),r(20,"span"),d(21,"1 semana"),s()(),r(22,"button",71),g("click",function(){m(t);let o=l();return _(o.muteChat("always"))}),w(),r(23,"svg",7),h(24,"path",41),s(),k(),r(25,"span"),d(26,"Siempre"),s()()()()()()}}function Gi(i,e){if(i&1){let t=S();r(0,"app-notification-settings",57),g("close",function(){m(t);let o=l();return _(o.closeNotificationSettings())}),s()}}var at=class i{constructor(e,t,n,o){this.chatService=e;this.authService=t;this.statusService=n;this.themeService=o}searchQuery="";showNewChatModal=b(!1);showProfilePanel=b(!1);activeTab=b("chats");showCreateStatus=b(!1);showStatusViewer=b(!1);selectedContactForViewer=b(null);showContextMenu=b(!1);contextMenuPosition=b({x:0,y:0});contextMenuChat=b(null);showMuteModal=b(!1);chatToMute=b(null);showArchivedChats=b(!1);showNotificationSettings=b(!1);apiBaseUrl=$.apiUrl.replace("/api","");selectChat(e){this.chatService.selectChat(e)}getChatName(e){return e.tipo==="Grupo"?e.nombreGrupo||"Grupo":e.otroParticipante?.nombre||"Usuario"}getChatImage(e){return e.tipo==="Grupo"?e.imagenGrupo||"assets/default-group.png":e.otroParticipante?.fotoPerfil||"assets/default-avatar.png"}getLastMessagePreview(e){return e.ultimoMensaje?e.ultimoMensaje.eliminadoParaTodos?"Mensaje eliminado":e.ultimoMensaje.tipo!=="Texto"?`\u{1F4CE} ${e.ultimoMensaje.tipo}`:e.ultimoMensaje.contenido||"":""}openNewChat(){this.showNewChatModal.set(!0)}closeNewChatModal(){this.showNewChatModal.set(!1)}logout(){this.authService.logout()}openProfile(){this.showProfilePanel.set(!0)}closeProfile(){this.showProfilePanel.set(!1)}getUserProfileImage(){let e=this.authService.currentUser();return e?.fotoPerfil?e.fotoPerfil.startsWith("http")?e.fotoPerfil:`${this.apiBaseUrl}${e.fotoPerfil}`:null}setActiveTab(e){this.activeTab.set(e)}openCreateStatus(){this.showCreateStatus.set(!0)}closeCreateStatus(){this.showCreateStatus.set(!1)}openStatusViewer(e){this.selectedContactForViewer.set(e),this.showStatusViewer.set(!0)}closeStatusViewer(){this.showStatusViewer.set(!1),this.selectedContactForViewer.set(null),this.statusService.selectContactStatuses(null)}openMyStatuses(){let e=this.authService.currentUser();if(e&&this.statusService.myStatuses().estados.length>0){let t={usuarioId:e.id,usuarioNombre:e.nombre,usuarioFoto:e.fotoPerfil,estados:this.statusService.myStatuses().estados,todosVistos:!0,ultimaActualizacion:new Date};this.openStatusViewer(t)}}onChatContextMenu(e,t){e.preventDefault(),this.contextMenuChat.set(t),this.contextMenuPosition.set({x:e.clientX,y:e.clientY}),this.showContextMenu.set(!0)}closeContextMenu(){this.showContextMenu.set(!1),this.contextMenuChat.set(null)}openMuteModal(e){this.chatToMute.set(e),this.showMuteModal.set(!0),this.closeContextMenu()}closeMuteModal(){this.showMuteModal.set(!1),this.chatToMute.set(null)}muteChat(e){let t=this.chatToMute();t&&this.chatService.muteChat(t.id,e).subscribe(()=>{this.closeMuteModal()})}unmuteChat(e){this.chatService.unmuteChat(e.id).subscribe(),this.closeContextMenu()}archiveChat(e){this.chatService.archiveChat(e.id).subscribe(),this.closeContextMenu()}unarchiveChat(e){this.chatService.unarchiveChat(e.id).subscribe()}toggleArchivedChats(){let e=!this.showArchivedChats();this.showArchivedChats.set(e),e&&this.chatService.getArchivedChats().subscribe()}onDocumentClick(e){this.showContextMenu()&&this.closeContextMenu()}openNotificationSettings(){this.showNotificationSettings.set(!0)}closeNotificationSettings(){this.showNotificationSettings.set(!1)}static \u0275fac=function(t){return new(t||i)(I(ce),I(he),I(me),I(rt))};static \u0275cmp=U({type:i,selectors:[["app-chat-list"]],decls:32,vars:16,consts:[[1,"chat-list-container"],[1,"header"],["title","Ver perfil",1,"user-info",3,"click"],["alt","Mi foto",1,"avatar-img",3,"src"],[1,"avatar"],[1,"actions"],["title","Configuraci\xF3n de notificaciones",1,"icon-btn",3,"click"],["viewBox","0 0 24 24","width","24","height","24"],["fill","currentColor","d","M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"],[1,"icon-btn",3,"click","title"],["title","Nuevo estado",1,"icon-btn"],["title","Nuevo chat",1,"icon-btn"],["title","Cerrar sesi\xF3n",1,"icon-btn",3,"click"],["fill","currentColor","d","M16 13v-2H7V8l-5 4 5 4v-3h9z"],["fill","currentColor","d","M20 3H8a2 2 0 0 0-2 2v4h2V5h12v14H8v-4H6v4a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"],[1,"tabs"],[1,"tab",3,"click"],[3,"contact"],[1,"modal-overlay"],["fill","currentColor","d","M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 0 0-1.41 0 .996.996 0 0 0 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 0 0-1.41 0 .996.996 0 0 0 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 0 0 0-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 0 0 0-1.41.996.996 0 0 0-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 0 0 0-1.41.996.996 0 0 0-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"],["fill","currentColor","d","M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"],["title","Nuevo estado",1,"icon-btn",3,"click"],["fill","currentColor","d","M19.005 3.175H4.674C3.642 3.175 3 3.789 3 4.821V21.02l3.544-3.514h12.461c1.033 0 2.064-1.06 2.064-2.093V4.821c-.001-1.032-1.032-1.646-2.064-1.646zm-4.989 9.869H7.041V11.1h6.975v1.944zm3-4H7.041V7.1h9.975v1.944z"],["title","Nuevo chat",1,"icon-btn",3,"click"],[1,"search-container"],[1,"search-box"],["fill","#54656f","d","M15.009 13.805h-.636l-.22-.219a5.184 5.184 0 0 0 1.256-3.386 5.207 5.207 0 1 0-5.207 5.208 5.183 5.183 0 0 0 3.385-1.255l.221.22v.635l4.004 3.999 1.194-1.195-3.997-4.007zm-4.808 0a3.605 3.605 0 1 1 0-7.21 3.605 3.605 0 0 1 0 7.21z"],["type","text","placeholder","Buscar o empezar un chat nuevo",3,"ngModelChange","ngModel"],[1,"chats-list",3,"click"],[1,"chat-item",3,"active"],[1,"no-chats"],[1,"archived-section"],[1,"chat-item",3,"click","contextmenu"],[1,"chat-info"],[1,"chat-header"],[1,"chat-name"],["viewBox","0 0 24 24","width","16","height","16","title","Silenciado",1,"muted-icon"],[1,"chat-time"],[1,"chat-preview"],[1,"last-message"],[1,"unread-badge"],["fill","currentColor","d","M12 4L9.91 6.09L12 8.18M4.27 3L3 4.27L7.73 9H3V15H7L12 20V13.27L16.25 17.52C15.58 18.04 14.83 18.45 14 18.7V20.77C15.38 20.45 16.63 19.82 17.68 18.95L19.73 21L21 19.73L12 10.73M19 12C19 12.94 18.8 13.82 18.46 14.64L19.97 16.15C20.62 14.91 21 13.5 21 12C21 7.72 18 4.14 14 3.23V5.29C16.89 6.15 19 8.83 19 12M16.5 12C16.5 10.23 15.5 8.71 14 7.97V10.18L16.45 12.63C16.5 12.43 16.5 12.21 16.5 12Z"],[1,"start-chat-btn",3,"click"],[1,"archived-header",3,"click"],["viewBox","0 0 24 24","width","20","height","20"],["fill","currentColor","d","M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 17.5L6.5 12H10v-2h4v2h3.5L12 17.5zM5.12 5l.81-1h12l.94 1H5.12z"],[1,"archived-count"],["viewBox","0 0 24 24","width","20","height","20",1,"chevron"],["fill","currentColor","d","M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"],[1,"archived-list"],[1,"chat-item","archived",3,"active"],[1,"chat-item","archived",3,"click"],["viewBox","0 0 24 24","width","16","height","16",1,"muted-icon"],["title","Desarchivar",1,"unarchive-btn",3,"click"],["viewBox","0 0 24 24","width","18","height","18"],["fill","currentColor","d","M20.55 5.22l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.15.55L3.46 5.22C3.17 5.57 3 6.01 3 6.5V19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.49-.17-.93-.45-1.28zM12 9.5l5.5 5.5H14v2h-4v-2H6.5L12 9.5zM5.12 5l.82-1h12l.93 1H5.12z"],[3,"openCreateStatus","openViewer","openMyStatuses"],[3,"close"],[3,"close","contact"],[1,"context-menu-overlay",3,"click"],[1,"context-menu"],[1,"context-menu-item"],[1,"context-menu-item",3,"click"],["fill","currentColor","d","M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"],[1,"modal-overlay",3,"click"],[1,"mute-modal",3,"click"],[1,"mute-modal-header"],[1,"close-btn",3,"click"],["fill","currentColor","d","M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"],[1,"mute-modal-body"],[1,"mute-options"],[1,"mute-option",3,"click"],["fill","currentColor","d","M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"],["fill","currentColor","d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"header",1)(2,"div",2),g("click",function(){return n.openProfile()}),x(3,xi,1,1,"img",3)(4,bi,2,1,"div",4),s(),r(5,"div",5)(6,"button",6),g("click",function(){return n.openNotificationSettings()}),w(),r(7,"svg",7),h(8,"path",8),s()(),k(),r(9,"button",9),g("click",function(){return n.themeService.toggleTheme()}),x(10,Mi,2,0,":svg:svg",7)(11,wi,2,0,":svg:svg",7),s(),x(12,Si,3,0,"button",10)(13,Pi,3,0,"button",11),r(14,"button",12),g("click",function(){return n.logout()}),w(),r(15,"svg",7),h(16,"path",13)(17,"path",14),s()()()(),k(),r(18,"div",15)(19,"button",16),g("click",function(){return n.setActiveTab("chats")}),d(20," Chats "),s(),r(21,"button",16),g("click",function(){return n.setActiveTab("status")}),d(22," Estados "),s()(),x(23,Ai,10,3)(24,zi,1,0,"app-status-list"),s(),x(25,Ni,1,0,"app-new-chat-modal")(26,$i,1,0,"app-profile")(27,Ui,1,0,"app-create-status")(28,Fi,1,1,"app-status-viewer",17)(29,Hi,9,5)(30,Bi,27,0,"div",18)(31,Gi,1,0,"app-notification-settings")),t&2&&(c(3),f(n.getUserProfileImage()?3:4),c(6),R("title",n.themeService.isDarkMode()?"Modo claro":"Modo oscuro"),c(),f(n.themeService.isDarkMode()?10:11),c(2),f(n.activeTab()==="status"?12:13),c(7),L("active",n.activeTab()==="chats"),c(2),L("active",n.activeTab()==="status"),c(2),f(n.activeTab()==="chats"?23:24),c(2),f(n.showNewChatModal()?25:-1),c(),f(n.showProfilePanel()?26:-1),c(),f(n.showCreateStatus()?27:-1),c(),f(n.showStatusViewer()&&n.selectedContactForViewer()?28:-1),c(),f(n.showContextMenu()&&n.contextMenuChat()?29:-1),c(),f(n.showMuteModal()&&n.chatToMute()?30:-1),c(),f(n.showNotificationSettings()?31:-1))},dependencies:[F,Qe,se,oe,re,ae,Ye,Ze,tt,nt,it,ot],styles:['.chat-list-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background:var(--bg-primary)}.header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;background:var(--header-bg)}.header[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;cursor:pointer}.header[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:var(--accent);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:500;transition:opacity .2s}.header[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .avatar-img[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover;transition:opacity .2s}.header[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]:hover   .avatar[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]:hover   .avatar-img[_ngcontent-%COMP%]{opacity:.8}.header[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:8px}.header[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .icon-btn[_ngcontent-%COMP%]{width:40px;height:40px;border:none;background:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--icon-color);transition:background-color .2s,color .2s}.header[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .icon-btn[_ngcontent-%COMP%]:hover{background:var(--hover-bg)}.tabs[_ngcontent-%COMP%]{display:flex;background:var(--header-bg);border-bottom:1px solid var(--border-color)}.tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]{flex:1;padding:14px 20px;border:none;background:none;font-size:14px;font-weight:500;color:var(--icon-color);cursor:pointer;position:relative;transition:color .2s}.tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]:hover, .tabs[_ngcontent-%COMP%]   .tab.active[_ngcontent-%COMP%]{color:var(--accent)}.tabs[_ngcontent-%COMP%]   .tab.active[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:20%;right:20%;height:3px;background:var(--accent);border-radius:3px 3px 0 0}.search-container[_ngcontent-%COMP%]{padding:8px 12px;background:var(--bg-primary)}.search-container[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]{display:flex;align-items:center;background:var(--input-bg);border-radius:8px;padding:0 12px}.search-container[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0;color:var(--icon-color)}.search-container[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:var(--icon-color)}.search-container[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border:none;background:none;padding:10px 12px;font-size:14px;color:var(--text-primary)}.search-container[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none}.search-container[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--text-secondary)}.chats-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;background:var(--bg-primary)}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 16px;cursor:pointer;border-bottom:1px solid var(--border-color);transition:background-color .2s}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]:hover{background:var(--hover-bg)}.chats-list[_ngcontent-%COMP%]   .chat-item.active[_ngcontent-%COMP%]{background:var(--bg-secondary)}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:49px;height:49px;border-radius:50%;color:#fff;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:500;flex-shrink:0;background:linear-gradient(135deg,var(--accent),#25d366)}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]{flex:1;margin-left:15px;overflow:hidden}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2px}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-name[_ngcontent-%COMP%]{font-size:16px;color:var(--text-primary);font-weight:400;display:flex;align-items:center;gap:6px}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-name[_ngcontent-%COMP%]   .muted-icon[_ngcontent-%COMP%]{color:var(--text-secondary);flex-shrink:0}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-time[_ngcontent-%COMP%]{font-size:12px;color:var(--text-secondary)}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .last-message[_ngcontent-%COMP%]{font-size:14px;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:250px}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .unread-badge[_ngcontent-%COMP%]{background:#25d366;color:#fff;font-size:11px;padding:2px 6px;border-radius:10px;min-width:18px;text-align:center}.no-chats[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:40px 20px;text-align:center}.no-chats[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);margin-bottom:15px}.no-chats[_ngcontent-%COMP%]   .start-chat-btn[_ngcontent-%COMP%]{background:var(--accent);color:#fff;border:none;padding:12px 24px;border-radius:24px;font-size:14px;cursor:pointer;transition:background .2s}.no-chats[_ngcontent-%COMP%]   .start-chat-btn[_ngcontent-%COMP%]:hover{background:var(--accent-hover)}.archived-section[_ngcontent-%COMP%]{border-top:1px solid var(--border-color)}.archived-section[_ngcontent-%COMP%]   .archived-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 16px;cursor:pointer;color:var(--accent);transition:background-color .2s}.archived-section[_ngcontent-%COMP%]   .archived-header[_ngcontent-%COMP%]:hover{background:var(--hover-bg)}.archived-section[_ngcontent-%COMP%]   .archived-header[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--accent)}.archived-section[_ngcontent-%COMP%]   .archived-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1;font-size:14px;font-weight:500}.archived-section[_ngcontent-%COMP%]   .archived-header[_ngcontent-%COMP%]   .archived-count[_ngcontent-%COMP%]{font-size:12px;color:var(--text-secondary)}.archived-section[_ngcontent-%COMP%]   .archived-header[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{transition:transform .2s}.archived-section[_ngcontent-%COMP%]   .archived-header[_ngcontent-%COMP%]   .chevron.rotated[_ngcontent-%COMP%]{transform:rotate(180deg)}.archived-section[_ngcontent-%COMP%]   .archived-list[_ngcontent-%COMP%]   .chat-item.archived[_ngcontent-%COMP%]{background:var(--bg-secondary)}.archived-section[_ngcontent-%COMP%]   .archived-list[_ngcontent-%COMP%]   .chat-item.archived[_ngcontent-%COMP%]   .unarchive-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--accent);cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background-color .2s}.archived-section[_ngcontent-%COMP%]   .archived-list[_ngcontent-%COMP%]   .chat-item.archived[_ngcontent-%COMP%]   .unarchive-btn[_ngcontent-%COMP%]:hover{background:var(--hover-bg)}.context-menu-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:999}.context-menu[_ngcontent-%COMP%]{position:fixed;background:var(--bg-primary);border-radius:8px;box-shadow:0 2px 10px #0003;z-index:1000;min-width:180px;overflow:hidden}.context-menu[_ngcontent-%COMP%]   .context-menu-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;width:100%;padding:12px 16px;border:none;background:none;color:var(--text-primary);font-size:14px;cursor:pointer;transition:background-color .2s}.context-menu[_ngcontent-%COMP%]   .context-menu-item[_ngcontent-%COMP%]:hover{background:var(--hover-bg)}.context-menu[_ngcontent-%COMP%]   .context-menu-item[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--icon-color);flex-shrink:0}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.mute-modal[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:12px;width:90%;max-width:360px;overflow:hidden}.mute-modal[_ngcontent-%COMP%]   .mute-modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--border-color)}.mute-modal[_ngcontent-%COMP%]   .mute-modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px;color:var(--text-primary);font-weight:500}.mute-modal[_ngcontent-%COMP%]   .mute-modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--icon-color);cursor:pointer;padding:4px;border-radius:50%;display:flex;align-items:center;justify-content:center}.mute-modal[_ngcontent-%COMP%]   .mute-modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]:hover{background:var(--hover-bg)}.mute-modal[_ngcontent-%COMP%]   .mute-modal-body[_ngcontent-%COMP%]{padding:20px}.mute-modal[_ngcontent-%COMP%]   .mute-modal-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 20px;color:var(--text-secondary);font-size:14px}.mute-modal[_ngcontent-%COMP%]   .mute-modal-body[_ngcontent-%COMP%]   .mute-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.mute-modal[_ngcontent-%COMP%]   .mute-modal-body[_ngcontent-%COMP%]   .mute-options[_ngcontent-%COMP%]   .mute-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:14px 16px;border:1px solid var(--border-color);border-radius:8px;background:none;color:var(--text-primary);font-size:14px;cursor:pointer;transition:background-color .2s,border-color .2s}.mute-modal[_ngcontent-%COMP%]   .mute-modal-body[_ngcontent-%COMP%]   .mute-options[_ngcontent-%COMP%]   .mute-option[_ngcontent-%COMP%]:hover{background:var(--hover-bg);border-color:var(--accent)}.mute-modal[_ngcontent-%COMP%]   .mute-modal-body[_ngcontent-%COMP%]   .mute-options[_ngcontent-%COMP%]   .mute-option[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--accent);flex-shrink:0}@media (max-width: 768px){.header[_ngcontent-%COMP%]{padding:8px 12px}.search-container[_ngcontent-%COMP%]{padding:6px 10px}.search-container[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:8px 10px;font-size:14px}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]{padding:10px 12px}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:45px;height:45px;font-size:18px}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]{margin-left:12px}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .last-message[_ngcontent-%COMP%]{max-width:180px}}@media (max-width: 480px){.header[_ngcontent-%COMP%]{padding:6px 10px}.header[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .avatar-img[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .icon-btn[_ngcontent-%COMP%]{width:36px;height:36px}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]{padding:8px 10px}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:42px;height:42px;font-size:16px}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]{margin-left:10px}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-name[_ngcontent-%COMP%]{font-size:15px}.chats-list[_ngcontent-%COMP%]   .chat-item[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .last-message[_ngcontent-%COMP%]{max-width:150px;font-size:13px}}']})};function qi(i,e){i&1&&(w(),r(0,"svg",2),h(1,"path",10),s())}function Ki(i,e){i&1&&(w(),r(0,"svg",2),h(1,"path",11),s())}function Qi(i,e){if(i&1&&h(0,"div",12),i&2){let t=e.$implicit,n=e.$index,o=l();ge("height",t,"%"),L("played",n/30*100<=o.progress())}}var st=class i{audioUrl;duration;audio=null;apiBaseUrl=$.apiUrl.replace("/api","");isPlaying=b(!1);currentTime=b(0);totalDuration=b(0);playbackRate=b(1);progress=Re(()=>{let e=this.totalDuration();return e===0?0:this.currentTime()/e*100});ngOnDestroy(){this.cleanup()}getFullUrl(){return this.audioUrl.startsWith("http")?this.audioUrl:`${this.apiBaseUrl}${this.audioUrl}`}initAudio(){this.audio||(this.audio=new Audio(this.getFullUrl()),this.audio.addEventListener("loadedmetadata",()=>{this.totalDuration.set(this.audio?.duration||this.duration||0)}),this.audio.addEventListener("timeupdate",()=>{this.currentTime.set(this.audio?.currentTime||0)}),this.audio.addEventListener("ended",()=>{this.isPlaying.set(!1),this.currentTime.set(0),this.audio&&(this.audio.currentTime=0)}),this.audio.addEventListener("error",()=>{console.error("Error al cargar audio"),this.isPlaying.set(!1)}),this.duration&&this.totalDuration.set(this.duration))}togglePlay(){this.initAudio(),this.audio&&(this.isPlaying()?(this.audio.pause(),this.isPlaying.set(!1)):(this.audio.playbackRate=this.playbackRate(),this.audio.play().catch(e=>console.error("Error al reproducir:",e)),this.isPlaying.set(!0)))}seek(e){let n=e.currentTarget.getBoundingClientRect(),a=(e.clientX-n.left)/n.width*this.totalDuration();this.audio&&(this.audio.currentTime=a,this.currentTime.set(a))}changeSpeed(){let e=[1,1.5,2],n=(e.indexOf(this.playbackRate())+1)%e.length;this.playbackRate.set(e[n]),this.audio&&(this.audio.playbackRate=this.playbackRate())}formatTime(e){let t=Math.floor(e/60),n=Math.floor(e%60);return`${t}:${n.toString().padStart(2,"0")}`}cleanup(){this.audio&&(this.audio.pause(),this.audio.src="",this.audio=null)}getWaveformBars(){let e=this.audioUrl.split("").reduce((n,o)=>n+o.charCodeAt(0),0),t=[];for(let n=0;n<30;n++){let o=20+e*(n+1)*13%80;t.push(o)}return t}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=U({type:i,selectors:[["app-audio-player"]],inputs:{audioUrl:"audioUrl",duration:"duration"},decls:15,vars:4,consts:[[1,"audio-player"],[1,"play-btn",3,"click"],["viewBox","0 0 24 24","width","24","height","24"],[1,"waveform-container",3,"click"],[1,"waveform"],[1,"bar",3,"height","played"],[1,"time-info"],[1,"current-time"],[1,"duration"],[1,"speed-btn",3,"click"],["fill","currentColor","d","M6 4h4v16H6V4zm8 0h4v16h-4V4z"],["fill","currentColor","d","M8 5v14l11-7z"],[1,"bar"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"button",1),g("click",function(){return n.togglePlay()}),x(2,qi,2,0,":svg:svg",2)(3,Ki,2,0,":svg:svg",2),s(),r(4,"div",3),g("click",function(a){return n.seek(a)}),r(5,"div",4),H(6,Qi,1,4,"div",5,qe),s()(),r(8,"div",6)(9,"span",7),d(10),s(),r(11,"span",8),d(12),s()(),r(13,"button",9),g("click",function(){return n.changeSpeed()}),d(14),s()()),t&2&&(c(2),f(n.isPlaying()?2:3),c(4),B(n.getWaveformBars()),c(4),P(n.formatTime(n.currentTime())),c(2),P(n.formatTime(n.totalDuration())),c(2),E(" ",n.playbackRate(),"x "))},dependencies:[F],styles:[".audio-player[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:#0000000d;border-radius:8px;min-width:200px;max-width:320px}.play-btn[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;border:none;background:#25d366;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:background-color .2s}.play-btn[_ngcontent-%COMP%]:hover{background:#128c7e}.play-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.waveform-container[_ngcontent-%COMP%]{flex:1;height:32px;cursor:pointer;display:flex;align-items:center}.waveform[_ngcontent-%COMP%]{display:flex;align-items:center;gap:2px;height:100%;width:100%}.bar[_ngcontent-%COMP%]{flex:1;min-width:3px;max-width:6px;background:#b3b3b3;border-radius:2px;transition:background-color .1s}.bar.played[_ngcontent-%COMP%]{background:#25d366}.time-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;font-size:11px;color:#667781;min-width:32px}.time-info[_ngcontent-%COMP%]   .current-time[_ngcontent-%COMP%]{font-weight:500}.time-info[_ngcontent-%COMP%]   .duration[_ngcontent-%COMP%]{opacity:.7}.speed-btn[_ngcontent-%COMP%]{padding:4px 8px;border:none;background:#0000001a;border-radius:4px;font-size:11px;font-weight:600;color:#667781;cursor:pointer;transition:background-color .2s}.speed-btn[_ngcontent-%COMP%]:hover{background:#00000026}.own-message[_nghost-%COMP%]   .audio-player[_ngcontent-%COMP%], .own-message   [_nghost-%COMP%]   .audio-player[_ngcontent-%COMP%]{background:#ffffff26}.own-message[_nghost-%COMP%]   .bar[_ngcontent-%COMP%], .own-message   [_nghost-%COMP%]   .bar[_ngcontent-%COMP%]{background:#ffffff80}.own-message[_nghost-%COMP%]   .bar.played[_ngcontent-%COMP%], .own-message   [_nghost-%COMP%]   .bar.played[_ngcontent-%COMP%]{background:#fff}.own-message[_nghost-%COMP%]   .time-info[_ngcontent-%COMP%], .own-message   [_nghost-%COMP%]   .time-info[_ngcontent-%COMP%]{color:#fffc}.own-message[_nghost-%COMP%]   .speed-btn[_ngcontent-%COMP%], .own-message   [_nghost-%COMP%]   .speed-btn[_ngcontent-%COMP%]{background:#fff3;color:#fff}.own-message[_nghost-%COMP%]   .speed-btn[_ngcontent-%COMP%]:hover, .own-message   [_nghost-%COMP%]   .speed-btn[_ngcontent-%COMP%]:hover{background:#ffffff4d}"]})};var ee=class extends Error{constructor(e,t){let n=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=n}},Pe=class extends Error{constructor(e="A timeout occurred."){let t=new.target.prototype;super(e),this.__proto__=t}},Y=class extends Error{constructor(e="An abort occurred."){let t=new.target.prototype;super(e),this.__proto__=t}},ct=class extends Error{constructor(e,t){let n=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=n}},lt=class extends Error{constructor(e,t){let n=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=n}},dt=class extends Error{constructor(e,t){let n=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=n}},We=class extends Error{constructor(e){let t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}},pt=class extends Error{constructor(e,t){let n=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=n}};var Ne=class{constructor(e,t,n){this.statusCode=e,this.statusText=t,this.content=n}},_e=class{get(e,t){return this.send(N(y({},t),{method:"GET",url:e}))}post(e,t){return this.send(N(y({},t),{method:"POST",url:e}))}delete(e,t){return this.send(N(y({},t),{method:"DELETE",url:e}))}getCookieString(e){return""}};var u=function(i){return i[i.Trace=0]="Trace",i[i.Debug=1]="Debug",i[i.Information=2]="Information",i[i.Warning=3]="Warning",i[i.Error=4]="Error",i[i.Critical=5]="Critical",i[i.None=6]="None",i}(u||{});var fe=class{constructor(){}log(e,t){}};fe.instance=new fe;var Zt="10.0.0";var A=class{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,n){if(!(e in t))throw new Error(`Unknown ${n} value: ${e}.`)}},z=class i{static get isBrowser(){return!i.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!i.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!i.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}};function ye(i,e){let t="";return de(i)?(t=`Binary data of length ${i.byteLength}`,e&&(t+=`. Content: '${Ji(i)}'`)):typeof i=="string"&&(t=`String data of length ${i.length}`,e&&(t+=`. Content: '${i}'`)),t}function Ji(i){let e=new Uint8Array(i),t="";return e.forEach(n=>{let o=n<16?"0":"";t+=`0x${o}${n.toString(16)} `}),t.substring(0,t.length-1)}function de(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function gt(i,e,t,n,o,a){return v(this,null,function*(){let p={},[C,M]=Ce();p[C]=M,i.log(u.Trace,`(${e} transport) sending data. ${ye(o,a.logMessageContent)}.`);let T=de(o)?"arraybuffer":"text",V=yield t.post(n,{content:o,headers:y(y({},p),a.headers),responseType:T,timeout:a.timeout,withCredentials:a.withCredentials});i.log(u.Trace,`(${e} transport) request complete. Response status: ${V.statusCode}.`)})}function en(i){return i===void 0?new ke(u.Information):i===null?fe.instance:i.log!==void 0?i:new ke(i)}var ut=class{constructor(e,t){this._subject=e,this._observer=t}dispose(){let e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}},ke=class{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){let n=`[${new Date().toISOString()}] ${u[e]}: ${t}`;switch(e){case u.Critical:case u.Error:this.out.error(n);break;case u.Warning:this.out.warn(n);break;case u.Information:this.out.info(n);break;default:this.out.log(n);break}}}};function Ce(){let i="X-SignalR-User-Agent";return z.isNode&&(i="User-Agent"),[i,Xi(Zt,Yi(),eo(),Zi())]}function Xi(i,e,t,n){let o="Microsoft SignalR/",a=i.split(".");return o+=`${a[0]}.${a[1]}`,o+=` (${i}; `,e&&e!==""?o+=`${e}; `:o+="Unknown OS; ",o+=`${t}`,n?o+=`; ${n}`:o+="; Unknown Runtime Version",o+=")",o}function Yi(){if(z.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function Zi(){if(z.isNode)return process.versions.node}function eo(){return z.isNode?"NodeJS":"Browser"}function ht(i){return i.stack?i.stack:i.message?i.message:`${i}`}function tn(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}var mt=class extends _e{constructor(e){if(super(),this._logger=e,typeof fetch>"u"||z.isNode){let t=typeof __webpack_require__=="function"?__non_webpack_require__:Ee;this._jar=new(t("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=t("node-fetch"):this._fetchType=fetch,this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(tn());if(typeof AbortController>"u"){let t=typeof __webpack_require__=="function"?__non_webpack_require__:Ee;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}send(e){return v(this,null,function*(){if(e.abortSignal&&e.abortSignal.aborted)throw new Y;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");let t=new this._abortControllerType,n;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),n=new Y});let o=null;if(e.timeout){let M=e.timeout;o=setTimeout(()=>{t.abort(),this._logger.log(u.Warning,"Timeout from HTTP request."),n=new Pe},M)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},de(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");let a;try{a=yield this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:y({"X-Requested-With":"XMLHttpRequest"},e.headers),method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(M){throw n||(this._logger.log(u.Warning,`Error from HTTP request. ${M}.`),M)}finally{o&&clearTimeout(o),e.abortSignal&&(e.abortSignal.onabort=null)}if(!a.ok){let M=yield nn(a,"text");throw new ee(M||a.statusText,a.status)}let C=yield nn(a,e.responseType);return new Ne(a.status,a.statusText,C)})}getCookieString(e){let t="";return z.isNode&&this._jar&&this._jar.getCookies(e,(n,o)=>t=o.join("; ")),t}};function nn(i,e){let t;switch(e){case"arraybuffer":t=i.arrayBuffer();break;case"text":t=i.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`);default:t=i.text();break}return t}var _t=class extends _e{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new Y):e.method?e.url?new Promise((t,n)=>{let o=new XMLHttpRequest;o.open(e.method,e.url,!0),o.withCredentials=e.withCredentials===void 0?!0:e.withCredentials,o.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(de(e.content)?o.setRequestHeader("Content-Type","application/octet-stream"):o.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));let a=e.headers;a&&Object.keys(a).forEach(p=>{o.setRequestHeader(p,a[p])}),e.responseType&&(o.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{o.abort(),n(new Y)}),e.timeout&&(o.timeout=e.timeout),o.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),o.status>=200&&o.status<300?t(new Ne(o.status,o.statusText,o.response||o.responseText)):n(new ee(o.response||o.responseText||o.statusText,o.status))},o.onerror=()=>{this._logger.log(u.Warning,`Error from HTTP request. ${o.status}: ${o.statusText}.`),n(new ee(o.statusText,o.status))},o.ontimeout=()=>{this._logger.log(u.Warning,"Timeout from HTTP request."),n(new Pe)},o.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}};var ft=class extends _e{constructor(e){if(super(),typeof fetch<"u"||z.isNode)this._httpClient=new mt(e);else if(typeof XMLHttpRequest<"u")this._httpClient=new _t(e);else throw new Error("No usable HttpClient found.")}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new Y):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}};var te=class i{static write(e){return`${e}${i.RecordSeparator}`}static parse(e){if(e[e.length-1]!==i.RecordSeparator)throw new Error("Message is incomplete.");let t=e.split(i.RecordSeparator);return t.pop(),t}};te.RecordSeparatorCode=30;te.RecordSeparator=String.fromCharCode(te.RecordSeparatorCode);var Ct=class{writeHandshakeRequest(e){return te.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,n;if(de(e)){let C=new Uint8Array(e),M=C.indexOf(te.RecordSeparatorCode);if(M===-1)throw new Error("Message is incomplete.");let T=M+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(C.slice(0,T))),n=C.byteLength>T?C.slice(T).buffer:null}else{let C=e,M=C.indexOf(te.RecordSeparator);if(M===-1)throw new Error("Message is incomplete.");let T=M+1;t=C.substring(0,T),n=C.length>T?C.substring(T):null}let o=te.parse(t),a=JSON.parse(o[0]);if(a.type)throw new Error("Expected a handshake response from the server.");return[n,a]}};var O=function(i){return i[i.Invocation=1]="Invocation",i[i.StreamItem=2]="StreamItem",i[i.Completion=3]="Completion",i[i.StreamInvocation=4]="StreamInvocation",i[i.CancelInvocation=5]="CancelInvocation",i[i.Ping=6]="Ping",i[i.Close=7]="Close",i[i.Ack=8]="Ack",i[i.Sequence=9]="Sequence",i}(O||{});var vt=class{constructor(){this.observers=[]}next(e){for(let t of this.observers)t.next(e)}error(e){for(let t of this.observers)t.error&&t.error(e)}complete(){for(let e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new ut(this,e)}};var xt=class{constructor(e,t,n){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=n}_send(e){return v(this,null,function*(){let t=this._protocol.writeMessage(e),n=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let o=()=>{},a=()=>{};de(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(n=new Promise((p,C)=>{o=p,a=C})),this._messages.push(new At(t,this._totalMessageCount,o,a))}try{this._reconnectInProgress||(yield this._connection.send(t))}catch{this._disconnected()}yield n})}_ack(e){let t=-1;for(let n=0;n<this._messages.length;n++){let o=this._messages[n];if(o._id<=e.sequenceId)t=n,de(o._message)?this._bufferedByteCount-=o._message.byteLength:this._bufferedByteCount-=o._message.length,o._resolver();else if(this._bufferedByteCount<this._bufferSize)o._resolver();else break}t!==-1&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type!==O.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;let t=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){if(e.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}_resend(){return v(this,null,function*(){let e=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;yield this._connection.send(this._protocol.writeMessage({type:O.Sequence,sequenceId:e}));let t=this._messages;for(let n of t)yield this._connection.send(n._message);this._reconnectInProgress=!1})}_dispose(e){e??(e=new Error("Unable to reconnect to server."));for(let t of this._messages)t._rejector(e)}_isInvocationMessage(e){switch(e.type){case O.Invocation:case O.StreamItem:case O.Completion:case O.StreamInvocation:case O.CancelInvocation:return!0;case O.Close:case O.Sequence:case O.Ping:case O.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(()=>v(this,null,function*(){try{this._reconnectInProgress||(yield this._connection.send(this._protocol.writeMessage({type:O.Ack,sequenceId:this._latestReceivedSequenceId})))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0}),1e3))}},At=class{constructor(e,t,n,o){this._message=e,this._id=t,this._resolver=n,this._rejector=o}};var to=30*1e3,no=15*1e3,io=1e5,W=function(i){return i.Disconnected="Disconnected",i.Connecting="Connecting",i.Connected="Connected",i.Disconnecting="Disconnecting",i.Reconnecting="Reconnecting",i}(W||{}),bt=class i{static create(e,t,n,o,a,p,C){return new i(e,t,n,o,a,p,C)}constructor(e,t,n,o,a,p,C){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(u.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},A.isRequired(e,"connection"),A.isRequired(t,"logger"),A.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=a??to,this.keepAliveIntervalInMilliseconds=p??no,this._statefulReconnectBufferSize=C??io,this._logger=t,this._protocol=n,this.connection=e,this._reconnectPolicy=o,this._handshakeProtocol=new Ct,this.connection.onreceive=M=>this._processIncomingData(M),this.connection.onclose=M=>this._connectionClosed(M),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=W.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:O.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==W.Disconnected&&this._connectionState!==W.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}_startWithStateTransitions(){return v(this,null,function*(){if(this._connectionState!==W.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=W.Connecting,this._logger.log(u.Debug,"Starting HubConnection.");try{yield this._startInternal(),z.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=W.Connected,this._connectionStarted=!0,this._logger.log(u.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=W.Disconnected,this._logger.log(u.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}})}_startInternal(){return v(this,null,function*(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;let e=new Promise((t,n)=>{this._handshakeResolver=t,this._handshakeRejecter=n});yield this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);let n={protocol:this._protocol.name,version:t};if(this._logger.log(u.Debug,"Sending handshake request."),yield this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(n)),this._logger.log(u.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),yield e,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new xt(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||(yield this._sendMessage(this._cachedPingMessage))}catch(t){throw this._logger.log(u.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),yield this.connection.stop(t),t}})}stop(){return v(this,null,function*(){let e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),yield this._stopPromise;try{yield e}catch{}})}_stopInternal(e){if(this._connectionState===W.Disconnected)return this._logger.log(u.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===W.Disconnecting)return this._logger.log(u.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;let t=this._connectionState;return this._connectionState=W.Disconnecting,this._logger.log(u.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(u.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===W.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new Y("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}_sendCloseMessage(){return v(this,null,function*(){try{yield this._sendWithProtocol(this._createCloseMessage())}catch{}})}stream(e,...t){let[n,o]=this._replaceStreamingParams(t),a=this._createStreamInvocation(e,t,o),p,C=new vt;return C.cancelCallback=()=>{let M=this._createCancelInvocation(a.invocationId);return delete this._callbacks[a.invocationId],p.then(()=>this._sendWithProtocol(M))},this._callbacks[a.invocationId]=(M,T)=>{if(T){C.error(T);return}else M&&(M.type===O.Completion?M.error?C.error(new Error(M.error)):C.complete():C.next(M.item))},p=this._sendWithProtocol(a).catch(M=>{C.error(M),delete this._callbacks[a.invocationId]}),this._launchStreams(n,p),C}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){let[n,o]=this._replaceStreamingParams(t),a=this._sendWithProtocol(this._createInvocation(e,t,!0,o));return this._launchStreams(n,a),a}invoke(e,...t){let[n,o]=this._replaceStreamingParams(t),a=this._createInvocation(e,t,!1,o);return new Promise((C,M)=>{this._callbacks[a.invocationId]=(V,xe)=>{if(xe){M(xe);return}else V&&(V.type===O.Completion?V.error?M(new Error(V.error)):C(V.result):M(new Error(`Unexpected message type: ${V.type}`)))};let T=this._sendWithProtocol(a).catch(V=>{M(V),delete this._callbacks[a.invocationId]});this._launchStreams(n,T)})}on(e,t){!e||!t||(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();let n=this._methods[e];if(n)if(t){let o=n.indexOf(t);o!==-1&&(n.splice(o,1),n.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){let t=this._protocol.parseMessages(e,this._logger);for(let n of t)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(n)))switch(n.type){case O.Invocation:this._invokeClientMethod(n).catch(o=>{this._logger.log(u.Error,`Invoke client method threw error: ${ht(o)}`)});break;case O.StreamItem:case O.Completion:{let o=this._callbacks[n.invocationId];if(o){n.type===O.Completion&&delete this._callbacks[n.invocationId];try{o(n)}catch(a){this._logger.log(u.Error,`Stream callback threw error: ${ht(a)}`)}}break}case O.Ping:break;case O.Close:{this._logger.log(u.Information,"Close message received from server.");let o=n.error?new Error("Server returned an error on close: "+n.error):void 0;n.allowReconnect===!0?this.connection.stop(o):this._stopPromise=this._stopInternal(o);break}case O.Ack:this._messageBuffer&&this._messageBuffer._ack(n);break;case O.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(n);break;default:this._logger.log(u.Warning,`Invalid message type: ${n.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,n;try{[n,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(o){let a="Error parsing handshake response: "+o;this._logger.log(u.Error,a);let p=new Error(a);throw this._handshakeRejecter(p),p}if(t.error){let o="Server returned handshake error: "+t.error;this._logger.log(u.Error,o);let a=new Error(o);throw this._handshakeRejecter(a),a}else this._logger.log(u.Debug,"Server handshake complete.");return this._handshakeResolver(),n}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if(!this.connection.features||!this.connection.features.inherentKeepAlive){this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds);let e=this._nextKeepAlive-new Date().getTime();if(e<0){this._connectionState===W.Connected&&this._trySendPingMessage();return}this._pingServerHandle===void 0&&(e<0&&(e=0),this._pingServerHandle=setTimeout(()=>v(this,null,function*(){this._connectionState===W.Connected&&(yield this._trySendPingMessage())}),e))}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}_invokeClientMethod(e){return v(this,null,function*(){let t=e.target.toLowerCase(),n=this._methods[t];if(!n){this._logger.log(u.Warning,`No client method with the name '${t}' found.`),e.invocationId&&(this._logger.log(u.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),yield this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)));return}let o=n.slice(),a=!!e.invocationId,p,C,M;for(let T of o)try{let V=p;p=yield T.apply(this,e.arguments),a&&p&&V&&(this._logger.log(u.Error,`Multiple results provided for '${t}'. Sending error to server.`),M=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),C=void 0}catch(V){C=V,this._logger.log(u.Error,`A callback for the method '${t}' threw error '${V}'.`)}M?yield this._sendWithProtocol(M):a?(C?M=this._createCompletionMessage(e.invocationId,`${C}`,null):p!==void 0?M=this._createCompletionMessage(e.invocationId,null,p):(this._logger.log(u.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),M=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),yield this._sendWithProtocol(M)):p&&this._logger.log(u.Error,`Result given for '${t}' method but server is not expecting a result.`)})}_connectionClosed(e){this._logger.log(u.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new Y("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===W.Disconnecting?this._completeClose(e):this._connectionState===W.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===W.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=W.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(e??new Error("Connection closed.")),this._messageBuffer=void 0),z.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(u.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}_reconnect(e){return v(this,null,function*(){let t=Date.now(),n=0,o=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),a=this._getNextRetryDelay(n,0,o);if(a===null){this._logger.log(u.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(e);return}if(this._connectionState=W.Reconnecting,e?this._logger.log(u.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(u.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(p=>p.apply(this,[e]))}catch(p){this._logger.log(u.Error,`An onreconnecting callback called with error '${e}' threw error '${p}'.`)}if(this._connectionState!==W.Reconnecting){this._logger.log(u.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;a!==null;){if(this._logger.log(u.Information,`Reconnect attempt number ${n+1} will start in ${a} ms.`),yield new Promise(p=>{this._reconnectDelayHandle=setTimeout(p,a)}),this._reconnectDelayHandle=void 0,this._connectionState!==W.Reconnecting){this._logger.log(u.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(yield this._startInternal(),this._connectionState=W.Connected,this._logger.log(u.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(p=>p.apply(this,[this.connection.connectionId]))}catch(p){this._logger.log(u.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${p}'.`)}return}catch(p){if(this._logger.log(u.Information,`Reconnect attempt failed because of error '${p}'.`),this._connectionState!==W.Reconnecting){this._logger.log(u.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===W.Disconnecting&&this._completeClose();return}n++,o=p instanceof Error?p:new Error(p.toString()),a=this._getNextRetryDelay(n,Date.now()-t,o)}}this._logger.log(u.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${n} failed attempts. Connection disconnecting.`),this._completeClose()})}_getNextRetryDelay(e,t,n){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:n})}catch(o){return this._logger.log(u.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${o}'.`),null}}_cancelCallbacksWithError(e){let t=this._callbacks;this._callbacks={},Object.keys(t).forEach(n=>{let o=t[n];try{o(null,e)}catch(a){this._logger.log(u.Error,`Stream 'error' callback called with '${e}' threw error: ${ht(a)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,n,o){if(n)return o.length!==0?{target:e,arguments:t,streamIds:o,type:O.Invocation}:{target:e,arguments:t,type:O.Invocation};{let a=this._invocationId;return this._invocationId++,o.length!==0?{target:e,arguments:t,invocationId:a.toString(),streamIds:o,type:O.Invocation}:{target:e,arguments:t,invocationId:a.toString(),type:O.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(let n in e)e[n].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(n)))},error:o=>{let a;o instanceof Error?a=o.message:o&&o.toString?a=o.toString():a="Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(n,a)))},next:o=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(n,o)))}})}}_replaceStreamingParams(e){let t=[],n=[];for(let o=0;o<e.length;o++){let a=e[o];if(this._isObservable(a)){let p=this._invocationId;this._invocationId++,t[p]=a,n.push(p.toString()),e.splice(o,1)}}return[t,n]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,n){let o=this._invocationId;return this._invocationId++,n.length!==0?{target:e,arguments:t,invocationId:o.toString(),streamIds:n,type:O.StreamInvocation}:{target:e,arguments:t,invocationId:o.toString(),type:O.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:O.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:O.StreamItem}}_createCompletionMessage(e,t,n){return t?{error:t,invocationId:e,type:O.Completion}:{invocationId:e,result:n,type:O.Completion}}_createCloseMessage(){return{type:O.Close}}_trySendPingMessage(){return v(this,null,function*(){try{yield this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}})}};var oo=[0,2e3,1e4,3e4,null],je=class{constructor(e){this._retryDelays=e!==void 0?[...e,null]:oo}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}};var Te=(()=>{class i{}return i.Authorization="Authorization",i.Cookie="Cookie",i})();var Mt=class extends _e{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}send(e){return v(this,null,function*(){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=yield this._accessTokenFactory()),this._setAuthorizationHeader(e);let n=yield this._innerClient.send(e);return t&&n.statusCode===401&&this._accessTokenFactory?(this._accessToken=yield this._accessTokenFactory(),this._setAuthorizationHeader(e),yield this._innerClient.send(e)):n})}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[Te.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[Te.Authorization]&&delete e.headers[Te.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}};var X=function(i){return i[i.None=0]="None",i[i.WebSockets=1]="WebSockets",i[i.ServerSentEvents=2]="ServerSentEvents",i[i.LongPolling=4]="LongPolling",i}(X||{}),J=function(i){return i[i.Text=1]="Text",i[i.Binary=2]="Binary",i}(J||{});var wt=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};var He=class{get pollAborted(){return this._pollAbort.aborted}constructor(e,t,n){this._httpClient=e,this._logger=t,this._pollAbort=new wt,this._options=n,this._running=!1,this.onreceive=null,this.onclose=null}connect(e,t){return v(this,null,function*(){if(A.isRequired(e,"url"),A.isRequired(t,"transferFormat"),A.isIn(t,J,"transferFormat"),this._url=e,this._logger.log(u.Trace,"(LongPolling transport) Connecting."),t===J.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");let[n,o]=Ce(),a=y({[n]:o},this._options.headers),p={abortSignal:this._pollAbort.signal,headers:a,timeout:1e5,withCredentials:this._options.withCredentials};t===J.Binary&&(p.responseType="arraybuffer");let C=`${e}&_=${Date.now()}`;this._logger.log(u.Trace,`(LongPolling transport) polling: ${C}.`);let M=yield this._httpClient.get(C,p);M.statusCode!==200?(this._logger.log(u.Error,`(LongPolling transport) Unexpected response code: ${M.statusCode}.`),this._closeError=new ee(M.statusText||"",M.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,p)})}_poll(e,t){return v(this,null,function*(){try{for(;this._running;)try{let n=`${e}&_=${Date.now()}`;this._logger.log(u.Trace,`(LongPolling transport) polling: ${n}.`);let o=yield this._httpClient.get(n,t);o.statusCode===204?(this._logger.log(u.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):o.statusCode!==200?(this._logger.log(u.Error,`(LongPolling transport) Unexpected response code: ${o.statusCode}.`),this._closeError=new ee(o.statusText||"",o.statusCode),this._running=!1):o.content?(this._logger.log(u.Trace,`(LongPolling transport) data received. ${ye(o.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(o.content)):this._logger.log(u.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(n){this._running?n instanceof Pe?this._logger.log(u.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=n,this._running=!1):this._logger.log(u.Trace,`(LongPolling transport) Poll errored after shutdown: ${n.message}`)}}finally{this._logger.log(u.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}})}send(e){return v(this,null,function*(){return this._running?gt(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))})}stop(){return v(this,null,function*(){this._logger.log(u.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{yield this._receiving,this._logger.log(u.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);let e={},[t,n]=Ce();e[t]=n;let o={headers:y(y({},e),this._options.headers),timeout:this._options.timeout,withCredentials:this._options.withCredentials},a;try{yield this._httpClient.delete(this._url,o)}catch(p){a=p}a?a instanceof ee&&(a.statusCode===404?this._logger.log(u.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(u.Trace,`(LongPolling transport) Error sending a DELETE request: ${a}`)):this._logger.log(u.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(u.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}})}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(u.Trace,e),this.onclose(this._closeError)}}};var St=class{constructor(e,t,n,o){this._httpClient=e,this._accessToken=t,this._logger=n,this._options=o,this.onreceive=null,this.onclose=null}connect(e,t){return v(this,null,function*(){return A.isRequired(e,"url"),A.isRequired(t,"transferFormat"),A.isIn(t,J,"transferFormat"),this._logger.log(u.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((n,o)=>{let a=!1;if(t!==J.Text){o(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let p;if(z.isBrowser||z.isWebWorker)p=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{let C=this._httpClient.getCookieString(e),M={};M.Cookie=C;let[T,V]=Ce();M[T]=V,p=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:y(y({},M),this._options.headers)})}try{p.onmessage=C=>{if(this.onreceive)try{this._logger.log(u.Trace,`(SSE transport) data received. ${ye(C.data,this._options.logMessageContent)}.`),this.onreceive(C.data)}catch(M){this._close(M);return}},p.onerror=C=>{a?this._close():o(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},p.onopen=()=>{this._logger.log(u.Information,`SSE connected to ${this._url}`),this._eventSource=p,a=!0,n()}}catch(C){o(C);return}})})}send(e){return v(this,null,function*(){return this._eventSource?gt(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))})}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}};var Pt=class{constructor(e,t,n,o,a,p){this._logger=n,this._accessTokenFactory=t,this._logMessageContent=o,this._webSocketConstructor=a,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=p}connect(e,t){return v(this,null,function*(){A.isRequired(e,"url"),A.isRequired(t,"transferFormat"),A.isIn(t,J,"transferFormat"),this._logger.log(u.Trace,"(WebSockets transport) Connecting.");let n;return this._accessTokenFactory&&(n=yield this._accessTokenFactory()),new Promise((o,a)=>{e=e.replace(/^http/,"ws");let p,C=this._httpClient.getCookieString(e),M=!1;if(z.isNode||z.isReactNative){let T={},[V,xe]=Ce();T[V]=xe,n&&(T[Te.Authorization]=`Bearer ${n}`),C&&(T[Te.Cookie]=C),p=new this._webSocketConstructor(e,void 0,{headers:y(y({},T),this._headers)})}else n&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(n)}`);p||(p=new this._webSocketConstructor(e)),t===J.Binary&&(p.binaryType="arraybuffer"),p.onopen=T=>{this._logger.log(u.Information,`WebSocket connected to ${e}.`),this._webSocket=p,M=!0,o()},p.onerror=T=>{let V=null;typeof ErrorEvent<"u"&&T instanceof ErrorEvent?V=T.error:V="There was an error with the transport",this._logger.log(u.Information,`(WebSockets transport) ${V}.`)},p.onmessage=T=>{if(this._logger.log(u.Trace,`(WebSockets transport) data received. ${ye(T.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(T.data)}catch(V){this._close(V);return}},p.onclose=T=>{if(M)this._close(T);else{let V=null;typeof ErrorEvent<"u"&&T instanceof ErrorEvent?V=T.error:V="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",a(new Error(V))}}})})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(u.Trace,`(WebSockets transport) sending data. ${ye(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(u.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(e)&&(e.wasClean===!1||e.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)):e instanceof Error?this.onclose(e):this.onclose())}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}};var on=100,yt=class{constructor(e,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,A.isRequired(e,"url"),this._logger=en(t.logger),this.baseUrl=this._resolveUrl(e),t=t||{},t.logMessageContent=t.logMessageContent===void 0?!1:t.logMessageContent,typeof t.withCredentials=="boolean"||t.withCredentials===void 0)t.withCredentials=t.withCredentials===void 0?!0:t.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.timeout=t.timeout===void 0?100*1e3:t.timeout;let n=null,o=null;if(z.isNode&&typeof Ee<"u"){let a=typeof __webpack_require__=="function"?__non_webpack_require__:Ee;n=a("ws"),o=a("eventsource")}!z.isNode&&typeof WebSocket<"u"&&!t.WebSocket?t.WebSocket=WebSocket:z.isNode&&!t.WebSocket&&n&&(t.WebSocket=n),!z.isNode&&typeof EventSource<"u"&&!t.EventSource?t.EventSource=EventSource:z.isNode&&!t.EventSource&&typeof o<"u"&&(t.EventSource=o),this._httpClient=new Mt(t.httpClient||new ft(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}start(e){return v(this,null,function*(){if(e=e||J.Binary,A.isIn(e,J,"transferFormat"),this._logger.log(u.Debug,`Starting connection with transfer format '${J[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),yield this._startInternalPromise,this._connectionState==="Disconnecting"){let t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(u.Error,t),yield this._stopPromise,Promise.reject(new Y(t))}else if(this._connectionState!=="Connected"){let t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(u.Error,t),Promise.reject(new Y(t))}this._connectionStarted=!0})}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new zt(this.transport)),this._sendQueue.send(e))}stop(e){return v(this,null,function*(){if(this._connectionState==="Disconnected")return this._logger.log(u.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(u.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),yield this._stopInternal(e),yield this._stopPromise})}_stopInternal(e){return v(this,null,function*(){this._stopError=e;try{yield this._startInternalPromise}catch{}if(this.transport){try{yield this.transport.stop()}catch(t){this._logger.log(u.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(u.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")})}_startInternal(e){return v(this,null,function*(){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===X.WebSockets)this.transport=this._constructTransport(X.WebSockets),yield this._startTransport(t,e);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let n=null,o=0;do{if(n=yield this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new Y("The connection was stopped during negotiation.");if(n.error)throw new Error(n.error);if(n.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(n.url&&(t=n.url),n.accessToken){let a=n.accessToken;this._accessTokenFactory=()=>a,this._httpClient._accessToken=a,this._httpClient._accessTokenFactory=void 0}o++}while(n.url&&o<on);if(o===on&&n.url)throw new Error("Negotiate redirection limit exceeded.");yield this._createTransport(t,this._options.transport,n,e)}this.transport instanceof He&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(u.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(n){return this._logger.log(u.Error,"Failed to start the connection: "+n),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(n)}})}_getNegotiationResponse(e){return v(this,null,function*(){let t={},[n,o]=Ce();t[n]=o;let a=this._resolveNegotiateUrl(e);this._logger.log(u.Debug,`Sending negotiation request: ${a}.`);try{let p=yield this._httpClient.post(a,{content:"",headers:y(y({},t),this._options.headers),timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(p.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${p.statusCode}'`));let C=JSON.parse(p.content);return(!C.negotiateVersion||C.negotiateVersion<1)&&(C.connectionToken=C.connectionId),C.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new We("Client didn't negotiate Stateful Reconnect but the server did.")):C}catch(p){let C="Failed to complete negotiation with the server: "+p;return p instanceof ee&&p.statusCode===404&&(C=C+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(u.Error,C),Promise.reject(new We(C))}})}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}_createTransport(e,t,n,o){return v(this,null,function*(){let a=this._createConnectUrl(e,n.connectionToken);if(this._isITransport(t)){this._logger.log(u.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,yield this._startTransport(a,o),this.connectionId=n.connectionId;return}let p=[],C=n.availableTransports||[],M=n;for(let T of C){let V=this._resolveTransportOrError(T,t,o,M?.useStatefulReconnect===!0);if(V instanceof Error)p.push(`${T.transport} failed:`),p.push(V);else if(this._isITransport(V)){if(this.transport=V,!M){try{M=yield this._getNegotiationResponse(e)}catch(xe){return Promise.reject(xe)}a=this._createConnectUrl(e,M.connectionToken)}try{yield this._startTransport(a,o),this.connectionId=M.connectionId;return}catch(xe){if(this._logger.log(u.Error,`Failed to start the transport '${T.transport}': ${xe}`),M=void 0,p.push(new dt(`${T.transport} failed: ${xe}`,X[T.transport])),this._connectionState!=="Connecting"){let Ut="Failed to select transport before stop() was called.";return this._logger.log(u.Debug,Ut),Promise.reject(new Y(Ut))}}}}return p.length>0?Promise.reject(new pt(`Unable to connect to the server with any of the available transports. ${p.join(" ")}`,p)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))})}_constructTransport(e){switch(e){case X.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Pt(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case X.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new St(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case X.LongPolling:return new He(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=n=>v(this,null,function*(){let o=!1;if(this.features.reconnect)try{this.features.disconnected(),yield this.transport.connect(e,t),yield this.features.resend()}catch{o=!0}else{this._stopConnection(n);return}o&&this._stopConnection(n)}):this.transport.onclose=n=>this._stopConnection(n),this.transport.connect(e,t)}_resolveTransportOrError(e,t,n,o){let a=X[e.transport];if(a==null)return this._logger.log(u.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(ro(t,a))if(e.transferFormats.map(C=>J[C]).indexOf(n)>=0){if(a===X.WebSockets&&!this._options.WebSocket||a===X.ServerSentEvents&&!this._options.EventSource)return this._logger.log(u.Debug,`Skipping transport '${X[a]}' because it is not supported in your environment.'`),new ct(`'${X[a]}' is not supported in your environment.`,a);this._logger.log(u.Debug,`Selecting transport '${X[a]}'.`);try{return this.features.reconnect=a===X.WebSockets?o:void 0,this._constructTransport(a)}catch(C){return C}}else return this._logger.log(u.Debug,`Skipping transport '${X[a]}' because it does not support the requested transfer format '${J[n]}'.`),new Error(`'${X[a]}' does not support ${J[n]}.`);else return this._logger.log(u.Debug,`Skipping transport '${X[a]}' because it was disabled by the client.`),new lt(`'${X[a]}' is disabled by the client.`,a)}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(u.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(u.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(u.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(u.Error,`Connection disconnected with error '${e}'.`):this._logger.log(u.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(u.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(u.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!z.isBrowser)throw new Error(`Cannot resolve '${e}'.`);let t=window.document.createElement("a");return t.href=e,this._logger.log(u.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){let t=new URL(e);t.pathname.endsWith("/")?t.pathname+="negotiate":t.pathname+="/negotiate";let n=new URLSearchParams(t.searchParams);return n.has("negotiateVersion")||n.append("negotiateVersion",this._negotiateVersion.toString()),n.has("useStatefulReconnect")?n.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&n.append("useStatefulReconnect","true"),t.search=n.toString(),t.toString()}};function ro(i,e){return!i||(e&i)!==0}var zt=class i{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new $e,this._transportResult=new $e,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new $e),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}_sendLoop(){return v(this,null,function*(){for(;;){if(yield this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new $e;let e=this._transportResult;this._transportResult=void 0;let t=typeof this._buffer[0]=="string"?this._buffer.join(""):i._concatBuffers(this._buffer);this._buffer.length=0;try{yield this._transport.send(t),e.resolve()}catch(n){e.reject(n)}}})}static _concatBuffers(e){let t=e.map(a=>a.byteLength).reduce((a,p)=>a+p),n=new Uint8Array(t),o=0;for(let a of e)n.set(new Uint8Array(a),o),o+=a.byteLength;return n.buffer}},$e=class{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}};var ao="json",Ot=class{constructor(){this.name=ao,this.version=2,this.transferFormat=J.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=fe.instance);let n=te.parse(e),o=[];for(let a of n){let p=JSON.parse(a);if(typeof p.type!="number")throw new Error("Invalid payload.");switch(p.type){case O.Invocation:this._isInvocationMessage(p);break;case O.StreamItem:this._isStreamItemMessage(p);break;case O.Completion:this._isCompletionMessage(p);break;case O.Ping:break;case O.Close:break;case O.Ack:this._isAckMessage(p);break;case O.Sequence:this._isSequenceMessage(p);break;default:t.log(u.Information,"Unknown message type '"+p.type+"' ignored.");continue}o.push(p)}return o}writeMessage(e){return te.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}};var so={trace:u.Trace,debug:u.Debug,info:u.Information,information:u.Information,warn:u.Warning,warning:u.Warning,error:u.Error,critical:u.Critical,none:u.None};function co(i){let e=so[i.toLowerCase()];if(typeof e<"u")return e;throw new Error(`Unknown log level: ${i}`)}var Be=class{configureLogging(e){if(A.isRequired(e,"logging"),lo(e))this.logger=e;else if(typeof e=="string"){let t=co(e);this.logger=new ke(t)}else this.logger=new ke(e);return this}withUrl(e,t){return A.isRequired(e,"url"),A.isNotEmpty(e,"url"),this.url=e,typeof t=="object"?this.httpConnectionOptions=y(y({},this.httpConnectionOptions),t):this.httpConnectionOptions=N(y({},this.httpConnectionOptions),{transport:t}),this}withHubProtocol(e){return A.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new je(e):this.reconnectPolicy=e:this.reconnectPolicy=new je,this}withServerTimeout(e){return A.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return A.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=e?.bufferSize,this}build(){let e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");let t=new yt(this.url,e);return bt.create(t,this.logger||fe.instance,this.protocol||new Ot,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}};function lo(i){return i.log!==void 0}var Oe=class i{hubConnection;isConnected=b(!1);messageReceived$=new pe;userTyping$=new pe;messageStatusUpdated$=new pe;messagesRead$=new pe;messageDeleted$=new pe;userStatusChanged$=new pe;newStatus$=new pe;statusDeleted$=new pe;statusViewed$=new pe;callOfferCallback;callAnswerCallback;callRejectedCallback;callEndedCallback;iceCandidateCallback;callFailedCallback;selectedChatId=b(null);authService=be(he);notificationSettings=be(ze);chatService=be(ce);constructor(){this.chatService.setOnChatSelectedCallback(e=>{this.selectedChatId.set(e)})}startConnection(){return v(this,null,function*(){let e=this.authService.getToken();if(!e){console.error("No token available for SignalR connection");return}this.hubConnection=new Be().withUrl($.hubUrl,{accessTokenFactory:()=>e}).withAutomaticReconnect().build(),this.registerHandlers();try{yield this.hubConnection.start(),console.log("SignalR Connected"),this.isConnected.set(!0)}catch(t){console.error("SignalR Connection Error:",t),this.isConnected.set(!1)}})}stopConnection(){return v(this,null,function*(){this.hubConnection&&(yield this.hubConnection.stop(),this.isConnected.set(!1))})}registerHandlers(){this.hubConnection&&(this.hubConnection.on("ReceiveMessage",e=>{this.messageReceived$.next(e);let t=this.authService.currentUser();t&&e.mensaje&&this.notificationSettings.shouldPlaySound(e.mensaje.remitenteId,t.id,this.selectedChatId(),e.chatId)&&this.notificationSettings.playNotificationSound()}),this.hubConnection.on("UserTyping",e=>{this.userTyping$.next(e)}),this.hubConnection.on("MessageStatusUpdated",e=>{this.messageStatusUpdated$.next(e)}),this.hubConnection.on("MessagesRead",e=>{this.messagesRead$.next(e)}),this.hubConnection.on("MessageDeleted",e=>{this.messageDeleted$.next(e)}),this.hubConnection.on("UserStatusChanged",e=>{this.userStatusChanged$.next(e)}),this.hubConnection.on("NewStatus",e=>{this.newStatus$.next(e)}),this.hubConnection.on("StatusDeleted",e=>{this.statusDeleted$.next(e)}),this.hubConnection.on("StatusViewed",e=>{this.statusViewed$.next(e)}),this.hubConnection.on("ReceiveCallOffer",e=>{this.callOfferCallback?.(e)}),this.hubConnection.on("ReceiveCallAnswer",e=>{this.callAnswerCallback?.(e)}),this.hubConnection.on("CallRejected",e=>{this.callRejectedCallback?.(e)}),this.hubConnection.on("CallEnded",()=>{this.callEndedCallback?.()}),this.hubConnection.on("ReceiveICECandidate",e=>{this.iceCandidateCallback?.(e)}),this.hubConnection.on("CallFailed",e=>{this.callFailedCallback?.(e)}),this.hubConnection.onreconnecting(()=>{console.log("SignalR Reconnecting..."),this.isConnected.set(!1)}),this.hubConnection.onreconnected(()=>{console.log("SignalR Reconnected"),this.isConnected.set(!0)}))}joinChat(e){return v(this,null,function*(){this.hubConnection&&(yield this.hubConnection.invoke("JoinChat",e))})}leaveChat(e){return v(this,null,function*(){this.hubConnection&&(yield this.hubConnection.invoke("LeaveChat",e))})}sendTyping(e,t){return v(this,null,function*(){if(this.hubConnection){let n=this.authService.currentUser();n&&(yield this.hubConnection.invoke("SendTyping",{chatId:e,usuarioId:n.id,nombreUsuario:n.nombre,estaEscribiendo:t}))}})}markMessageAsDelivered(e,t){return v(this,null,function*(){this.hubConnection&&(yield this.hubConnection.invoke("MessageDelivered",e,t))})}markMessageAsRead(e,t){return v(this,null,function*(){this.hubConnection&&(yield this.hubConnection.invoke("MessageRead",e,t))})}onCallOffer(e){this.callOfferCallback=e}onCallAnswer(e){this.callAnswerCallback=e}onCallRejected(e){this.callRejectedCallback=e}onCallEnded(e){this.callEndedCallback=e}onIceCandidate(e){this.iceCandidateCallback=e}onCallFailed(e){this.callFailedCallback=e}callUser(e,t,n){return v(this,null,function*(){this.hubConnection&&(yield this.hubConnection.invoke("CallUser",e,t,n))})}answerCall(e,t){return v(this,null,function*(){this.hubConnection&&(yield this.hubConnection.invoke("AnswerCall",e,t))})}rejectCall(e,t){return v(this,null,function*(){this.hubConnection&&(yield this.hubConnection.invoke("RejectCall",e,t))})}endCall(e){return v(this,null,function*(){this.hubConnection&&(yield this.hubConnection.invoke("EndCall",e))})}sendIceCandidate(e,t){return v(this,null,function*(){this.hubConnection&&(yield this.hubConnection.invoke("SendICECandidate",e,t))})}static \u0275fac=function(t){return new(t||i)};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};var kt=class i{mediaRecorder=null;audioChunks=[];startTime=0;timerInterval=null;isRecording=b(!1);recordingDuration=b(0);hasPermission=b(null);requestPermission(){return v(this,null,function*(){try{return(yield navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(t=>t.stop()),this.hasPermission.set(!0),!0}catch{return this.hasPermission.set(!1),!1}})}startRecording(){return v(this,null,function*(){try{let e=yield navigator.mediaDevices.getUserMedia({audio:!0}),t=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":"audio/webm";return this.mediaRecorder=new MediaRecorder(e,{mimeType:t}),this.audioChunks=[],this.startTime=Date.now(),this.mediaRecorder.ondataavailable=n=>{n.data.size>0&&this.audioChunks.push(n.data)},this.mediaRecorder.start(100),this.isRecording.set(!0),this.recordingDuration.set(0),this.timerInterval=window.setInterval(()=>{let n=Math.floor((Date.now()-this.startTime)/1e3);this.recordingDuration.set(n)},100),!0}catch(e){return console.error("Error al iniciar grabaci\xF3n:",e),this.hasPermission.set(!1),!1}})}stopRecording(){return v(this,null,function*(){return new Promise(e=>{if(!this.mediaRecorder||this.mediaRecorder.state==="inactive"){e(null);return}this.mediaRecorder.onstop=()=>{let t=this.recordingDuration(),n=new Blob(this.audioChunks,{type:"audio/webm"});this.mediaRecorder?.stream.getTracks().forEach(o=>o.stop()),this.cleanup(),e({blob:n,duration:t})},this.mediaRecorder.stop()})})}cancelRecording(){this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(this.mediaRecorder.stream.getTracks().forEach(e=>e.stop()),this.mediaRecorder.stop()),this.cleanup()}cleanup(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),this.isRecording.set(!1),this.recordingDuration.set(0),this.audioChunks=[],this.mediaRecorder=null}formatDuration(e){let t=Math.floor(e/60),n=e%60;return`${t}:${n.toString().padStart(2,"0")}`}static \u0275fac=function(t){return new(t||i)};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ue=class i{peerConnection=null;localStream=null;remoteStream=b(null);localVideoEnabled=b(!0);localAudioEnabled=b(!0);iceServers=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}];onIceCandidate=null;initializeConnection(e){return v(this,null,function*(){this.onIceCandidate=e,this.peerConnection=new RTCPeerConnection({iceServers:this.iceServers}),this.peerConnection.onicecandidate=t=>{t.candidate&&this.onIceCandidate&&this.onIceCandidate(JSON.stringify(t.candidate))},this.peerConnection.ontrack=t=>{this.remoteStream.set(t.streams[0])},this.peerConnection.onconnectionstatechange=()=>{console.log("Connection state:",this.peerConnection?.connectionState)}})}getLocalStream(e){return v(this,null,function*(){return this.localStream=yield navigator.mediaDevices.getUserMedia({audio:!0,video:e?{width:{ideal:1280},height:{ideal:720},facingMode:"user"}:!1}),this.localStream})}createOffer(e){return v(this,null,function*(){if(!this.peerConnection)throw new Error("Peer connection not initialized");let t=yield this.getLocalStream(e);t.getTracks().forEach(o=>{this.peerConnection.addTrack(o,t)});let n=yield this.peerConnection.createOffer();return yield this.peerConnection.setLocalDescription(n),JSON.stringify(n)})}createAnswer(e,t){return v(this,null,function*(){if(!this.peerConnection)throw new Error("Peer connection not initialized");let n=yield this.getLocalStream(t);n.getTracks().forEach(p=>{this.peerConnection.addTrack(p,n)});let o=JSON.parse(e);yield this.peerConnection.setRemoteDescription(new RTCSessionDescription(o));let a=yield this.peerConnection.createAnswer();return yield this.peerConnection.setLocalDescription(a),JSON.stringify(a)})}handleAnswer(e){return v(this,null,function*(){if(!this.peerConnection)return;let t=JSON.parse(e);yield this.peerConnection.setRemoteDescription(new RTCSessionDescription(t))})}addIceCandidate(e){return v(this,null,function*(){if(this.peerConnection)try{let t=JSON.parse(e);yield this.peerConnection.addIceCandidate(new RTCIceCandidate(t))}catch(t){console.error("Error adding ICE candidate:",t)}})}toggleVideo(){if(this.localStream){let e=this.localStream.getVideoTracks()[0];e&&(e.enabled=!e.enabled,this.localVideoEnabled.set(e.enabled))}}toggleAudio(){if(this.localStream){let e=this.localStream.getAudioTracks()[0];e&&(e.enabled=!e.enabled,this.localAudioEnabled.set(e.enabled))}}getLocalStream2(){return this.localStream}endCall(){this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.remoteStream.set(null),this.localVideoEnabled.set(!0),this.localAudioEnabled.set(!0),this.onIceCandidate=null}checkPermissions(){return v(this,null,function*(){try{let e=yield navigator.permissions.query({name:"microphone"}),t=yield navigator.permissions.query({name:"camera"});return{audio:e.state==="granted",video:t.state==="granted"}}catch{try{return(yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(t=>t.stop()),{audio:!0,video:!0}}catch{return{audio:!1,video:!1}}}})}static \u0275fac=function(t){return new(t||i)};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};var ve=class i{constructor(e,t,n){this.http=e;this.webrtcService=t;this.signalrService=n;this.setupSignalRListeners()}apiUrl=$.apiUrl;_callState=b({isInCall:!1,isIncoming:!1,isVideo:!1});callState=this._callState.asReadonly();callDuration=b(0);durationInterval=null;isInCall=Re(()=>this._callState().isInCall);isIncoming=Re(()=>this._callState().isIncoming);isVideo=Re(()=>this._callState().isVideo);setupSignalRListeners(){this.signalrService.onCallOffer(e=>{this._callState.set({isInCall:!0,isIncoming:!0,isVideo:e.callType==="Video",callerId:e.callerId,callerName:e.callerName,callerPhoto:e.callerPhoto}),window.__pendingSdpOffer=e.sdpOffer}),this.signalrService.onCallAnswer(e=>v(this,null,function*(){yield this.webrtcService.handleAnswer(e.sdpAnswer),this.startDurationTimer()})),this.signalrService.onCallRejected(e=>{this.endCallLocally(),alert(`Llamada rechazada: ${e.reason}`)}),this.signalrService.onCallEnded(()=>{this.endCallLocally()}),this.signalrService.onIceCandidate(e=>{this.webrtcService.addIceCandidate(e.candidate)}),this.signalrService.onCallFailed(e=>{this.endCallLocally(),alert(e.message||"No se pudo realizar la llamada")})}startCall(e,t,n){return v(this,null,function*(){try{yield this.webrtcService.initializeConnection(a=>{this.signalrService.sendIceCandidate(e,a)});let o=yield this.webrtcService.createOffer(n);this._callState.set({isInCall:!0,isIncoming:!1,isVideo:n,targetUserId:e,targetUserName:t}),this.http.post(`${this.apiUrl}/calls/start`,{receptorId:e,tipo:n?"Video":"Voz"}).subscribe(a=>{this._callState.update(p=>N(y({},p),{callId:a.id}))}),this.signalrService.callUser(e,n?"Video":"Voz",o)}catch(o){throw console.error("Error starting call:",o),this.endCallLocally(),o}})}acceptCall(){return v(this,null,function*(){let e=this._callState();if(e.callerId)try{let t=window.__pendingSdpOffer;delete window.__pendingSdpOffer,yield this.webrtcService.initializeConnection(o=>{this.signalrService.sendIceCandidate(e.callerId,o)});let n=yield this.webrtcService.createAnswer(t,e.isVideo);this._callState.update(o=>N(y({},o),{isIncoming:!1,startTime:new Date})),this.signalrService.answerCall(e.callerId,n),this.startDurationTimer()}catch(t){throw console.error("Error accepting call:",t),this.rejectCall(),t}})}rejectCall(){let e=this._callState();e.callerId&&this.signalrService.rejectCall(e.callerId,"Rejected"),this.endCallLocally()}endCall(){let e=this._callState(),t=e.callerId||e.targetUserId;t&&this.signalrService.endCall(t),e.callId&&this.http.put(`${this.apiUrl}/calls/${e.callId}/end`,{estado:"Completada"}).subscribe(),this.endCallLocally()}endCallLocally(){this.webrtcService.endCall(),this._callState.set({isInCall:!1,isIncoming:!1,isVideo:!1}),this.stopDurationTimer()}startDurationTimer(){this.callDuration.set(0),this._callState.update(e=>N(y({},e),{startTime:new Date})),this.durationInterval=window.setInterval(()=>{this.callDuration.update(e=>e+1)},1e3)}stopDurationTimer(){this.durationInterval&&(clearInterval(this.durationInterval),this.durationInterval=null),this.callDuration.set(0)}toggleVideo(){this.webrtcService.toggleVideo()}toggleAudio(){this.webrtcService.toggleAudio()}formatDuration(e){let t=Math.floor(e/60),n=e%60;return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}getCallHistory(){return this.http.get(`${this.apiUrl}/calls`)}static \u0275fac=function(t){return new(t||i)(ne(ie),ne(Ue),ne(Oe))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};var Et=class i{constructor(e){this.http=e}apiUrl=$.apiUrl;blockedUsers=b([]);getBlockedUsers(){return this.http.get(`${this.apiUrl}/users/blocked`).pipe(D(e=>this.blockedUsers.set(e)))}blockUser(e){return this.http.post(`${this.apiUrl}/users/block/${e}`,{}).pipe(D(()=>{this.getBlockedUsers().subscribe()}))}unblockUser(e){return this.http.delete(`${this.apiUrl}/users/block/${e}`).pipe(D(()=>{this.blockedUsers.set(this.blockedUsers().filter(t=>t.id!==e))}))}getBlockStatus(e){return this.http.get(`${this.apiUrl}/users/${e}/blocked-status`)}isUserBlocked(e){return this.blockedUsers().some(t=>t.id===e)}static \u0275fac=function(t){return new(t||i)(ne(ie))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};var ho=["messagesContainer"],mo=()=>[1,2,3,4,5,6,7,8],$t=(i,e)=>e.id;function _o(i,e){i&1&&d(0," en l\xEDnea ")}function fo(i,e){i&1&&d(0," \xFAlt. vez hoy ")}function Co(i,e){if(i&1&&(r(0,"span",8),x(1,_o,1,0)(2,fo,1,0),s()),i&2){let t,n=l();c(),f(!((t=n.chatService.selectedChat())==null||t.otroParticipante==null)&&t.otroParticipante.estaEnLinea?1:2)}}function vo(i,e){if(i&1){let t=S();r(0,"button",22),g("click",function(){m(t);let o=l();return _(o.startVoiceCall())}),w(),r(1,"svg",4),h(2,"path",23),s()(),k(),r(3,"button",24),g("click",function(){m(t);let o=l();return _(o.startVideoCall())}),w(),r(4,"svg",4),h(5,"path",25),s()()}}function xo(i,e){if(i&1){let t=S();r(0,"button",27),g("click",function(){m(t);let o=l(3);return _(o.unblockUser())}),w(),r(1,"svg",28),h(2,"path",29),s(),d(3," Desbloquear "),s()}}function bo(i,e){if(i&1){let t=S();r(0,"button",27),g("click",function(){m(t);let o=l(3);return _(o.blockUser())}),w(),r(1,"svg",28),h(2,"path",30),s(),d(3," Bloquear "),s()}}function Mo(i,e){if(i&1&&x(0,xo,4,0,"button")(1,bo,4,0,"button"),i&2){let t,n=l(2);f((t=n.blockStatus())!=null&&t.estaBloqueado?0:1)}}function wo(i,e){if(i&1){let t=S();r(0,"div",26),g("clickOutside",function(){m(t);let o=l();return _(o.closeHeaderMenu())}),x(1,Mo,2,1),s()}if(i&2){let t,n=l();c(),f(((t=n.chatService.selectedChat())==null?null:t.tipo)==="Individual"?1:-1)}}function So(i,e){i&1&&(r(0,"div",35),d(1,"Buscando..."),s())}function Po(i,e){if(i&1){let t=S();r(0,"div",39),g("click",function(){let o=m(t).$implicit,a=l(3);return _(a.scrollToMessage(o.id))}),r(1,"span",40),d(2),s(),r(3,"span",41),d(4),s(),r(5,"span",42),d(6),Ie(7,"date"),s()()}if(i&2){let t=e.$implicit;c(2),P(t.remitenteNombre),c(2),P(t.contenido),c(2),P(Ve(7,3,t.fechaEnvio,"shortDate"))}}function yo(i,e){if(i&1&&(r(0,"div",36),H(1,Po,8,6,"div",38,$t),s()),i&2){let t=l(2);c(),B(t.searchResults())}}function Oo(i,e){i&1&&(r(0,"div",37),d(1,"No se encontraron mensajes"),s())}function ko(i,e){if(i&1){let t=S();r(0,"div",15)(1,"div",31),w(),r(2,"svg",32),h(3,"path",10),s(),k(),r(4,"input",33),Q("ngModelChange",function(o){m(t);let a=l();return K(a.searchQuery,o)||(a.searchQuery=o),_(o)}),g("input",function(){m(t);let o=l();return _(o.onSearchInput())}),s(),r(5,"button",34),g("click",function(){m(t);let o=l();return _(o.toggleSearch())}),d(6,"\u2715"),s()(),x(7,So,2,0,"div",35)(8,yo,3,0,"div",36)(9,Oo,2,0,"div",37),s()}if(i&2){let t=l();c(4),q("ngModel",t.searchQuery),c(3),f(t.isSearching?7:-1),c(),f(t.searchResults().length>0?8:-1),c(),f(!t.isSearching&&t.searchQuery&&t.searchResults().length===0?9:-1)}}function To(i,e){if(i&1&&(r(0,"div",43)(1,"span",45),d(2),s()()),i&2){let t=l().$implicit;R("id","message-"+t.id),c(2),P(t.contenido)}}function Eo(i,e){if(i&1&&(r(0,"span",47),d(1),s()),i&2){let t=l(2).$implicit;c(),P(t.remitenteNombre)}}function Io(i,e){if(i&1&&(r(0,"div",49)(1,"span",57),d(2),s(),r(3,"span",58),d(4),s()()),i&2){let t,n=l(2).$implicit,o=l();c(2),P(n.mensajeRespondido.remitenteId===((t=o.authService.currentUser())==null?null:t.id)?"T\xFA":"Otro"),c(2),P(n.mensajeRespondido.contenido||"\u{1F4CE} Archivo")}}function Vo(i,e){if(i&1){let t=S();r(0,"button",27),g("click",function(){m(t);let o=l(3).$implicit,a=l();return _(a.openForwardModal(o))}),d(1,"Reenviar"),s()}}function Ro(i,e){if(i&1){let t=S();r(0,"button",27),g("click",function(){m(t);let o=l(3).$implicit,a=l();return _(a.copyMessage(o))}),d(1,"Copiar"),s()}}function Lo(i,e){if(i&1){let t=S();r(0,"button",27),g("click",function(){m(t);let o=l(3).$implicit,a=l();return _(a.deleteMessage(o,!1))}),d(1,"Eliminar para m\xED"),s(),r(2,"button",59),g("click",function(){m(t);let o=l(3).$implicit,a=l();return _(a.deleteMessage(o,!0))}),d(3,"Eliminar para todos"),s()}}function Do(i,e){if(i&1){let t=S();r(0,"button",27),g("click",function(){m(t);let o=l(3).$implicit,a=l();return _(a.deleteMessage(o,!1))}),d(1,"Eliminar para m\xED"),s()}}function Ao(i,e){if(i&1){let t=S();r(0,"div",53)(1,"button",27),g("click",function(){m(t);let o=l(2).$implicit,a=l();return _(a.replyToMessage(o))}),d(2,"Responder"),s(),x(3,Vo,2,0,"button")(4,Ro,2,0,"button")(5,Lo,4,0)(6,Do,2,0,"button"),s()}if(i&2){let t=l(2).$implicit,n=l();c(3),f(t.eliminadoParaTodos?-1:3),c(),f(t.contenido?4:-1),c(),f(n.isOwnMessage(t)&&!t.eliminadoParaTodos?5:-1),c(),f(n.isOwnMessage(t)?-1:6)}}function zo(i,e){i&1&&(r(0,"span",54),d(1,"\u{1F6AB} Este mensaje fue eliminado"),s())}function No(i,e){if(i&1){let t=S();r(0,"div",63),g("click",function(){m(t);let o=l(3).$implicit,a=l();return _(a.openImage(o.urlArchivo))}),h(1,"img",64),s()}if(i&2){let t=l(3).$implicit,n=l();c(),R("src",n.getFileUrl(t.urlArchivo),Z)("alt",t.nombreArchivo)}}function $o(i,e){if(i&1&&(r(0,"a",61)(1,"div",65),d(2,"\u{1F4C4}"),s(),r(3,"div",66)(4,"span",67),d(5),s(),r(6,"span",68),d(7),s()()()),i&2){let t=l(3).$implicit,n=l();R("href",n.getFileUrl(t.urlArchivo),Z),c(5),P(t.nombreArchivo),c(2),P(n.formatFileSize(t.tamanoArchivo))}}function Uo(i,e){if(i&1&&h(0,"app-audio-player",62),i&2){let t=l(3).$implicit;R("audioUrl",t.urlArchivo)("duration",t.duracionSegundos)}}function Fo(i,e){if(i&1&&(r(0,"p"),d(1),s()),i&2){let t=l(3).$implicit;c(),P(t.contenido)}}function Wo(i,e){if(i&1&&x(0,No,2,2,"div",60)(1,$o,8,3,"a",61)(2,Uo,1,2,"app-audio-player",62)(3,Fo,2,1,"p"),i&2){let t=l(2).$implicit;f(t.tipo==="Imagen"&&t.urlArchivo?0:-1),c(),f(t.tipo==="Documento"&&t.urlArchivo?1:-1),c(),f(t.tipo==="Audio"&&t.urlArchivo?2:-1),c(),f(t.contenido?3:-1)}}function jo(i,e){i&1&&d(0," \u2713 ")}function Ho(i,e){i&1&&d(0," \u2713\u2713 ")}function Bo(i,e){i&1&&(r(0,"span",69),d(1,"\u2713\u2713"),s())}function Go(i,e){if(i&1&&(r(0,"span",56),x(1,jo,1,0)(2,Ho,1,0)(3,Bo,2,0,"span",69),s()),i&2){let t,n=l(2).$implicit;c(),f((t=n.estado)==="Enviado"?1:t==="Entregado"?2:t==="Leido"?3:-1)}}function qo(i,e){if(i&1){let t=S();r(0,"div",46),x(1,Eo,2,1,"span",47),r(2,"div",48),g("click",function(){m(t);let o=l(2);return _(o.closeMessageMenu())}),x(3,Io,5,2,"div",49),r(4,"button",50),g("click",function(o){m(t);let a=l().$implicit;return l().toggleMessageMenu(a.id),_(o.stopPropagation())}),w(),r(5,"svg",51),h(6,"path",52),s()(),x(7,Ao,7,4,"div",53)(8,zo,2,0,"span",54)(9,Wo,4,4),k(),r(10,"span",55),d(11),Ie(12,"date"),x(13,Go,4,1,"span",56),s()()()}if(i&2){let t,n=l().$implicit,o=l();L("own",o.isOwnMessage(n)),R("id","message-"+n.id),c(),f(!o.isOwnMessage(n)&&((t=o.chatService.selectedChat())==null?null:t.tipo)==="Grupo"?1:-1),c(2),f(n.mensajeRespondido?3:-1),c(4),f(o.activeMessageMenu()===n.id?7:-1),c(),f(n.eliminadoParaTodos?8:9),c(3),E(" ",Ve(12,9,n.fechaEnvio,"shortTime")," "),c(2),f(o.isOwnMessage(n)?13:-1)}}function Ko(i,e){if(i&1&&x(0,To,3,2,"div",43)(1,qo,14,12,"div",44),i&2){let t=e.$implicit;f(t.tipo==="Sistema"?0:1)}}function Qo(i,e){i&1&&(r(0,"div",18)(1,"p"),d(2,"No hay mensajes a\xFAn. \xA1Env\xEDa el primero!"),s()())}function Jo(i,e){if(i&1){let t=S();r(0,"button",71),g("click",function(){m(t);let o=l(2);return _(o.unblockUser())}),d(1,"Desbloquear"),s()}}function Xo(i,e){if(i&1&&(r(0,"div",20),w(),r(1,"svg",32),h(2,"path",30),s(),k(),r(3,"span"),d(4),s(),x(5,Jo,2,0,"button",70),s()),i&2){let t,n=l();c(4),P(n.getBlockMessage()),c(),f((t=n.blockStatus())!=null&&t.estaBloqueado?5:-1)}}function Yo(i,e){if(i&1){let t=S();r(0,"div",72)(1,"div",77)(2,"span",78),d(3),s(),r(4,"span",79),d(5),s()(),r(6,"button",80),g("click",function(){m(t);let o=l(2);return _(o.cancelReply())}),d(7,"\u2715"),s()()}if(i&2){let t,n,o=l(2);c(3),E("Respondiendo a ",(t=o.replyingTo())==null?null:t.remitenteNombre,""),c(2),P(((n=o.replyingTo())==null?null:n.contenido)||"\u{1F4CE} Archivo")}}function Zo(i,e){i&1&&h(0,"div",87)}function er(i,e){if(i&1){let t=S();r(0,"div",73)(1,"button",81),g("click",function(){m(t);let o=l(2);return _(o.cancelRecording())}),w(),r(2,"svg",4),h(3,"path",82),s()(),k(),r(4,"div",83),h(5,"span",84),r(6,"span",85),d(7),s()(),r(8,"div",86),H(9,Zo,1,0,"div",87,Ke),s(),r(11,"button",88),g("click",function(){m(t);let o=l(2);return _(o.stopAndSendRecording())}),w(),r(12,"svg",4),h(13,"path",89),s()()()}if(i&2){let t=l(2);c(7),P(t.audioRecorder.formatDuration(t.audioRecorder.recordingDuration())),c(2),B(Ht(1,mo))}}function tr(i,e){if(i&1){let t=S();r(0,"button",96),g("click",function(){m(t);let o=l(3);return _(o.sendMessage())}),w(),r(1,"svg",4),h(2,"path",89),s()()}}function nr(i,e){if(i&1){let t=S();r(0,"button",97),g("click",function(){m(t);let o=l(3);return _(o.startRecording())}),w(),r(1,"svg",4),h(2,"path",98),s()()}}function ir(i,e){if(i&1){let t=S();r(0,"div",74)(1,"label",90),w(),r(2,"svg",4),h(3,"path",91),s(),k(),r(4,"input",92),g("change",function(o){m(t);let a=l(2);return _(a.onFileSelected(o))}),s()(),r(5,"input",93),Q("ngModelChange",function(o){m(t);let a=l(2);return K(a.newMessage,o)||(a.newMessage=o),_(o)}),g("keydown",function(o){m(t);let a=l(2);return _(a.onKeyDown(o))}),s(),x(6,tr,3,0,"button",94)(7,nr,3,0,"button",95),s()}if(i&2){let t=l(2);c(5),q("ngModel",t.newMessage),c(),f(t.newMessage.trim()||t.selectedFile?6:7)}}function or(i,e){if(i&1){let t=S();r(0,"div",75)(1,"span",99),d(2),s(),r(3,"button",100),g("click",function(){m(t);let o=l(2);return _(o.removeFile())}),d(4,"\u2715"),s()()}if(i&2){let t=l(2);c(2),E("\u{1F4CE} ",t.selectedFile.name,"")}}function rr(i,e){i&1&&(r(0,"div",76),h(1,"div",101),r(2,"span"),d(3,"Enviando..."),s()())}function ar(i,e){if(i&1&&x(0,Yo,8,2,"div",72)(1,er,14,2,"div",73)(2,ir,8,2,"div",74)(3,or,5,1,"div",75)(4,rr,4,0,"div",76),i&2){let t=l();f(t.replyingTo()?0:-1),c(),f(t.audioRecorder.isRecording()?1:2),c(2),f(t.selectedFile?3:-1),c(),f(t.isUploading?4:-1)}}function sr(i,e){if(i&1){let t=S();r(0,"div",109),g("click",function(){let o=m(t).$implicit,a=l(2);return _(a.forwardToChat(o.id))}),r(1,"div",110),d(2),s(),r(3,"span",111),d(4),s()()}if(i&2){let t=e.$implicit,n=l(2);c(2),E(" ",n.getChatDisplayName(t).charAt(0)," "),c(2),P(n.getChatDisplayName(t))}}function cr(i,e){i&1&&(r(0,"p",108),d(1,"No hay otros chats disponibles"),s())}function lr(i,e){if(i&1){let t=S();r(0,"div",102),g("click",function(){m(t);let o=l();return _(o.closeForwardModal())}),r(1,"div",103),g("click",function(o){return m(t),_(o.stopPropagation())}),r(2,"div",104)(3,"h3"),d(4,"Reenviar mensaje a"),s(),r(5,"button",105),g("click",function(){m(t);let o=l();return _(o.closeForwardModal())}),d(6,"\u2715"),s()(),r(7,"div",106),H(8,sr,5,2,"div",107,$t,!1,cr,2,0,"p",108),s()()()}if(i&2){let t=l();c(8),B(t.getAvailableChats())}}var It=class i{constructor(e,t,n,o,a,p){this.chatService=e;this.authService=t;this.signalRService=n;this.audioRecorder=o;this.callService=a;this.blockService=p;Le(()=>{let C=this.chatService.selectedChat();C&&C.id!==this.lastChatId&&(this.lastChatId=C.id,setTimeout(()=>this.markMessagesAsRead(),500),C.tipo==="Individual"&&C.otroParticipante?this.checkBlockStatus(C.otroParticipante.id):this.blockStatus.set(null))})}messagesContainer;newMessage="";selectedFile=null;isUploading=!1;replyingTo=b(null);activeMessageMenu=b(null);isSearchOpen=b(!1);searchQuery="";searchResults=b([]);isSearching=!1;showForwardModal=b(!1);messageToForward=b(null);showHeaderMenu=b(!1);blockStatus=b(null);shouldScroll=!0;lastChatId=null;apiBaseUrl=$.apiUrl.replace("/api","");ngOnInit(){}ngAfterViewChecked(){this.shouldScroll&&this.scrollToBottom()}markMessagesAsRead(){let e=this.chatService.selectedChat();e&&this.chatService.markAllAsRead(e.id).subscribe()}sendMessage(){let e=this.chatService.selectedChat();if(!e)return;if(this.selectedFile){this.isUploading=!0,console.log("Enviando archivo:",this.selectedFile.name,"Tama\xF1o:",this.selectedFile.size),this.chatService.sendMessageWithFile(e.id,this.selectedFile,this.newMessage.trim()||void 0).subscribe({next:()=>{this.newMessage="",this.selectedFile=null,this.isUploading=!1,this.shouldScroll=!0},error:n=>{console.error("Error al enviar archivo:",n),this.isUploading=!1;let o=n.error?.message||"Error al enviar el archivo";alert(o)}});return}if(!this.newMessage.trim())return;let t=this.replyingTo();this.chatService.sendMessage({chatId:e.id,contenido:this.newMessage.trim(),tipo:"Texto",mensajeRespondidoId:t?.id}).subscribe({next:()=>{this.newMessage="",this.replyingTo.set(null),this.shouldScroll=!0}})}onFileSelected(e){let t=e.target;t.files&&t.files[0]&&(this.selectedFile=t.files[0]),t.value=""}removeFile(){this.selectedFile=null}getFileUrl(e){return e.startsWith("http")?e:`${this.apiBaseUrl}${e}`}openImage(e){window.open(this.getFileUrl(e),"_blank")}formatFileSize(e){return e?e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`:""}toggleMessageMenu(e){this.activeMessageMenu()===e?this.activeMessageMenu.set(null):this.activeMessageMenu.set(e)}closeMessageMenu(){this.activeMessageMenu.set(null)}replyToMessage(e){this.replyingTo.set({id:e.id,contenido:e.contenido,remitenteNombre:e.remitenteNombre,tipo:e.tipo}),this.activeMessageMenu.set(null)}cancelReply(){this.replyingTo.set(null)}copyMessage(e){e.contenido&&navigator.clipboard.writeText(e.contenido),this.activeMessageMenu.set(null)}deleteMessage(e,t){this.chatService.deleteMessage(e.id,t).subscribe({next:()=>{let n=this.chatService.messages();if(t){let o=n.map(a=>a.id===e.id?N(y({},a),{eliminadoParaTodos:!0,contenido:void 0}):a);this.chatService.messages.set(o)}else this.chatService.messages.set(n.filter(o=>o.id!==e.id))}}),this.activeMessageMenu.set(null)}getChatName(){let e=this.chatService.selectedChat();return e?e.tipo==="Grupo"?e.nombreGrupo||"Grupo":e.otroParticipante?.nombre||"Usuario":""}isOwnMessage(e){return e.remitenteId===this.authService.currentUser()?.id}closeChat(){this.chatService.selectChat(null)}onKeyDown(e){e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),this.sendMessage())}scrollToBottom(){try{let e=this.messagesContainer?.nativeElement;e&&(e.scrollTop=e.scrollHeight)}catch{}}toggleSearch(){this.isSearchOpen.set(!this.isSearchOpen()),this.isSearchOpen()||(this.searchQuery="",this.searchResults.set([]))}onSearchInput(){if(!this.searchQuery.trim()){this.searchResults.set([]);return}let e=this.chatService.selectedChat();e&&(this.isSearching=!0,this.chatService.searchMessages(e.id,this.searchQuery).subscribe({next:t=>{this.searchResults.set(t),this.isSearching=!1},error:()=>{this.isSearching=!1}}))}scrollToMessage(e){let t=document.getElementById(`message-${e}`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("highlight"),setTimeout(()=>t.classList.remove("highlight"),2e3)),this.isSearchOpen.set(!1),this.searchQuery="",this.searchResults.set([])}openForwardModal(e){this.messageToForward.set(e),this.showForwardModal.set(!0),this.activeMessageMenu.set(null)}closeForwardModal(){this.showForwardModal.set(!1),this.messageToForward.set(null)}forwardToChat(e){let t=this.messageToForward();t&&this.chatService.forwardMessage(t.id,e).subscribe({next:()=>{this.closeForwardModal()}})}getAvailableChats(){let e=this.chatService.selectedChat()?.id;return this.chatService.chats().filter(t=>t.id!==e)}getChatDisplayName(e){return e.tipo==="Grupo"?e.nombreGrupo||"Grupo":e.otroParticipante?.nombre||"Usuario"}startRecording(){return v(this,null,function*(){(yield this.audioRecorder.startRecording())||alert("No se pudo acceder al micr\xF3fono. Verifica los permisos del navegador.")})}cancelRecording(){this.audioRecorder.cancelRecording()}stopAndSendRecording(){return v(this,null,function*(){let e=this.chatService.selectedChat();if(!e)return;let t=yield this.audioRecorder.stopRecording();t&&(this.isUploading=!0,this.chatService.sendAudioMessage(e.id,t.blob,t.duration).subscribe({next:()=>{this.isUploading=!1,this.shouldScroll=!0},error:()=>{this.isUploading=!1,alert("Error al enviar el mensaje de voz")}}))})}startVoiceCall(){let e=this.chatService.selectedChat();e?.otroParticipante&&this.callService.startCall(e.otroParticipante.id,e.otroParticipante.nombre,!1)}startVideoCall(){let e=this.chatService.selectedChat();e?.otroParticipante&&this.callService.startCall(e.otroParticipante.id,e.otroParticipante.nombre,!0)}toggleHeaderMenu(){this.showHeaderMenu.set(!this.showHeaderMenu())}closeHeaderMenu(){this.showHeaderMenu.set(!1)}checkBlockStatus(e){this.blockService.getBlockStatus(e).subscribe({next:t=>{this.blockStatus.set(t)},error:()=>{this.blockStatus.set(null)}})}blockUser(){let e=this.chatService.selectedChat();e?.otroParticipante&&this.blockService.blockUser(e.otroParticipante.id).subscribe({next:()=>{this.blockStatus.set({estaBloqueado:!0,meBloquearon:!1}),this.closeHeaderMenu()},error:t=>{console.error("Error al bloquear usuario:",t)}})}unblockUser(){let e=this.chatService.selectedChat();e?.otroParticipante&&this.blockService.unblockUser(e.otroParticipante.id).subscribe({next:()=>{this.blockStatus.set({estaBloqueado:!1,meBloquearon:!1}),this.closeHeaderMenu()},error:t=>{console.error("Error al desbloquear usuario:",t)}})}isBlocked(){let e=this.blockStatus();return e?.estaBloqueado||e?.meBloquearon||!1}getBlockMessage(){let e=this.blockStatus();return e?.meBloquearon?"Este usuario te ha bloqueado":e?.estaBloqueado?"Has bloqueado a este usuario":""}static \u0275fac=function(t){return new(t||i)(I(ce),I(he),I(Oe),I(kt),I(ve),I(Et))};static \u0275cmp=U({type:i,selectors:[["app-chat-window"]],viewQuery:function(t,n){if(t&1&&Me(ho,5),t&2){let o;we(o=Se())&&(n.messagesContainer=o.first)}},decls:31,vars:9,consts:[["messagesContainer",""],[1,"chat-window"],[1,"chat-header"],[1,"back-btn",3,"click"],["viewBox","0 0 24 24","width","24","height","24"],["fill","currentColor","d","M12 4l1.4 1.4L7.8 11H20v2H7.8l5.6 5.6L12 20l-8-8 8-8z"],[1,"avatar"],[1,"chat-info"],[1,"status"],["title","Buscar",1,"search-btn",3,"click"],["fill","currentColor","d","M15.009 13.805h-.636l-.22-.219a5.184 5.184 0 0 0 1.256-3.386 5.207 5.207 0 1 0-5.207 5.208 5.183 5.183 0 0 0 3.385-1.255l.221.22v.635l4.004 3.999 1.194-1.195-3.997-4.007zm-4.808 0a3.605 3.605 0 1 1 0-7.21 3.605 3.605 0 0 1 0 7.21z"],[1,"header-menu-container"],["title","M\xE1s opciones",1,"menu-btn",3,"click"],["fill","currentColor","d","M12 7a2 2 0 1 0-.001-4.001A2 2 0 0 0 12 7zm0 2a2 2 0 1 0-.001 3.999A2 2 0 0 0 12 9zm0 6a2 2 0 1 0-.001 3.999A2 2 0 0 0 12 15z"],[1,"header-dropdown-menu"],[1,"search-panel"],[1,"messages-container"],[1,"messages-wrapper"],[1,"no-messages"],[1,"message-input"],[1,"blocked-banner"],[1,"forward-modal-overlay"],["title","Llamada de voz",1,"call-btn",3,"click"],["fill","currentColor","d","M20.01 15.38c-1.23 0-2.42-.2-3.53-.56-.35-.12-.74-.03-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"],["title","Videollamada",1,"call-btn",3,"click"],["fill","currentColor","d","M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"],[1,"header-dropdown-menu",3,"clickOutside"],[3,"click"],["viewBox","0 0 24 24","width","18","height","18"],["fill","currentColor","d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"],["fill","currentColor","d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9A7.902 7.902 0 0 1 4 12zm8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1A7.902 7.902 0 0 1 20 12c0 4.42-3.58 8-8 8z"],[1,"search-input-wrapper"],["viewBox","0 0 24 24","width","20","height","20"],["type","text","placeholder","Buscar en el chat...","autofocus","",3,"ngModelChange","input","ngModel"],[1,"close-search",3,"click"],[1,"search-loading"],[1,"search-results"],[1,"no-results"],[1,"search-result-item"],[1,"search-result-item",3,"click"],[1,"result-sender"],[1,"result-content"],[1,"result-date"],[1,"system-message",3,"id"],[1,"message",3,"id","own"],[1,"system-message-content"],[1,"message",3,"id"],[1,"sender-name"],[1,"message-bubble",3,"click"],[1,"replied-message"],[1,"message-menu-btn",3,"click"],["viewBox","0 0 19 20","width","18","height","18"],["fill","currentColor","d","M3.8 6.7l5.7 5.7 5.7-5.7 1.6 1.6-7.3 7.2-7.3-7.2 1.6-1.6z"],[1,"message-actions-menu"],[1,"deleted-message"],[1,"message-time"],[1,"message-status"],[1,"replied-sender"],[1,"replied-content"],[1,"danger",3,"click"],[1,"message-image"],["target","_blank","download","",1,"message-document",3,"href"],[3,"audioUrl","duration"],[1,"message-image",3,"click"],[3,"src","alt"],[1,"doc-icon"],[1,"doc-info"],[1,"doc-name"],[1,"doc-size"],[1,"read"],[1,"unblock-btn"],[1,"unblock-btn",3,"click"],[1,"reply-bar"],[1,"recording-container"],[1,"input-container"],[1,"file-preview"],[1,"upload-progress"],[1,"reply-info"],[1,"reply-to"],[1,"reply-content"],[1,"cancel-reply",3,"click"],["title","Cancelar",1,"cancel-recording-btn",3,"click"],["fill","currentColor","d","M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"],[1,"recording-indicator"],[1,"recording-dot"],[1,"recording-time"],[1,"recording-waveform"],[1,"wave-bar"],["title","Enviar",1,"send-recording-btn",3,"click"],["fill","currentColor","d","M1.101 21.757L23.8 12.028 1.101 2.3l.011 7.912 13.623 1.816-13.623 1.817-.011 7.912z"],["title","Adjuntar archivo",1,"attach-btn"],["fill","currentColor","d","M1.816 15.556v.002c0 1.502.584 2.912 1.646 3.972s2.472 1.647 3.974 1.647a5.58 5.58 0 0 0 3.972-1.645l9.547-9.548c.769-.768 1.147-1.767 1.058-2.817-.079-.968-.548-1.927-1.319-2.698-1.594-1.592-4.068-1.711-5.517-.262l-7.916 7.915c-.881.881-.792 2.25.214 3.261.959.958 2.423 1.053 3.263.215l5.511-5.512c.28-.28.267-.722.053-.936l-.244-.244c-.191-.191-.567-.349-.957.04l-5.506 5.506c-.18.18-.635.127-.976-.214-.098-.097-.576-.613-.213-.973l7.915-7.917c.818-.817 2.267-.699 3.23.262.5.501.802 1.1.849 1.685.051.573-.156 1.111-.589 1.543l-9.547 9.549a3.97 3.97 0 0 1-2.829 1.171 3.975 3.975 0 0 1-2.83-1.173 3.973 3.973 0 0 1-1.172-2.828c0-1.071.415-2.076 1.172-2.83l7.209-7.211c.157-.157.264-.579.028-.814L11.5 4.36a.572.572 0 0 0-.834.018l-7.205 7.207a5.577 5.577 0 0 0-1.645 3.971z"],["type","file","accept","image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt,.zip","hidden","",3,"change"],["type","text","placeholder","Escribe un mensaje",3,"ngModelChange","keydown","ngModel"],[1,"send-btn"],["title","Grabar mensaje de voz",1,"mic-btn"],[1,"send-btn",3,"click"],["title","Grabar mensaje de voz",1,"mic-btn",3,"click"],["fill","currentColor","d","M11.999 14.942c2.001 0 3.531-1.53 3.531-3.531V4.35c0-2.001-1.53-3.531-3.531-3.531S8.469 2.35 8.469 4.35v7.061c0 2.001 1.53 3.531 3.53 3.531zm6.238-3.53c0 3.531-2.942 6.002-6.237 6.002s-6.237-2.471-6.237-6.002H3.761c0 4.001 3.178 7.297 7.061 7.885v3.884h2.354v-3.884c3.884-.588 7.061-3.884 7.061-7.885h-2z"],[1,"file-name"],[1,"remove-file",3,"click"],[1,"progress-bar"],[1,"forward-modal-overlay",3,"click"],[1,"forward-modal",3,"click"],[1,"forward-modal-header"],[1,"close-modal",3,"click"],[1,"forward-modal-content"],[1,"forward-chat-item"],[1,"no-chats"],[1,"forward-chat-item",3,"click"],[1,"forward-chat-avatar"],[1,"forward-chat-name"]],template:function(t,n){if(t&1){let o=S();r(0,"div",1)(1,"header",2)(2,"button",3),g("click",function(){return m(o),_(n.closeChat())}),w(),r(3,"svg",4),h(4,"path",5),s()(),k(),r(5,"div",6),d(6),s(),r(7,"div",7)(8,"h3"),d(9),s(),x(10,Co,3,1,"span",8),s(),x(11,vo,6,0),r(12,"button",9),g("click",function(){return m(o),_(n.toggleSearch())}),w(),r(13,"svg",4),h(14,"path",10),s()(),k(),r(15,"div",11)(16,"button",12),g("click",function(){return m(o),_(n.toggleHeaderMenu())}),w(),r(17,"svg",4),h(18,"path",13),s()(),x(19,wo,2,1,"div",14),s()(),x(20,ko,10,4,"div",15),k(),r(21,"div",16,0)(23,"div",17),H(24,Ko,2,1,null,null,$t,!1,Qo,3,0,"div",18),s()(),r(27,"footer",19),x(28,Xo,6,2,"div",20)(29,ar,5,4),s()(),x(30,lr,11,1,"div",21)}if(t&2){let o,a;c(6),E(" ",n.getChatName().charAt(0)," "),c(3),P(n.getChatName()),c(),f(((o=n.chatService.selectedChat())==null?null:o.tipo)==="Individual"?10:-1),c(),f(((a=n.chatService.selectedChat())==null?null:a.tipo)==="Individual"?11:-1),c(8),f(n.showHeaderMenu()?19:-1),c(),f(n.isSearchOpen()?20:-1),c(4),B(n.chatService.messages()),c(4),f(n.isBlocked()?28:29),c(2),f(n.showForwardModal()?30:-1)}},dependencies:[F,Qe,se,oe,re,ae,st],styles:['[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1;min-height:0}.chat-window[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-height:0}.chat-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:10px 16px;background:var(--header-bg);gap:15px;flex-shrink:0}.chat-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]{display:none;border:none;background:none;cursor:pointer;padding:8px;color:var(--icon-color)}@media (max-width: 768px){.chat-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]{display:block}}.chat-header[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#25d366);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:500}.chat-header[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]{flex:1}.chat-header[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:500;color:var(--text-primary)}.chat-header[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{font-size:13px;color:var(--text-secondary)}.chat-header[_ngcontent-%COMP%]   .search-btn[_ngcontent-%COMP%], .chat-header[_ngcontent-%COMP%]   .call-btn[_ngcontent-%COMP%], .chat-header[_ngcontent-%COMP%]   .menu-btn[_ngcontent-%COMP%]{border:none;background:none;cursor:pointer;padding:8px;color:var(--icon-color);border-radius:50%;transition:all .2s}.chat-header[_ngcontent-%COMP%]   .search-btn[_ngcontent-%COMP%]:hover, .chat-header[_ngcontent-%COMP%]   .call-btn[_ngcontent-%COMP%]:hover, .chat-header[_ngcontent-%COMP%]   .menu-btn[_ngcontent-%COMP%]:hover{background:var(--hover-bg);color:var(--accent)}.chat-header[_ngcontent-%COMP%]   .header-menu-container[_ngcontent-%COMP%]{position:relative}.chat-header[_ngcontent-%COMP%]   .header-menu-container[_ngcontent-%COMP%]   .header-dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;background:var(--bg-primary);border-radius:8px;box-shadow:0 2px 12px var(--shadow-medium);z-index:100;min-width:180px;overflow:hidden;margin-top:4px}.chat-header[_ngcontent-%COMP%]   .header-menu-container[_ngcontent-%COMP%]   .header-dropdown-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;width:100%;padding:12px 16px;border:none;background:none;text-align:left;font-size:14px;color:var(--text-primary);cursor:pointer}.chat-header[_ngcontent-%COMP%]   .header-menu-container[_ngcontent-%COMP%]   .header-dropdown-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--icon-color)}.chat-header[_ngcontent-%COMP%]   .header-menu-container[_ngcontent-%COMP%]   .header-dropdown-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:var(--hover-bg)}.search-panel[_ngcontent-%COMP%]{background:var(--header-bg);border-bottom:1px solid var(--border-color);padding:10px 16px;flex-shrink:0}.search-panel[_ngcontent-%COMP%]   .search-input-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;background:var(--bg-primary);border-radius:8px;padding:8px 12px}.search-panel[_ngcontent-%COMP%]   .search-input-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--icon-color);flex-shrink:0}.search-panel[_ngcontent-%COMP%]   .search-input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border:none;outline:none;font-size:14px;background:transparent;color:var(--text-primary)}.search-panel[_ngcontent-%COMP%]   .search-input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--text-secondary)}.search-panel[_ngcontent-%COMP%]   .search-input-wrapper[_ngcontent-%COMP%]   .close-search[_ngcontent-%COMP%]{border:none;background:none;cursor:pointer;color:var(--text-secondary);font-size:16px;padding:4px}.search-panel[_ngcontent-%COMP%]   .search-input-wrapper[_ngcontent-%COMP%]   .close-search[_ngcontent-%COMP%]:hover{color:var(--text-primary)}.search-panel[_ngcontent-%COMP%]   .search-loading[_ngcontent-%COMP%], .search-panel[_ngcontent-%COMP%]   .no-results[_ngcontent-%COMP%]{padding:12px;text-align:center;color:var(--text-secondary);font-size:14px}.search-panel[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto;margin-top:8px}.search-panel[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:10px 12px;background:var(--bg-primary);border-radius:6px;margin-bottom:4px;cursor:pointer}.search-panel[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]:hover{background:var(--hover-bg)}.search-panel[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]   .result-sender[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:var(--accent)}.search-panel[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]   .result-content[_ngcontent-%COMP%]{font-size:14px;color:var(--text-primary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.search-panel[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]   .result-date[_ngcontent-%COMP%]{font-size:12px;color:var(--text-secondary);margin-top:2px}.messages-container[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:20px 60px;background:var(--bg-chat);background-image:var(--bg-chat-pattern);min-height:0}.messages-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.system-message[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:8px 16px}.system-message[_ngcontent-%COMP%]   .system-message-content[_ngcontent-%COMP%]{background:var(--bubble-system);color:var(--text-secondary);padding:6px 12px;border-radius:8px;font-size:12.5px;box-shadow:0 1px .5px var(--shadow-light);max-width:80%;text-align:center}.message[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-width:65%;transition:background-color .3s ease}.message.highlight[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_highlightMessage 2s ease}.message.own[_ngcontent-%COMP%]{align-self:flex-end}.message.own[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background:var(--bubble-own)}.message[_ngcontent-%COMP%]   .sender-name[_ngcontent-%COMP%]{font-size:12px;color:var(--accent);margin-bottom:2px;margin-left:12px;font-weight:500}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background:var(--bubble-other);padding:6px 12px 8px;border-radius:8px;box-shadow:0 1px .5px var(--shadow-light);position:relative}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .replied-message[_ngcontent-%COMP%]{background:var(--border-light);border-left:4px solid var(--accent);padding:6px 10px;margin-bottom:6px;border-radius:4px}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .replied-message[_ngcontent-%COMP%]   .replied-sender[_ngcontent-%COMP%]{display:block;font-size:12px;font-weight:500;color:var(--accent)}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .replied-message[_ngcontent-%COMP%]   .replied-content[_ngcontent-%COMP%]{display:block;font-size:13px;color:var(--text-secondary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:200px}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-menu-btn[_ngcontent-%COMP%]{position:absolute;top:4px;right:4px;width:24px;height:24px;border:none;background:none;cursor:pointer;color:var(--text-secondary);opacity:0;transition:opacity .2s;border-radius:4px}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-menu-btn[_ngcontent-%COMP%]:hover{background:var(--border-light)}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]:hover   .message-menu-btn[_ngcontent-%COMP%]{opacity:1}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-actions-menu[_ngcontent-%COMP%]{position:absolute;top:30px;right:4px;background:var(--bg-primary);border-radius:8px;box-shadow:0 2px 12px var(--shadow-medium);z-index:10;overflow:hidden;min-width:160px}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-actions-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:block;width:100%;padding:10px 16px;border:none;background:none;text-align:left;font-size:14px;color:var(--text-primary);cursor:pointer}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-actions-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:var(--hover-bg)}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-actions-menu[_ngcontent-%COMP%]   button.danger[_ngcontent-%COMP%]{color:var(--danger)}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:var(--text-primary);line-height:1.4;word-wrap:break-word}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .deleted-message[_ngcontent-%COMP%]{font-style:italic;color:var(--text-secondary);font-size:14px}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:4px;font-size:11px;color:var(--text-secondary);margin-top:4px}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]   .message-status[_ngcontent-%COMP%]{color:var(--text-secondary)}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]   .message-status[_ngcontent-%COMP%]   .read[_ngcontent-%COMP%]{color:var(--check-color)}.no-messages[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%}.no-messages[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{background:var(--bubble-other);padding:12px 20px;border-radius:8px;color:var(--text-secondary);font-size:14px}.message-image[_ngcontent-%COMP%]{margin-bottom:4px;cursor:pointer}.message-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:300px;max-height:300px;border-radius:6px;object-fit:cover}.message-document[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;background:var(--border-light);padding:10px 12px;border-radius:6px;text-decoration:none;color:inherit;margin-bottom:4px}.message-document[_ngcontent-%COMP%]:hover{background:var(--hover-bg)}.message-document[_ngcontent-%COMP%]   .doc-icon[_ngcontent-%COMP%]{font-size:28px}.message-document[_ngcontent-%COMP%]   .doc-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.message-document[_ngcontent-%COMP%]   .doc-info[_ngcontent-%COMP%]   .doc-name[_ngcontent-%COMP%]{font-size:14px;color:var(--text-primary);word-break:break-word}.message-document[_ngcontent-%COMP%]   .doc-info[_ngcontent-%COMP%]   .doc-size[_ngcontent-%COMP%]{font-size:12px;color:var(--text-secondary)}.message-input[_ngcontent-%COMP%]{padding:10px 16px;background:var(--header-bg);flex-shrink:0}.message-input[_ngcontent-%COMP%]   .blocked-banner[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:10px;background:var(--bg-primary);border-radius:8px;padding:16px 20px;color:var(--text-secondary)}.message-input[_ngcontent-%COMP%]   .blocked-banner[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--danger);flex-shrink:0}.message-input[_ngcontent-%COMP%]   .blocked-banner[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px}.message-input[_ngcontent-%COMP%]   .blocked-banner[_ngcontent-%COMP%]   .unblock-btn[_ngcontent-%COMP%]{margin-left:auto;padding:8px 16px;border:none;background:var(--accent);color:#fff;border-radius:6px;font-size:13px;cursor:pointer;transition:all .2s}.message-input[_ngcontent-%COMP%]   .blocked-banner[_ngcontent-%COMP%]   .unblock-btn[_ngcontent-%COMP%]:hover{background:var(--accent-dark);transform:scale(1.02)}.message-input[_ngcontent-%COMP%]   .reply-bar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background:var(--bg-primary);padding:8px 12px;border-radius:8px;margin-bottom:8px;border-left:4px solid var(--accent)}.message-input[_ngcontent-%COMP%]   .reply-bar[_ngcontent-%COMP%]   .reply-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;overflow:hidden}.message-input[_ngcontent-%COMP%]   .reply-bar[_ngcontent-%COMP%]   .reply-info[_ngcontent-%COMP%]   .reply-to[_ngcontent-%COMP%]{font-size:12px;font-weight:500;color:var(--accent)}.message-input[_ngcontent-%COMP%]   .reply-bar[_ngcontent-%COMP%]   .reply-info[_ngcontent-%COMP%]   .reply-content[_ngcontent-%COMP%]{font-size:13px;color:var(--text-secondary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.message-input[_ngcontent-%COMP%]   .reply-bar[_ngcontent-%COMP%]   .cancel-reply[_ngcontent-%COMP%]{border:none;background:none;cursor:pointer;color:var(--text-secondary);font-size:16px;padding:4px 8px;margin-left:8px}.message-input[_ngcontent-%COMP%]   .reply-bar[_ngcontent-%COMP%]   .cancel-reply[_ngcontent-%COMP%]:hover{color:var(--text-primary)}.message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;background:var(--bg-primary);border-radius:8px;padding:5px 10px}.message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .attach-btn[_ngcontent-%COMP%]{width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--icon-color);border-radius:50%;transition:background .2s}.message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .attach-btn[_ngcontent-%COMP%]:hover{background:var(--hover-bg)}.message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border:none;padding:10px;font-size:15px;background:transparent;color:var(--text-primary)}.message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none}.message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--text-secondary)}.message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%], .message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .mic-btn[_ngcontent-%COMP%]{width:40px;height:40px;border:none;background:none;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--icon-color);border-radius:50%;transition:all .2s}.message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]:hover:not(:disabled), .message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .mic-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--hover-bg);color:var(--accent)}.message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]:disabled, .message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .mic-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .mic-btn[_ngcontent-%COMP%]:hover{color:#25d366}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;background:var(--bg-primary);border-radius:8px;padding:8px 12px}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .cancel-recording-btn[_ngcontent-%COMP%]{width:40px;height:40px;border:none;background:var(--hover-bg);color:var(--danger);cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .2s}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .cancel-recording-btn[_ngcontent-%COMP%]:hover{background:var(--danger);color:#fff}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .recording-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .recording-indicator[_ngcontent-%COMP%]   .recording-dot[_ngcontent-%COMP%]{width:10px;height:10px;background:var(--danger);border-radius:50%;animation:_ngcontent-%COMP%_pulse 1s ease-in-out infinite}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .recording-indicator[_ngcontent-%COMP%]   .recording-time[_ngcontent-%COMP%]{font-size:16px;font-weight:500;color:var(--text-primary);min-width:45px}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .recording-waveform[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:3px;height:32px}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .recording-waveform[_ngcontent-%COMP%]   .wave-bar[_ngcontent-%COMP%]{width:4px;background:#25d366;border-radius:2px;animation:_ngcontent-%COMP%_wave .5s ease-in-out infinite alternate}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .recording-waveform[_ngcontent-%COMP%]   .wave-bar[_ngcontent-%COMP%]:nth-child(1){height:12px;animation-delay:.1s}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .recording-waveform[_ngcontent-%COMP%]   .wave-bar[_ngcontent-%COMP%]:nth-child(2){height:24px;animation-delay:.2s}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .recording-waveform[_ngcontent-%COMP%]   .wave-bar[_ngcontent-%COMP%]:nth-child(3){height:16px;animation-delay:.3s}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .recording-waveform[_ngcontent-%COMP%]   .wave-bar[_ngcontent-%COMP%]:nth-child(4){height:28px;animation-delay:.4s}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .recording-waveform[_ngcontent-%COMP%]   .wave-bar[_ngcontent-%COMP%]:nth-child(5){height:20px;animation-delay:.5s}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .recording-waveform[_ngcontent-%COMP%]   .wave-bar[_ngcontent-%COMP%]:nth-child(6){height:32px;animation-delay:.6s}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .recording-waveform[_ngcontent-%COMP%]   .wave-bar[_ngcontent-%COMP%]:nth-child(7){height:18px;animation-delay:.7s}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .recording-waveform[_ngcontent-%COMP%]   .wave-bar[_ngcontent-%COMP%]:nth-child(8){height:26px;animation-delay:.8s}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .send-recording-btn[_ngcontent-%COMP%]{width:48px;height:48px;border:none;background:#25d366;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .2s}.message-input[_ngcontent-%COMP%]   .recording-container[_ngcontent-%COMP%]   .send-recording-btn[_ngcontent-%COMP%]:hover{background:#128c7e;transform:scale(1.05)}.message-input[_ngcontent-%COMP%]   .file-preview[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background:var(--bubble-own);padding:8px 12px;border-radius:6px;margin-top:8px}.message-input[_ngcontent-%COMP%]   .file-preview[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{font-size:13px;color:var(--text-primary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.message-input[_ngcontent-%COMP%]   .file-preview[_ngcontent-%COMP%]   .remove-file[_ngcontent-%COMP%]{border:none;background:none;cursor:pointer;color:var(--text-secondary);font-size:16px;padding:4px 8px}.message-input[_ngcontent-%COMP%]   .file-preview[_ngcontent-%COMP%]   .remove-file[_ngcontent-%COMP%]:hover{color:var(--danger)}.message-input[_ngcontent-%COMP%]   .upload-progress[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-top:8px}.message-input[_ngcontent-%COMP%]   .upload-progress[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{flex:1;height:4px;background:var(--border-color);border-radius:2px;overflow:hidden;position:relative}.message-input[_ngcontent-%COMP%]   .upload-progress[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;height:100%;width:30%;background:var(--accent);animation:_ngcontent-%COMP%_progress 1s ease-in-out infinite}.message-input[_ngcontent-%COMP%]   .upload-progress[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;color:var(--text-secondary)}@keyframes _ngcontent-%COMP%_progress{0%{left:-30%}to{left:100%}}@keyframes _ngcontent-%COMP%_highlightMessage{0%{background-color:#00a8844d}to{background-color:transparent}}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(1.1)}}@keyframes _ngcontent-%COMP%_wave{0%{height:8px}to{height:28px}}.forward-modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--overlay-bg);display:flex;align-items:center;justify-content:center;z-index:1000}.forward-modal[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:12px;width:90%;max-width:400px;max-height:70vh;overflow:hidden;display:flex;flex-direction:column}.forward-modal[_ngcontent-%COMP%]   .forward-modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;background:var(--accent);color:#fff}.forward-modal[_ngcontent-%COMP%]   .forward-modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:500}.forward-modal[_ngcontent-%COMP%]   .forward-modal-header[_ngcontent-%COMP%]   .close-modal[_ngcontent-%COMP%]{border:none;background:none;color:#fff;font-size:20px;cursor:pointer;padding:4px 8px}.forward-modal[_ngcontent-%COMP%]   .forward-modal-header[_ngcontent-%COMP%]   .close-modal[_ngcontent-%COMP%]:hover{opacity:.8}.forward-modal[_ngcontent-%COMP%]   .forward-modal-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:8px 0}.forward-modal[_ngcontent-%COMP%]   .forward-chat-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 20px;cursor:pointer}.forward-modal[_ngcontent-%COMP%]   .forward-chat-item[_ngcontent-%COMP%]:hover{background:var(--hover-bg)}.forward-modal[_ngcontent-%COMP%]   .forward-chat-item[_ngcontent-%COMP%]   .forward-chat-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#25d366);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:500}.forward-modal[_ngcontent-%COMP%]   .forward-chat-item[_ngcontent-%COMP%]   .forward-chat-name[_ngcontent-%COMP%]{font-size:15px;color:var(--text-primary)}.forward-modal[_ngcontent-%COMP%]   .no-chats[_ngcontent-%COMP%]{text-align:center;padding:20px;color:var(--text-secondary)}@media (max-width: 768px){.messages-container[_ngcontent-%COMP%]{padding:15px 12px}.message[_ngcontent-%COMP%]{max-width:85%}.message-input[_ngcontent-%COMP%]{padding:8px 10px}}@media (max-width: 480px){.chat-header[_ngcontent-%COMP%]{padding:8px 12px;gap:10px}.chat-header[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:36px;height:36px;font-size:14px}.chat-header[_ngcontent-%COMP%]   .chat-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:15px}.messages-container[_ngcontent-%COMP%]{padding:10px 8px}.message[_ngcontent-%COMP%]{max-width:90%}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{padding:5px 10px 6px}.message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px}.message-input[_ngcontent-%COMP%]{padding:6px 8px}.message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]{padding:3px 8px}.message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:8px;font-size:14px}.message-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]{width:36px;height:36px}}']})};function dr(i,e){if(i&1&&h(0,"img",4),i&2){let t=l();R("src",t.callerPhoto,Z)("alt",t.callerName)}}function pr(i,e){if(i&1&&d(0),i&2){let t=l();E(" ",t.callerName.charAt(0)," ")}}function ur(i,e){i&1&&d(0," Videollamada entrante... ")}function gr(i,e){i&1&&d(0," Llamada de voz entrante... ")}function hr(i,e){i&1&&(w(),r(0,"svg",9),h(1,"path",16),s())}function mr(i,e){i&1&&(w(),r(0,"svg",9),h(1,"path",17),s())}var Vt=class i{constructor(e){this.callService=e}get callerName(){return this.callService.callState().callerName||"Desconocido"}get callerPhoto(){return this.callService.callState().callerPhoto}get isVideo(){return this.callService.callState().isVideo}accept(){this.callService.acceptCall()}reject(){this.callService.rejectCall()}static \u0275fac=function(t){return new(t||i)(I(ve))};static \u0275cmp=U({type:i,selectors:[["app-incoming-call"]],decls:22,vars:4,consts:[[1,"incoming-call-overlay"],[1,"incoming-call-modal"],[1,"caller-info"],[1,"caller-avatar"],[3,"src","alt"],[1,"caller-name"],[1,"call-type"],[1,"call-actions"],["title","Rechazar",1,"reject-btn",3,"click"],["viewBox","0 0 24 24","width","32","height","32"],["fill","currentColor","d","M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.1-.7-.28-.79-.73-1.68-1.36-2.66-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"],["title","Aceptar",1,"accept-btn",3,"click"],[1,"ring-animation"],[1,"ring","ring-1"],[1,"ring","ring-2"],[1,"ring","ring-3"],["fill","currentColor","d","M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"],["fill","currentColor","d","M20.01 15.38c-1.23 0-2.42-.2-3.53-.56-.35-.12-.74-.03-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),x(4,dr,1,2,"img",4)(5,pr,1,1),s(),r(6,"h2",5),d(7),s(),r(8,"p",6),x(9,ur,1,0)(10,gr,1,0),s()(),r(11,"div",7)(12,"button",8),g("click",function(){return n.reject()}),w(),r(13,"svg",9),h(14,"path",10),s()(),k(),r(15,"button",11),g("click",function(){return n.accept()}),x(16,hr,2,0,":svg:svg",9)(17,mr,2,0,":svg:svg",9),s()(),r(18,"div",12),h(19,"div",13)(20,"div",14)(21,"div",15),s()()()),t&2&&(c(4),f(n.callerPhoto?4:5),c(3),P(n.callerName),c(2),f(n.isVideo?9:10),c(7),f(n.isVideo?16:17))},dependencies:[F],styles:[".incoming-call-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000d9;display:flex;align-items:center;justify-content:center;z-index:9999}.incoming-call-modal[_ngcontent-%COMP%]{text-align:center;color:#fff;position:relative}.caller-info[_ngcontent-%COMP%]{margin-bottom:60px}.caller-avatar[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:50%;background:linear-gradient(135deg,#00a884,#25d366);display:flex;align-items:center;justify-content:center;font-size:48px;font-weight:500;margin:0 auto 20px;overflow:hidden}.caller-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.caller-name[_ngcontent-%COMP%]{font-size:28px;font-weight:500;margin:0 0 10px}.call-type[_ngcontent-%COMP%]{font-size:16px;color:#ffffffb3;margin:0;animation:_ngcontent-%COMP%_pulse-text 2s ease-in-out infinite}.call-actions[_ngcontent-%COMP%]{display:flex;gap:60px;justify-content:center}.reject-btn[_ngcontent-%COMP%], .accept-btn[_ngcontent-%COMP%]{width:70px;height:70px;border-radius:50%;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform .2s,box-shadow .2s}.reject-btn[_ngcontent-%COMP%]:hover, .accept-btn[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.reject-btn[_ngcontent-%COMP%]{background:#dc3545;color:#fff;box-shadow:0 4px 20px #dc354566}.reject-btn[_ngcontent-%COMP%]:hover{box-shadow:0 6px 25px #dc354599}.accept-btn[_ngcontent-%COMP%]{background:#25d366;color:#fff;box-shadow:0 4px 20px #25d36666;animation:_ngcontent-%COMP%_pulse-btn 2s ease-in-out infinite}.accept-btn[_ngcontent-%COMP%]:hover{box-shadow:0 6px 25px #25d36699}.ring-animation[_ngcontent-%COMP%]{position:absolute;top:0;left:50%;transform:translate(-50%);width:120px;height:120px;pointer-events:none}.ring[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);border:2px solid rgba(37,211,102,.5);border-radius:50%;animation:_ngcontent-%COMP%_ring-expand 2s ease-out infinite}.ring-1[_ngcontent-%COMP%]{animation-delay:0s}.ring-2[_ngcontent-%COMP%]{animation-delay:.5s}.ring-3[_ngcontent-%COMP%]{animation-delay:1s}@keyframes _ngcontent-%COMP%_ring-expand{0%{width:120px;height:120px;opacity:1}to{width:200px;height:200px;opacity:0}}@keyframes _ngcontent-%COMP%_pulse-btn{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}@keyframes _ngcontent-%COMP%_pulse-text{0%,to{opacity:1}50%{opacity:.5}}"]})};var _r=["remoteVideo"],fr=["localVideo"];function Cr(i,e){i&1&&h(0,"video",11,0)(2,"video",12,1)}function vr(i,e){if(i&1&&(r(0,"div",3)(1,"div",13),d(2),s(),r(3,"h2",14),d(4),s(),r(5,"p",15),d(6),s()()),i&2){let t=l();c(2),E(" ",t.otherUserName.charAt(0)," "),c(2),P(t.otherUserName),c(2),P(t.duration)}}function xr(i,e){i&1&&(w(),r(0,"svg",6),h(1,"path",16),s())}function br(i,e){i&1&&(w(),r(0,"svg",6),h(1,"path",17),s())}function Mr(i,e){i&1&&(w(),r(0,"svg",6),h(1,"path",19),s())}function wr(i,e){i&1&&(w(),r(0,"svg",6),h(1,"path",20),s())}function Sr(i,e){if(i&1){let t=S();r(0,"button",18),g("click",function(){m(t);let o=l();return _(o.toggleVideo())}),x(1,Mr,2,0,":svg:svg",6)(2,wr,2,0,":svg:svg",6),s()}if(i&2){let t=l();L("off",!t.isVideoEnabled),c(),f(t.isVideoEnabled?1:2)}}function Pr(i,e){if(i&1&&(r(0,"div",10)(1,"span",21),d(2),s()()),i&2){let t=l();c(2),P(t.duration)}}var Rt=class i{constructor(e,t){this.callService=e;this.webrtcService=t;Le(()=>{let n=this.webrtcService.remoteStream();n&&this.remoteVideoRef?.nativeElement&&(this.remoteVideoRef.nativeElement.srcObject=n)})}remoteVideoRef;localVideoRef;ngAfterViewInit(){let e=this.webrtcService.getLocalStream2();e&&this.localVideoRef?.nativeElement&&(this.localVideoRef.nativeElement.srcObject=e)}ngOnDestroy(){this.remoteVideoRef?.nativeElement&&(this.remoteVideoRef.nativeElement.srcObject=null),this.localVideoRef?.nativeElement&&(this.localVideoRef.nativeElement.srcObject=null)}get otherUserName(){let e=this.callService.callState();return e.callerName||e.targetUserName||"Usuario"}get isVideo(){return this.callService.callState().isVideo}get duration(){return this.callService.formatDuration(this.callService.callDuration())}get isAudioEnabled(){return this.webrtcService.localAudioEnabled()}get isVideoEnabled(){return this.webrtcService.localVideoEnabled()}toggleMute(){this.callService.toggleAudio()}toggleVideo(){this.callService.toggleVideo()}endCall(){this.callService.endCall()}static \u0275fac=function(t){return new(t||i)(I(ve),I(Ue))};static \u0275cmp=U({type:i,selectors:[["app-active-call"]],viewQuery:function(t,n){if(t&1&&(Me(_r,5),Me(fr,5)),t&2){let o;we(o=Se())&&(n.remoteVideoRef=o.first),we(o=Se())&&(n.localVideoRef=o.first)}},decls:12,vars:8,consts:[["remoteVideo",""],["localVideo",""],[1,"active-call-overlay"],[1,"voice-call-ui"],[1,"call-controls"],["title","Silenciar",1,"control-btn",3,"click"],["viewBox","0 0 24 24","width","24","height","24"],["title","C\xE1mara",1,"control-btn",3,"off"],["title","Colgar",1,"control-btn","end-call",3,"click"],["fill","currentColor","d","M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.1-.7-.28-.79-.73-1.68-1.36-2.66-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"],[1,"video-call-info"],["autoplay","","playsinline","",1,"remote-video"],["autoplay","","playsinline","","muted","",1,"local-video"],[1,"caller-avatar"],[1,"caller-name"],[1,"call-duration"],["fill","currentColor","d","M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"],["fill","currentColor","d","M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3L3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V20c0 .55.45 1 1 1s1-.45 1-1v-2.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"],["title","C\xE1mara",1,"control-btn",3,"click"],["fill","currentColor","d","M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"],["fill","currentColor","d","M21 6.5l-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18V6.5zM3.27 2L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73 3.27 2z"],[1,"duration"]],template:function(t,n){t&1&&(r(0,"div",2),x(1,Cr,4,0)(2,vr,7,3,"div",3),r(3,"div",4)(4,"button",5),g("click",function(){return n.toggleMute()}),x(5,xr,2,0,":svg:svg",6)(6,br,2,0,":svg:svg",6),s(),x(7,Sr,3,3,"button",7),r(8,"button",8),g("click",function(){return n.endCall()}),w(),r(9,"svg",6),h(10,"path",9),s()()(),x(11,Pr,3,1,"div",10),s()),t&2&&(L("video-call",n.isVideo),c(),f(n.isVideo?1:2),c(3),L("off",!n.isAudioEnabled),c(),f(n.isAudioEnabled?5:6),c(2),f(n.isVideo?7:-1),c(4),f(n.isVideo?11:-1))},dependencies:[F],styles:[".active-call-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#1a1a1a;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999}.active-call-overlay.video-call[_ngcontent-%COMP%]{background:#000}.voice-call-ui[_ngcontent-%COMP%]{text-align:center;color:#fff}.caller-avatar[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:50%;background:linear-gradient(135deg,#00a884,#25d366);display:flex;align-items:center;justify-content:center;font-size:60px;font-weight:500;margin:0 auto 30px;color:#fff}.caller-name[_ngcontent-%COMP%]{font-size:32px;font-weight:500;margin:0 0 10px}.call-duration[_ngcontent-%COMP%]{font-size:18px;color:#ffffffb3;margin:0}.remote-video[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;background:#000}.local-video[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px;width:150px;height:200px;object-fit:cover;border-radius:12px;box-shadow:0 4px 20px #00000080;background:#333;z-index:10}.video-call-info[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;z-index:10}.video-call-info[_ngcontent-%COMP%]   .duration[_ngcontent-%COMP%]{background:#00000080;padding:8px 16px;border-radius:20px;color:#fff;font-size:14px;font-weight:500}.call-controls[_ngcontent-%COMP%]{position:absolute;bottom:50px;left:50%;transform:translate(-50%);display:flex;gap:30px;z-index:20}.control-btn[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;border:none;background:#fff3;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;backdrop-filter:blur(10px)}.control-btn[_ngcontent-%COMP%]:hover{background:#ffffff4d;transform:scale(1.1)}.control-btn.off[_ngcontent-%COMP%]{background:#ffffffe6;color:#333}.control-btn.end-call[_ngcontent-%COMP%]{background:#dc3545;width:70px;height:70px}.control-btn.end-call[_ngcontent-%COMP%]:hover{background:#c82333}@media (max-width: 768px){.local-video[_ngcontent-%COMP%]{width:100px;height:140px;top:10px;right:10px}.caller-avatar[_ngcontent-%COMP%]{width:120px;height:120px;font-size:48px}.caller-name[_ngcontent-%COMP%]{font-size:26px}.call-controls[_ngcontent-%COMP%]{bottom:30px;gap:20px}.control-btn[_ngcontent-%COMP%]{width:50px;height:50px}.control-btn.end-call[_ngcontent-%COMP%]{width:60px;height:60px}}"]})};var Lt=class i{constructor(e){this.http=e;this.checkSupport()}apiUrl=$.apiUrl;swRegistration=null;pushSubscription=null;isSupported=b(!1);isSubscribed=b(!1);permission=b("default");checkSupport(){this.isSupported.set("serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window),"Notification"in window&&this.permission.set(Notification.permission)}init(){return v(this,null,function*(){if(!this.isSupported()){console.log("[Push] Push notifications not supported");return}try{this.swRegistration=yield navigator.serviceWorker.register("/sw-push.js"),console.log("[Push] Service Worker registered"),this.pushSubscription=yield this.swRegistration.pushManager.getSubscription(),this.isSubscribed.set(!!this.pushSubscription),navigator.serviceWorker.addEventListener("message",e=>{e.data?.type==="NOTIFICATION_CLICK"&&window.dispatchEvent(new CustomEvent("push-notification-click",{detail:{chatId:e.data.chatId}}))})}catch(e){console.error("[Push] Error initializing:",e)}})}requestPermission(){return v(this,null,function*(){if(!this.isSupported())return!1;try{let e=yield Notification.requestPermission();return this.permission.set(e),e==="granted"}catch(e){return console.error("[Push] Error requesting permission:",e),!1}})}subscribe(){return v(this,null,function*(){if(!this.isSupported()||!this.swRegistration||this.permission()!=="granted"&&!(yield this.requestPermission()))return!1;try{let e=yield this.http.get(`${this.apiUrl}/push/vapid-public-key`).toPromise();if(!e)throw new Error("No VAPID public key received");let t=this.urlBase64ToUint8Array(e.publicKey);this.pushSubscription=yield this.swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t});let n=this.arrayBufferToBase64(this.pushSubscription.getKey("p256dh")),o=this.arrayBufferToBase64(this.pushSubscription.getKey("auth")),a={endpoint:this.pushSubscription.endpoint,keys:{p256dh:n,auth:o}};return yield this.http.post(`${this.apiUrl}/push/subscribe`,a).toPromise(),this.isSubscribed.set(!0),console.log("[Push] Subscribed successfully"),!0}catch(e){return console.error("[Push] Error subscribing:",e),!1}})}unsubscribe(){return v(this,null,function*(){if(!this.pushSubscription)return!0;try{return yield this.pushSubscription.unsubscribe(),yield this.http.post(`${this.apiUrl}/push/unsubscribe`,{endpoint:this.pushSubscription.endpoint}).toPromise(),this.pushSubscription=null,this.isSubscribed.set(!1),console.log("[Push] Unsubscribed successfully"),!0}catch(e){return console.error("[Push] Error unsubscribing:",e),!1}})}urlBase64ToUint8Array(e){let t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(n),a=new Uint8Array(o.length);for(let p=0;p<o.length;++p)a[p]=o.charCodeAt(p);return a}arrayBufferToBase64(e){let t=new Uint8Array(e),n="";for(let o=0;o<t.byteLength;o++)n+=String.fromCharCode(t[o]);return window.btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}static \u0275fac=function(t){return new(t||i)(ne(ie))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};function Or(i,e){i&1&&h(0,"app-chat-window")}function kr(i,e){i&1&&(r(0,"div",3)(1,"div",4),h(2,"img",5),r(3,"h2"),d(4,"WhatsApp Web Clone"),s(),r(5,"p"),d(6,"Env\xEDa y recibe mensajes sin necesidad de mantener tu tel\xE9fono conectado."),s()()())}function Tr(i,e){i&1&&h(0,"app-incoming-call")}function Er(i,e){i&1&&h(0,"app-active-call")}var an=class i{constructor(e,t,n,o,a){this.chatService=e;this.signalRService=t;this.contactService=n;this.callService=o;this.pushService=a}subscriptions=[];ngOnInit(){this.chatService.getChats().subscribe(),this.contactService.getContacts().subscribe(),this.signalRService.startConnection(),this.initPushNotifications(),this.subscriptions.push(this.signalRService.messageReceived$.subscribe(e=>{this.chatService.addMessage(e.mensaje)}),this.signalRService.messageStatusUpdated$.subscribe(e=>{this.chatService.updateMessageStatus(e.messageId,e.status)}),this.signalRService.messagesRead$.subscribe(e=>{this.chatService.updateMessagesStatus(e.messageIds,"Leido")}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),this.signalRService.stopConnection()}initPushNotifications(){return v(this,null,function*(){if(!this.pushService.isSupported()){console.log("[Push] Push notifications not supported in this browser");return}yield this.pushService.init(),this.pushService.permission()==="granted"&&!this.pushService.isSubscribed()?yield this.pushService.subscribe():this.pushService.permission()==="default"&&setTimeout(()=>v(this,null,function*(){(yield this.pushService.requestPermission())&&(yield this.pushService.subscribe())}),3e3),window.addEventListener("push-notification-click",e=>{let t=e.detail?.chatId;if(t){let n=this.chatService.chats().find(o=>o.id===t);n&&this.chatService.selectChat(n)}})})}static \u0275fac=function(t){return new(t||i)(I(ce),I(Oe),I(Ae),I(ve),I(Lt))};static \u0275cmp=U({type:i,selectors:[["app-chat-layout"]],decls:8,vars:5,consts:[[1,"chat-layout"],[1,"sidebar"],[1,"chat-main"],[1,"no-chat-selected"],[1,"welcome"],["src","https://web.whatsapp.com/img/intro-connection-light_c98cc75f2aa905314d74f95d668f5884.png","alt","WhatsApp"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"aside",1),h(2,"app-chat-list"),s(),r(3,"main",2),x(4,Or,1,0,"app-chat-window")(5,kr,7,0,"div",3),s()(),x(6,Tr,1,0,"app-incoming-call")(7,Er,1,0,"app-active-call")),t&2&&(L("chat-open",n.chatService.selectedChat()),c(4),f(n.chatService.selectedChat()?4:5),c(2),f(n.callService.isInCall()&&n.callService.isIncoming()?6:-1),c(),f(n.callService.isInCall()&&!n.callService.isIncoming()?7:-1))},dependencies:[F,at,It,Vt,Rt],styles:[".chat-layout[_ngcontent-%COMP%]{display:flex;height:100vh;background:var(--bg-app)}.sidebar[_ngcontent-%COMP%]{width:400px;min-width:300px;max-width:500px;background:var(--bg-primary);border-right:1px solid var(--border-color);display:flex;flex-direction:column}.chat-main[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;background:var(--bg-chat);background-image:var(--bg-chat-pattern)}.no-chat-selected[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;background:var(--bg-secondary)}.no-chat-selected[_ngcontent-%COMP%]   .welcome[_ngcontent-%COMP%]{text-align:center;max-width:500px;padding:20px}.no-chat-selected[_ngcontent-%COMP%]   .welcome[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:250px;margin-bottom:30px;opacity:.9}.no-chat-selected[_ngcontent-%COMP%]   .welcome[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:32px;font-weight:300;color:var(--text-primary);margin:0 0 15px}.no-chat-selected[_ngcontent-%COMP%]   .welcome[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:14px;line-height:1.5}@media (max-width: 768px){.sidebar[_ngcontent-%COMP%]{width:100%;max-width:none}.chat-main[_ngcontent-%COMP%], .chat-layout.chat-open[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{display:none}.chat-layout.chat-open[_ngcontent-%COMP%]   .chat-main[_ngcontent-%COMP%]{display:flex}}"]})};export{an as ChatLayoutComponent};
