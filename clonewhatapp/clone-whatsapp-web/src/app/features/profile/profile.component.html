<div class="profile-overlay" (click)="closePanel()"></div>

<div class="profile-panel">
  <!-- Header -->
  <header class="profile-header">
    <button class="back-btn" (click)="closePanel()">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
      </svg>
    </button>
    <h2>Perfil</h2>
  </header>

  <!-- Profile Content -->
  <div class="profile-content">
    <!-- Profile Photo Section -->
    <div class="photo-section">
      <div class="photo-container">
        @if (getProfileImageUrl()) {
          <img [src]="getProfileImageUrl()" alt="Foto de perfil" class="profile-photo" />
        } @else {
          <div class="photo-placeholder">
            {{ getUserInitial() }}
          </div>
        }

        @if (isUploading()) {
          <div class="upload-overlay">
            <div class="spinner"></div>
          </div>
        }

        <div class="photo-actions">
          <label class="photo-action-btn" title="Cambiar foto">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor" d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
            </svg>
            <input type="file" accept="image/*" (change)="onFileSelected($event)" hidden />
          </label>
          @if (getProfileImageUrl()) {
            <button class="photo-action-btn delete" title="Eliminar foto" (click)="deletePhoto()">
              <svg viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
              </svg>
            </button>
          }
        </div>
      </div>
    </div>

    @if (errorMessage()) {
      <div class="error-message">{{ errorMessage() }}</div>
    }

    <!-- Name Section -->
    <div class="info-section">
      <label class="section-label">Tu nombre</label>
      @if (isEditingName()) {
        <div class="edit-field">
          <input
            type="text"
            [(ngModel)]="editedName"
            maxlength="100"
            placeholder="Escribe tu nombre"
            (keyup.enter)="saveName()"
          />
          <div class="edit-actions">
            <button class="save-btn" (click)="saveName()">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
              </svg>
            </button>
            <button class="cancel-btn" (click)="cancelEditName()">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          </div>
        </div>
      } @else {
        <div class="display-field" (click)="startEditingName()">
          <span class="field-value">{{ authService.currentUser()?.nombre }}</span>
          <svg viewBox="0 0 24 24" width="20" height="20" class="edit-icon">
            <path fill="currentColor" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
          </svg>
        </div>
      }
      <p class="section-hint">Este nombre será visible para tus contactos de WhatsApp Clone</p>
    </div>

    <!-- Status Section -->
    <div class="info-section">
      <label class="section-label">Info</label>
      @if (isEditingStatus()) {
        <div class="edit-field">
          <input
            type="text"
            [(ngModel)]="editedStatus"
            maxlength="150"
            placeholder="Escribe tu estado"
            (keyup.enter)="saveStatus()"
          />
          <div class="edit-actions">
            <button class="save-btn" (click)="saveStatus()">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
              </svg>
            </button>
            <button class="cancel-btn" (click)="cancelEditStatus()">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          </div>
        </div>
      } @else {
        <div class="display-field" (click)="startEditingStatus()">
          <span class="field-value">{{ authService.currentUser()?.estado || 'Hey there! I\'m using WhatsApp Clone' }}</span>
          <svg viewBox="0 0 24 24" width="20" height="20" class="edit-icon">
            <path fill="currentColor" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
          </svg>
        </div>
      }
    </div>

    <!-- Phone Section -->
    <div class="info-section">
      <label class="section-label">Teléfono</label>
      <div class="display-field readonly">
        <span class="field-value">{{ authService.currentUser()?.numeroTelefono }}</span>
      </div>
    </div>
  </div>
</div>
